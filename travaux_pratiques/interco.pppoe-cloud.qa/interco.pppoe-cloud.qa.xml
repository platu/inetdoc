<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
        "/usr/share/xml/docbook/schema/dtd/5.0/docbook.dtd"[

<!ENTITY author				SYSTEM "author.xml">
<!ENTITY legal				SYSTEM "legal.xml">

<!-- urls -->
<!ENTITY % rfc_urls SYSTEM 'rfc.urls.xml'>
%rfc_urls;

<!ENTITY % inetdoc_urls SYSTEM 'inetdoc.urls.xml'>
%inetdoc_urls;

<!ENTITY url.ppp-wikipedia
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Point-to-Point_Protocol">
<citetitle>Point-to-Point Protocol</citetitle></link>'>

<!ENTITY url.pppoe-wikipedia
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Point-to-point_protocol_over_Ethernet">
<citetitle>Point-to-point protocol over Ethernet</citetitle></link>'>

<!ENTITY url.cheatsheet
'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://www.inetdoc.net/pdf/iproute-cheatsheet.pdf">
<citetitle>Antisèche réseau</citetitle></link>'>

<!ENTITY % w3centities-f PUBLIC "-//W3C//ENTITIES Combined Set//EN//XML"
	"http://www.w3.org/2003/entities/2007/w3centities-f.ent">
%w3centities-f;
]>

<article xml:lang='fr' xml:id='interco.pppoe-cloud.qa'>
<info>
	<title>Routage inter-VLAN dans un contexte cloud</title>
	&author;
<abstract>
<para>
	<informaltable frame='none' pgwide='1'>
	<tgroup cols='2' align='left' colsep='0' rowsep='0'>
	<colspec colwidth='5*'/>
	<colspec colwidth='220px'/>
	<tbody>
	<row>
		<entry valign='top'>
		<para>Le routage inter-VLAN est très largement utilisé dans
		l'interconnexion entre les réseaux Ethernet. Les manipulations
		présentées dans ces travaux pratiques illustrent l'interconnexion entre
		un réseau d'hébergement de type Cloud IAAS (<wordasword>Infrastructure
		As A Service</wordasword>) et un réseau de conteneurs
		<acronym>LXD</acronym> raccordés à l'aide de la technologie
		<acronym>MACVLAN</acronym>.</para> 

		<para>On introduit aussi un premier niveau de filtrage induit par le
		recours à la traduction d'adresses entre les deux réseaux
		interconnectés.</para> 
		</entry>
		<entry>
		<inlinemediaobject>
		<imageobject role='html'>
			<imagedata fileref='images/pppoe-cloud-logical-topology.png' format='PNG' width='220px' scalefit='1'/>
		</imageobject>
		<imageobject role='fo'>
			<imagedata fileref='images/pppoe-cloud-logical-topology.png' format='PNG' width='4.5cm' scalefit='1'/>
	    </imageobject>
		</inlinemediaobject>
		</entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>
</para>
</abstract>
<keywordset>
	<keyword>8021q</keyword>
	<keyword>access</keyword>
	<keyword>arp</keyword>
	<keyword>dot1q</keyword>
	<keyword>ieee802.1q</keyword>
	<keyword>iproute2</keyword>
	<keyword>iptables</keyword>
	<keyword>lxd</keyword>
	<keyword>openvswitch</keyword>
	<keyword>route</keyword>
	<keyword>routing</keyword>
	<keyword>sysctl</keyword>
	<keyword>trunk</keyword>
</keywordset>
</info>

<sect1 xml:id='interco.pppoe-cloud.qa.meta'>
	&legal;
	<sect2 xml:id='interco.pppoe-cloud.qa.meta.file'>
		<title>Méta-information</title>
    
		<para>Ce document est écrit avec <link
		xlink:href="http://www.docbook.org"><citetitle>DocBook</citetitle></link>
		XML sur un système <link
		xlink:href="https://www.debian.org"><citetitle>Debian
		GNU/Linux</citetitle></link>. Il est disponible en version imprimable
		au format PDF : <link
		xlink:href="https://www.inetdoc.net/pdf/__printbasename__"><literal>__printbasename__</literal></link>.</para>

	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.meta.convtypo'>
		<title>Conventions typographiques</title>

		<para>Tous les exemples d'exécution des commandes sont précédés d'une
		invite utilisateur ou <wordasword>prompt</wordasword> spécifique au
		niveau des droits utilisateurs nécessaires sur le système.</para>

		<itemizedlist>
		<listitem>
			<para>Toute commande précédée de l'invite <prompt>$</prompt> ne
			nécessite aucun privilège particulier et peut être utilisée au
			niveau utilisateur simple.</para>
		</listitem>
		<listitem>
			<para>Toute commande précédée de l'invite <prompt>#</prompt>
			nécessite les privilèges du super-utilisateur.</para>
		</listitem>
		</itemizedlist>
	</sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.pppoe-cloud.qa.ethernet'>
	<title>Interface Ethernet &amp; protocole PPP</title>

	<para>Avec la généralisation de l'utilisation de la fibre optique dans les
		réseaux étendus, le format de trame historique <acronym>HDLC</acronym>
		est progressivement abandonné. Il faut dire que ce format de trame date
		du développement des liaisons séries asynchrones. Aujourd'hui, les
		liaisons sur fibres optiques sont <wordasword>Full-Duplex</wordasword>
		et on ne se préoccupe plus de synchronisation au niveau de la couche
		liaison de données. Le format de trame Ethernet devient ainsi une
		référence universelle.</para>

	<para>Le protocole <acronym>PPP</acronym> offre depuis l'origine une
		configuration indépendante de la technologie du réseau étendu.</para>

	<para>L'association entre trame Ethernet et <acronym>PPP</acronym> se fait
		grâce à un autre protocole baptisé <acronym>PPPoE</acronym>. Ce dernier
		permet d'encapsuler des trames <acronym>PPP</acronym> dans des trames
		Ethernet. Il est décrit à la page &url.pppoe-wikipedia; qui permet de
		traiter les questions ci-après.</para>

<qandaset defaultlabel='number'>
	<qandadiv>
	<qandaentry>
	<question>
	<para><phrase>Quelle est la raison de l'ajout d'un nouveau protocole entre
		Ethernet et <acronym>PPP</acronym>&nbsp;?</phrase></para>

	<para>Consulter la page &url.pppoe-wikipedia;.</para>
	</question>
	<answer>
	<para>Le protocole <acronym>PPP</acronym> a été conçu pour fonctionner
		sur des liaisons point-à-point alors qu'un réseau local Ethernet est
		par définition un réseau de diffusion.</para> 

	<para>Sur un réseau de diffusion, le canal de transmission est partagé
		entre tous les hôtes qui accèdent au canal. Il a donc été nécessaire
		d'introduire un mécanisme de découverte des deux extrémités en
		communication avant de lancer les opérations du protocole
		<acronym>PPP</acronym>.</para> 
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Donner la liste des messages de découverte et de session
		<acronym>PPPoE</acronym> en précisant qui est l'initiative de cette
		découverte.</phrase></para>

	<para>Consulter la page &url.pppoe-wikipedia;.</para>
	</question>
	<answer>
	<itemizedlist>
	<listitem>
	<para>Client to server: Initiation (PADI)</para>
	</listitem>
	<listitem>
	<para>Server to client: Offer (PADO)</para>
	</listitem>
	<listitem>
	<para>Client to server: request (PADR)</para>
	</listitem>
	<listitem>
	<para>Server to client: session-confirmation (PADS)</para>
	</listitem>
	<listitem>
	<para>Either end to other end: termination (PADT)</para>
	</listitem>
	</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Quels sont les autres mécanismes de découverte de voisins
		connus dans un réseau local Ethernet&nbsp;?</phrase></para>
	</question>
	<answer>
	<para>Voici la liste des «grands classiques».</para>

	<itemizedlist>
	<listitem>
	<para>Address Resolution Protocol (<acronym>ARP</acronym>).</para>

	<para>Quelle est l'adresse <acronym>MAC</acronym> d'un hôte dont on connaît
		l'adresse <acronym>IPv4</acronym>&nbsp;?</para>
	</listitem>
	<listitem>
	<para>Neighbor Discovery Protocol (<acronym>NDP</acronym>).</para>

	<para>Ce protocole est associé à <acronym>IPv6</acronym>. Il définit 5
	messages <acronym>ICMPv6</acronym> qui couvrent les mêmes opérations que
	celles réalisées par le protcole <acronym>ARP</acronym> sans avoir recours
	à la diffusion et qui ajoutent de nouvelles fonctions.</para>
	</listitem>
	<listitem>
	<para>Multicast DNS (<acronym>mDNS</acronym>) ou
		<wordasword>Bonjour</wordasword>.</para>

	<para>Ce protocole entre dans la famille
		<wordasword>zeroconf</wordasword> qui a pour but d'annoncer et de
		fournir des éléments de configuration aux hôtes du réseau sans faire
		appel à une infrastructure de services de la couche application tels
		que <acronym>DNS</acronym> et <acronym>DHCP</acronym>.</para>
	</listitem>
	</itemizedlist>
	</answer>
	</qandaentry>
	</qandadiv>
</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.pppoe-cloud.qa.topology'>
	<title>Topologies logiques et virtuelles</title>

	<para>La représentation de la topologie logique ci-dessous montre que le
	routeur de couleur bleue assure l'interconnexion entre un réseau
	d'infrastructure opérateur appelé <wordasword>Hosting VLAN</wordasword> et
	un réseau étendu qui dessert un site distant. Ce site distant est
	représenté par le routeur de couleur verte. Les services hébergés sur le
	site distant appartiennent au réseau appelé <wordasword>Container
	VLAN</wordasword>. Sur le réseau étendu on distingue deux autres
	<acronym>VLANs</acronym>&nbsp;: le <acronym>VLAN</acronym> violet appelé
	<wordasword>Management VLAN</wordasword> est utilisé pour la supervision et
	le <acronym>VLAN</acronym> orange <wordasword>Data VLAN</wordasword> est
	utilisé pour l'acheminement des données du site distant. Ce dernier réseau
	à la particularité d'utiliser une session <acronym>PPPoE</acronym> entre
	les routeurs bleu et vert. Les deux rectangles en gris “matérialisent“ les
	machines virtuelles qui sont utilisées pour les manipulations.</para>

	<mediaobject>
	<imageobject role='html'>
	<imagedata fileref='images/pppoe-cloud-logical-topology.png' format='PNG' width='700px' scalefit='1'/>
	</imageobject>
	<imageobject role='fo'>
	<imagedata fileref='images/pppoe-cloud-logical-topology.png' format='PNG' width='16cm' scalefit='1'/>
	</imageobject>
	<textobject>
	<phrase>Topologie type</phrase>
	</textobject>
	<caption>
	<para><link xlink:href='images/pppoe-cloud-logical-topology.png'>Topologie logique</link></para>
	</caption>
	</mediaobject>

	<para>La représentation de la topologie vue sous l'angle de l'hébergement
	sur un système hôte hyperviseur montre que le <acronym>VLAN</acronym> de
	couleur verte appelé <wordasword>Container VLAN</wordasword> n'est visible
	qu'à l'intérieur de la machine virtuelle qui représente le site distant. Ce
	<acronym>VLAN</acronym> est isolé et ses préfixes réseau
	<acronym>IPv4</acronym> et <acronym>IPv6</acronym> doivent être
	<emphasis>routés</emphasis>. C'est la raison pour laquelle la machine
	virtuelle du site distant dispose de son propre commutateur&nbsp;:
	<systemitem>asw-host</systemitem>.</para>

	<para>Tous les autres <acronym>VLANs</acronym> sont présents sur le
	commutateur virtuel de couche distribution appelé
	<systemitem>dsw-host</systemitem>. Ce commutateur appartient au système
	hôte. Il assure le raccordement entre les réseaux physiques et virtualisés.
	Chacun des routeurs bleu et vert est raccordé avec un lien unique (port en
	mode <wordasword>trunk</wordasword>) sur lequel le trafic des
	<acronym>VLANs</acronym> doit transiter.</para>

	<para>Côté conteneurs, le raccordement au commutateur
	<systemitem>asw-host</systemitem> sera assuré automatiquement par le
	gestionnaire <citetitle>LXD</citetitle>.</para>

	<mediaobject>
	<imageobject role='html'>
	<imagedata fileref='images/pppoe-cloud-hypervisor-topology.png' format='PNG' width='700px' scalefit='1'/>
	</imageobject>
	<imageobject role='fo'>
	<imagedata fileref='images/pppoe-cloud-hypervisor-topology.png' format='PNG' width='16cm' scalefit='1'/>
	</imageobject>
	<textobject>
	<phrase>Topologie type</phrase>
	</textobject>
	<caption>
	<para><link xlink:href='images/pppoe-cloud-hypervisor-topology.png'>Topologie hébergée</link></para>
	</caption>
	</mediaobject>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.pppoe-cloud.qa.addressing'>
	<title>Plan d'adressage</title>

<para>Attention ! Les adresses de passerelle côté opérateur
(<wordasword>Hosting VLAN</wordasword> de couleur rouge) sont déjà implantées
dans l'infrastructure de travaux pratiques tandis que toutes les autres
adresses de passerelle sont à implanter sur les routeurs bleu et vert.</para>

<table frame='all' pgwide='1'>
	<title>Affectation des numéros de VLANs, des adresses de passerelle et des
	authentifiants</title>
	<tgroup cols='5' align='left' colsep='1' rowsep='1'>
	<colspec colname='c1' colwidth='1*'/>
	<colspec colname='c2' colwidth='1*'/>
	<colspec colname='c3' colwidth='1*'/>
	<colspec colname='c4' colwidth='1*'/>
	<colspec colname='c5' colwidth='2*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Planète</entry>
		<entry>VLAN</entry>
		<entry>Numéro</entry>
		<entry>Type</entry>
		<entry>Adresse</entry>
	</row>
	</thead>
	<tbody>
	<!-- Christophsis -->
	<row>
	<entry morerows='5' valign='middle'>Christophsis</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.37.9/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:133::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>400</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:190::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:190::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>401</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.1.1:10.4.1.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s1 / 5p0k3.1</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>10</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:a::1/64</systemitem>
	</entry>
	</row>
	<row>
	<!-- Corellia -->
	<entry morerows='5'>Corellia</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.22.9.33/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:151::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>402</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:192::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:192::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>403</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.3.1:10.4.3.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s2 / 5p0k3.2</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>11</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:b::1/64</systemitem>
	</entry>
	</row>
	<row>
	<!-- Delaya -->
	<entry morerows='5'>Delaya</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.31.0.193/26</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:136::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>404</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:194::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:194::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>405</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.5.1:10.4.5.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s3 / 5p0k3.3</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>12</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:c::1/64</systemitem>
	</entry>
	</row>
	<row>
	<!-- Kashyyyk -->
	<entry morerows='5'>Kashyyyk</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.30.5.129/26</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:131::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>406</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:196::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:196::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>407</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.7.1:10.4.7.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s4 / 5p0k3.4</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>13</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:d::1/64</systemitem>
	</entry>
	</row>
	<row>
	<!-- Korriban -->
	<entry morerows='5'>Korriban</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.9.10.129/26</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:14f::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>408</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:198::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:198::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>409</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.9.1:10.4.9.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s5 / 5p0k3.5</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>14</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:e::1/64</systemitem>
	</entry>
	</row>
	<!-- Kessel -->
	<row>
	<entry morerows='5'>Kessel</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.30.6.65/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:132::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>410</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:19a::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:19a::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>411</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.11.1:10.4.11.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s6 / 5p0k3.6</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>15</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:f::1/64</systemitem>
	</entry>
	</row>
	<!-- Mygeeto -->
	<row>
	<entry morerows='5'>Mygeeto</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.9.15.17/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:150::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>412</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:19c::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:19c::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>413</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.13.1:10.4.13.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s7 / 5p0k3.7</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>16</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:10::1/64</systemitem>
	</entry>
	</row>
	<!-- nelvaan -->
	<row>
	<entry morerows='5'>Nelvaan</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.31.1.145/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:137::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>414</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:19e::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:19e::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>415</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.15.1:10.4.15.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s8 / 5p0k3.8</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>17</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:11::1/64</systemitem>
	</entry>
	</row>
	<!-- Rattatak -->
	<row>
	<entry morerows='5'>Rattatak</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.10.81/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:145::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>416</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1a0::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1a0::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>417</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.17.1:10.4.17.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s9 / 5p0k3.9</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>18</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:12::1/64</systemitem>
	</entry>
	</row>
	<!-- Saleucami -->
	<row>
	<entry morerows='5'>Saleucami</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.12.17/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:138::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>418</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1a2::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1a2::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>419</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.19.1:10.4.19.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s10 / 5p0k3.10</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>19</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:13::1/64</systemitem>
	</entry>
	</row>
	<!-- Taris -->
	<row>
	<entry morerows='5'>Taris</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.8.11.9/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:14b::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>420</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1a4::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1a4::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>421</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.21.1:10.4.21.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s11 / 5p0k3.11</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>20</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:14::1/64</systemitem>
	</entry>
	</row>
	<!-- Teth -->
	<row>
	<entry morerows='5'>teth</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.0.10.33/27</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:13c::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>422</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1a6::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1a6::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>423</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.23.1:10.4.23.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s12 / 5p0k3.12</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>21</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:15::1/64</systemitem>
	</entry>
	</row>
	<!-- Utapau -->
	<row>
	<entry morerows='5'>Utapau</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.21.12.17/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:14c::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>424</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1a8::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1a8::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>425</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.25.1:10.4.25.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s13 / 5p0k3.13</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>22</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:16::1/64</systemitem>
	</entry>
	</row>
	<!-- Yavin -->
	<row>
	<entry morerows='5'>Yavin</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.19.9.65/26</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:13b::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>426</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1aa::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1aa::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>427</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.27.1:10.4.27.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s14 / 5p0k3.14</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>23</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:17::1/64</systemitem>
	</entry>
	</row>
	<!-- Alderaan -->
	<row>
	<entry morerows='5'>Alderaan</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.17.64.129/25</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:64::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>220</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:dc::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:dc::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>221</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.21.1:10.2.21.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s20 / 5p0k3.20</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>24</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:18::1/64</systemitem>
	</entry>
	</row>
	<!-- Bespin -->
	<row>
	<entry morerows='5'>Bespin</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.20.135.65/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:87::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>222</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:de::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:de::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>223</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.23.1:10.2.23.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s21 / 5p0k3.21</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>25</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:19::1/64</systemitem>
	</entry>
	</row>
	<!-- Centares -->
	<row>
	<entry morerows='5'>Centares</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.18.4.1/22</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:65::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>224</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:e0::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:e0::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>225</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.25.1:10.2.25.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s22 / 5p0k3.22</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>26</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1a::1/64</systemitem>
	</entry>
	</row>
	<!-- Coruscant -->
	<row>
	<entry morerows='5'>Coruscant</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.20.136.81/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:88::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>226</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:e2::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:e2::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>227</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.27.1:10.2.27.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s23 / 5p0k3.23</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>27</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1b::1/64</systemitem>
	</entry>
	</row>
	<!-- Dagobah -->
	<row>
	<entry morerows='5'>Dagobah</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.3.2.1/23</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:66::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>228</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:e4::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:e4::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>229</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.29.1:10.2.29.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s24 / 5p0k3.24</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>28</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1c::1/64</systemitem>
	</entry>
	</row>
	<!-- Endor -->
	<row>
	<entry morerows='5'>Endor</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.24.132.17/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:84::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>230</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:e6::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:e6::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>231</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.31.1:10.2.31.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s25 / 5p0k3.25</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>29</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1d::1/64</systemitem>
	</entry>
	</row>
	<!-- Felucia -->
	<row>
	<entry morerows='5'>Felucia</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.6.8.1/23</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:69::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>232</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:e8::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:e8::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>233</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.33.1:10.2.33.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s26 / 5p0k3.26</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>30</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1e::1/64</systemitem>
	</entry>
	</row>
	<!-- Geonosis -->
	<row>
	<entry morerows='5'>Geonosis</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.20.131.33/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:83::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>234</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:ea::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:ea::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>235</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.35.1:10.2.35.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s27 / 5p0k3.27</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>31</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:1f::1/64</systemitem>
	</entry>
	</row>
	<!-- Hoth -->
	<row>
	<entry morerows='5'>Hoth</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.7.10.1/23</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:6a::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>236</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:ec::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:ec::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>237</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.37.1:10.2.37.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s28 / 5p0k3.28</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>32</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:20::1/64</systemitem>
	</entry>
	</row>
	<!-- Jakku -->
	<row>
	<entry morerows='5'>Jakku</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.20.130.25/29</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:82::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>238</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:ee::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:ee::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>239</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.39.1:10.2.39.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s29 / 5p0k3.29</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>33</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:21::1/64</systemitem>
	</entry>
	</row>
	<!-- Kamino -->
	<row>
	<entry morerows='5'>Kamino</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.107.1/25</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:6b::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>240</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:f0::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:f0::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>241</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.41.1:10.2.41.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s30 / 5p0k3.30</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>34</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:22::1/64</systemitem>
	</entry>
	</row>
	<!-- Mustafar -->
	<row>
	<entry morerows='5'>Mustafar</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.110.129/25</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:6e::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>242</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:f2::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:f2::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>243</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.43.1:10.2.43.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s31 / 5p0k3.31</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>35</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:25::1/64</systemitem>
	</entry>
	</row>
	<!-- Naboo -->
	<row>
	<entry morerows='5'>Naboo</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>192.168.122.1/28</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:7a::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>244</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:f4::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:f4::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>245</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.45.1:10.2.45.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s32 / 5p0k3.32</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>36</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:26::1/64</systemitem>
	</entry>
	</row>
	<!-- Tatooine -->
	<row>
	<entry morerows='5'>Tatooine</entry>
	<entry>Rouge</entry>
	<entry>-</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>172.19.115.193/26</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:73::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>246</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:f6::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:f6::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>247</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.2.47.1:10.2.47.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>green_s33 / 5p0k3.33</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>37</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:27::1/64</systemitem>
	</entry>
	</row>
	</tbody>
	</tgroup>
</table>

	<para>Voici le plan d'adressage utilisé pour la maquette qui sert à la
	rédaction de ce support de travaux pratiques.</para>

<table frame='all' pgwide='1'>
	<title>Affectation des numéros de VLANs, des adresses de passerelle et des
	authentifiants</title>
	<tgroup cols='5' align='left' colsep='1' rowsep='1'>
	<colspec colname='c1' colwidth='1*'/>
	<colspec colname='c2' colwidth='1*'/>
	<colspec colname='c3' colwidth='1*'/>
	<colspec colname='c4' colwidth='1*'/>
	<colspec colname='c5' colwidth='2*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Planète</entry>
		<entry>VLAN</entry>
		<entry>Numéro</entry>
		<entry>Type</entry>
		<entry>Adresse</entry>
	</row>
	</thead>
	<tbody>
	<!-- Maquette -->
	<row>
	<entry morerows='5' valign='middle'>Maquette</entry>
	<entry>Rouge</entry>
	<entry>300</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.141.0.161/27</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>2001:678:3fc:12c::1/64</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Violet</entry>
	<entry morerows='1'>430</entry>
	<entry morerows='1'>Adresse</entry>
	<entry>
		<systemitem class='ipaddress'>fe80:1ae::1</systemitem>
	</entry>
	</row>
	<row>
	<entry>
		<systemitem class='ipaddress'>fe80:1ae::2</systemitem>
	</entry>
	</row>
	<row>
	<entry morerows='1'>Orange</entry>
	<entry morerows='1'>431</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>10.4.31.1:10.4.31.2</systemitem>
	</entry>
	</row>
	<row>
	<entry>Authentifiants</entry>
	<entry><systemitem>etu / 5p0k3</systemitem></entry>
	</row>
	<row>
	<entry>Vert</entry>
	<entry>40</entry>
	<entry>Passerelle</entry>
	<entry>
		<systemitem class='ipaddress'>203.0.113.1/24</systemitem><?custom-linebreak?>
		<systemitem class='ipaddress'>fda0:7a62:28::1/64</systemitem>
	</entry>
	</row>
	</tbody>
	</tgroup>
</table>
</sect1>

<sect1 xml:id='interco.pppoe-clous.qa.dsw'>
	<title>Raccordement au commutateur de distribution</title>

	<para>Dans cette section, on étudie le raccordement des deux machines
	virtuelles au commutateur de distribution sur le système hôte.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Comment contrôler la configuration des ports du commutateur de
	distribution sur le système hôte&nbsp;?</para>
	</question>
	<answer>
	<para>Le commutateur virtuel implanté sur le système hôte est géré par
	<citetitle>Open vSwitch</citetitle>. On fait donc appel à la commande
	<command>ovs-vsctl</command> pour afficher la configuration des ports. Le
	mot clé dans le cas de cette question est
	<option>vlan_mode</option>.</para>

	<itemizedlist>
	<listitem>
	<para>Pour le port de raccordement du routeur, on obtient&nbsp;:</para>
<screen><prompt>$</prompt> sudo ovs-vsctl list port tap100 | grep vlan_mode
vlan_mode           : <emphasis>trunk</emphasis></screen>
	</listitem>
	<listitem>
	<para>Pour le port de raccordement du serveur de conteneur, on obtient&nbsp;:</para>
<screen><prompt>$</prompt> sudo ovs-vsctl list port tap1 | grep vlan_mode
vlan_mode           : <emphasis>access</emphasis></screen>
	</listitem>
	</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment contrôler le numéro de <acronym>VLAN</acronym> attribué au
	port en mode accès du commutateur de distribution sur le système
	hôte&nbsp;?</para>
	</question>
	<answer>
	<para>On reprend la même commande que dans la question précédente avec le
	mot clé <option>tag</option>.</para>
<screen><prompt>$</prompt> sudo ovs-vsctl list port tap1 | grep tag
tag                 : <emphasis>430</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment affecter le numéro de <acronym>VLAN</acronym> attribué au
	port en mode accès du commutateur de distribution sur le système
	hôte&nbsp;?</para>
	</question>
	<answer>
	<para>On reprend à nouveau la même commande avec l'option <option>set</option>.</para> 
<screen><prompt>$</prompt> sudo ovs-vsctl set port <emphasis>tap1 tag=430</emphasis></screen>

	<para>Les valeurs données dans l'exemple ci-dessus sont à changer suivant
	les attributions de la <xref
	linkend='interco.pppoe-cloud.qa.addressing'/>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment s'assurer que le port du commutateur est bien configuré à
	chaque nouveau lancement de machine virtuelle&nbsp;?</para>
	</question>
	<answer>
	<para>On place les commandes de configuration dans une section dédiée du
	script de lancement. Voici deux exemples de script de lancement&nbsp;:</para>
<screen>#!/bin/bash
RAM=1024

echo "Lancement routeur Bleu ou Vert" !! À changer
CORDON_TRUNK=100 !! À changer

sudo ovs-vsctl set port tap$CORDON_TRUNK vlan_mode=trunk

$HOME/vm/scripts/ovs-startup.sh routeur.qcow2 $RAM $CORDON_TRUNK</screen>

	<para>Les numéros de port et de <acronym>VLAN</acronym> donnés dans les
	exemples ci-dessus sont à changer suivant le contexte.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<sect1 xml:id='interco.pppoe-cloud.qa.blue'>
	<title>Routeur bleu</title>

	<para>Dans cette section, on étudie la machine virtuelle qui joue le rôle
	de routeur entre le réseau opérateur et le réseau étendu qui dessert le
	site distant.</para>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.interfaces'>
		<title>Configuration des interfaces du routeur</title>

	<para>Une fois la machine virtuelle routeur lancée, les premières étapes
	consistent à lui attribuer un nouveau nom et à configurer les interfaces
	réseau pour joindre les hôtes voisins.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Comment changer le nom de la machine virtuelle&nbsp;?</para>
	</question>
	<answer>
	<para>Il faut éditer les deux fichiers <filename>/etc/hosts</filename> et
	<filename>/etc/hostname</filename> en remplaçant le nom de l'image
	maître <citetitle>vm0</citetitle> par le nom voulu. Il est ensuite
	nécessaire de redémarrer pour que le nouveau nom soit pris en compte par
	tous les outils du système.</para>

<screen><prompt>etu@vm0:~$</prompt> sudo sed -i 's/vm0/bleu/g' /etc/hosts
<prompt>etu@vm0:~$</prompt> sudo sed -i 's/vm0/bleu/g' /etc/hostname
sudo: impossible de résoudre l'hôte vm0: Échec temporaire dans la résolution du nom
<prompt>etu@vm0:~$</prompt> sudo reboot</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment appliquer les configurations réseau <acronym>IPv4</acronym>
	et <acronym>IPv6</acronym> à partir de l'unique interface du
	routeur&nbsp;?</para>

	<para>Consulter les pages de manuels du fichier de configuration système à
	l'aide de la commande <command>man&nbsp;interfaces</command>.</para>
	</question>
	<answer>
	<para>Il existe plusieurs possibilités pour configurer une interface
	réseau. Dans le contexte de ces manipulations, on utilise le fichier de
	configuration fourni par la distribution <citetitle>Debian
	GNU/Linux</citetitle>&nbsp;:
	<filename>/etc/network/interfaces</filename>.</para> 

	<para>La configuration de base fournie avec l'image maître suppose que
	l'interface obtienne un bail <acronym>DHCP</acronym> pour la partie
	<acronym>IPv4</acronym> et une configuration automatique via
	<acronym>SLAAC</acronym> pour la partie <acronym>IPv6</acronym>. Cette
	configuration par défaut doit être éditée et remplacée. Il faut configurer
	trois interfaces.</para>

	<para>Une interface doit être créée pour chacun des différents réseaux avec
	le numéro de <acronym>VLAN</acronym> désigné dans le tableau de la <xref
	linkend='interco.pppoe-cloud.qa.addressing'/>.</para>

	<itemizedlist>
	<listitem>
	<para>L'interface principale doit être placée en mode manuel
	(<wordasword>manual</wordasword>). Elle doit être activée/désactivée au
	niveau de la couche liaison.</para>
	</listitem>
	<listitem>
	<para>Une interface doit être créée pour le <acronym>VLAN</acronym> rouge.
	Cette interface doit désigner les passerelles <acronym>IPv4</acronym> et
	<acronym>IPv6</acronym> de façon à joindre l'Internet.</para>
	</listitem>
	<listitem>
	<para>Une interface doit être créée pour le <acronym>VLAN</acronym> violet
	avec une adresse de lien local <acronym>IPv6</acronym> pour la
	supervision.</para>
	</listitem>
	<listitem>
	<para>Une interface doit être créée pour le <acronym>VLAN</acronym> orange
	avec les adresses <acronym>IPv4</acronym> et <acronym>IPv6</acronym> de
	passerelle pour le réseau étendu.</para>
	</listitem>
	</itemizedlist>

	<para>Voici une copie du fichier
	<filename>/etc/network/interfaces</filename> de la maquette.</para>

<screen># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp0s6
iface enp0s6 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- VLAN ROUGE ----------
auto enp0s6.300
iface enp0s6.300 inet static
	address 10.141.0.162/27
	gateway 10.141.0.161
	dns-nameserver 9.9.9.9

iface enp0s6.300 inet6 static
	address 2001:678:3fc:12c::2/64
	gateway 2001:678:3fc:12c::1

# ---------- VLAN VIOLET ----------
auto enp0s6.430
iface enp0s6.430 inet6 static
	address fe80:1ae::1/64

# ---------- VLAN ORANGE ----------
auto enp0s6.431
iface enp0s6.431 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down</screen>

	<para>Une fois le fichier de configuration en place, il est préférable de
	redémarrer la machine virtuelle de façon à vérifier que la configuration
	des interfaces est bien appliquée après chaque réinitialisation.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Quels sont les tests de connectivité réalisables après application
	de la nouvelle configuration des interfaces réseau&nbsp;?</para>

	<para>Relever l'état des trois interfaces et procédez aux tests en
	respectant les couches de la modélisation.</para>
	</question>
	<answer>
	<para>La commande <command>ip addr ls</command> permet de relever l'état de
	la configuration pour chaque interface.</para>

<screen><prompt>$</prompt> ip addr ls | grep state
1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
2: enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq <emphasis>state UP</emphasis> group default qlen 1000
3: enp0s6.300@enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue <emphasis>state UP</emphasis> group default qlen 1000
4: enp0s6.430@enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue <emphasis>state UP</emphasis> group default qlen 1000
6: enp0s6.431@enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue <emphasis>state UP</emphasis> group default qlen 1000</screen>

	<para>Sans la confirmation que la configuration du routeur vert
	est prête, c'est du côté hébergement et accès Internet qu'il faut orienter
	les tests. Classiquemt, on cherche à joindre la passerelle en premier puis
	l'Internet ensuite via des requêtes <acronym>ICMP</acronym>. Enfin, on
	effectue un test de couche application avec une requête
	<acronym>DNS</acronym>.</para>

<screen><prompt>$</prompt> ping -q -c2 10.141.0.161
PING 10.141.0.161 (10.141.0.161) 56(84) bytes of data.

--- 10.141.0.161 ping statistics ---
<emphasis>2 packets transmitted, 2 received, 0% packet loss</emphasis>, time 1002ms
rtt min/avg/max/mdev = 0.990/1.188/1.387/0.198 ms
<prompt>$</prompt> ping -q -c2 9.9.9.9
PING 9.9.9.9 (9.9.9.9) 56(84) bytes of data.

--- 9.9.9.9 ping statistics ---
<emphasis>2 packets transmitted, 2 received, 0% packet loss</emphasis>, time 1002ms
rtt min/avg/max/mdev = 12.218/12.227/12.237/0.009 ms</screen>

<screen><prompt>$</prompt> ping -q -c2 2001:678:3fc:12c::1
PING 2001:678:3fc:12c::1(2001:678:3fc:12c::1) 56 data bytes

--- 2001:678:3fc:12c::1 ping statistics ---
<emphasis>2 packets transmitted, 2 received, 0% packet loss</emphasis>, time 1002ms
rtt min/avg/max/mdev = 1.023/1.164/1.306/0.141 ms
<prompt>$</prompt> ping -q -c2 2620:fe::fe
PING 2620:fe::fe(2620:fe::fe) 56 data bytes

--- 2620:fe::fe ping statistics ---
<emphasis>2 packets transmitted, 2 received, 0% packet loss</emphasis>, time 1002ms
rtt min/avg/max/mdev = 39.999/40.391/40.784/0.392 ms</screen>

<screen><prompt>$</prompt> host quad9.net
quad9.net has address 216.21.3.77
quad9.net has IPv6 address 2620:0:871:9000::77
quad9.net mail is handled by 20 mx2.quad9.net.
quad9.net mail is handled by 100 keriomail.pch.net.
quad9.net mail is handled by 5 mx1.quad9.net.</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.routing'>
		<title>Activation de la fonction routage</title>

	<para>Sans modification de la configuration par défaut, un système
	GNU/Linux n'assure pas la fonction de routage du trafic d'une interface
	réseau à une autre.</para>

	<para>L'activation du routage correspond à un réglage de paramètres du
	sous-système réseau du noyau Linux. L'outil qui permet de consulter et
	modifier les réglages de paramètre sur le noyau est appelé
	<application>sysctl</application>. Son fichier de configuration principal
	est <filename>/etc/sysctl.conf</filename>.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Comment activer le routage dans le sous-système réseau du noyau
	Linuxe&nbsp;?</para>

	<para>Utiliser la commande <command>sysctl</command> pour effectuer des
	recherches et identifier les paramètres utiles. Par exemple&nbsp;:
	<userinput><prompt>$</prompt> sudo sysctl -a -r
	".*forward.*"</userinput>.</para>

	<para>Le fichier <filename>/etc/sysctl.conf</filename> contient des
	commentaires qui guident facilement vers les bons paramètres.</para>

	<para>Attention ! Il ne faut pas oublier d'appliquer les nouvelles valeurs
	des paramètres de configuration.</para>
	</question>
	<answer>
	<para>Voici un extrait du fichier <filename>/etc/sysctl.conf</filename> du
	routeur de la maquette après édition.</para>

<screen><prompt>$</prompt> egrep -v '(^#|^$)' /etc/sysctl.conf
net.ipv4.conf.default.rp_filter=1
net.ipv4.conf.all.rp_filter=1
<emphasis>net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1</emphasis>
net.ipv4.conf.all.log_martians = 1</screen>

	<para>Voici une copie d'écran de l'application des nouveaux
	paramètres.</para>

<screen><prompt>$</prompt> sudo sysctl --system
* Applying /usr/lib/sysctl.d/50-pid-max.conf ...
kernel.pid_max = 4194304
* Applying /etc/sysctl.d/99-sysctl.conf ...
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.ipv4.conf.all.log_martians = 1
* Applying /usr/lib/sysctl.d/protect-links.conf ...
fs.protected_fifos = 1
fs.protected_hardlinks = 1
fs.protected_regular = 2
fs.protected_symlinks = 1
* Applying /etc/sysctl.conf ...
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.ipv4.conf.all.log_martians = 1</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Quelles sont les conditions à réunir pour tester le fonctionnement du
	routage&nbsp;?</para>

	<para>Rechercher comment utiliser l'analyseur réseau
	<application>tshark</application> pour caractériser l'acheminement du
	trafic d'un réseau à l'autre.</para>
	</question>
	<answer>
	<para>Le plan d'adressage prévoit d'utiliser des préfixes ayant une portée
	locale pour les réseaux de conteneurs. Il n'est donc pas possible de
	passer par une requête <acronym>ICMP</acronym> pour caractériser l'accès
	aux réseaux distants. En effet, l'adresse source n'est pas reconnue par
	l'hôte distant et les routeurs de l'Internet ne disposent d'aucune solution
	pour joindre le réseau des conteneurs.</para>

	<para>Voici un extrait de capture qui montre que le serveur de conteneur
	cherche à joindre un hôte sur l'Internet sans succès. Cette capture étant
	réalisée sur l'interface réseau côté hébergement, elle montre que le trafic
	est bien echeminé d'un réseau à l'autre.</para>

<screen><prompt>$</prompt> tshark -i enp0s6.300
Capturing on 'enp0s6.300'
    1 0.000000000    192.0.2.2 → 9.9.9.9      DNS 81 Standard query 0xbdab A 1.debian.pool.ntp.org
    2 0.000056361    192.0.2.2 → 9.9.9.9      DNS 81 Standard query 0xab92 AAAA 1.debian.pool.ntp.org</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.nat'>
		<title>Activation de la traduction d'adresses</title>

	<para>Le résultat de la question ci-dessus montre que les hôtes situés dans
	le réseau des conteneurs ne peuvent pas joindre l'Internet puisque les
	préfixes réseau utilisés ont une portée limitée.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Quels sont les paquets qui fournissent les outils de gestion de la
	traduction d'adresses&nbsp;?</para>

	<para>Rechercher les paquets relatifs au filtrage et à la gestion des
	règles de pare-feux.</para>
	</question>
	<answer>
	<para>Sur les systèmes GNU/Linux, le système de pare-feux comprend une
	partie "espace utilisateur" appelée <application>iptables</application> et
	une partie "noyau" appelée <application>netfilter</application>.</para>

	<para>C'est la partie "espace utilisateur" qui nous intéresse ici.</para>

<screen><prompt>$</prompt> aptitude search iptables
p   arno-iptables-firewall          - single- and multi-homed firewall script wi
p   golang-github-coreos-go-iptable - Go bindings for iptables utility
<emphasis>i   iptables                        - administration tools for packet filtering</emphasis>
p   iptables-converter              - convert iptables-commands from a file to i
p   iptables-converter-doc          - convert iptables-commands from a file to i
p   iptables-netflow-dkms           - iptables target which generates netflows
<emphasis>p   iptables-persistent             - boot-time loader for netfilter rules, ipta</emphasis>
p   libiptables-chainmgr-perl       - Perl extension for manipulating iptables p
p   libiptables-parse-perl          - Perl extension for parsing iptables firewa
p   python-iptables-doc             - documentation for the python-iptables libr
p   python3-iptables                - Python bindings for iptables (Python 3 int</screen>

	<para>On voit que le paquet <application>iptables</application> est déjà
	installé et qu'il ne manque que la gestion de la sauvegarde des règles de
	filtrage et traduction d'adresses.</para>

<screen><prompt>$</prompt> sudo apt install iptables-persistent</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Quelles sont les règles à appliquer pour assurer une traduction des
	adresses sources en sortie sur le réseau hébergement&nbsp;?</para>

	<para>Rechercher dans les pages de manuel de la commande
	<command>iptables</command>.</para>
	</question>
	<answer>
	<para>C'est la cible <literal>MASQUERADE</literal> qui nous intéresse.
	Voici un exemple de règles de traduction des adresses sources pour la
	maquette.</para>

<screen><prompt>$</prompt> sudo iptables -t nat -A POSTROUTING -o enp0s6.300 -j MASQUERADE
<prompt>$</prompt> sudo sh -c "iptables-save >/etc/iptables/rules.v4"</screen>

<screen><prompt>$</prompt> sudo ip6tables -t nat -A POSTROUTING -o enp0s6.300 -j MASQUERADE
<prompt>$</prompt> sudo sh -c "ip6tables-save >/etc/iptables/rules.v6"</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment caractériser le fonctionnement de la traduction d'adresses
	sources&nbsp;?</para>
	
	<para>Rechercher dans les pages de manuel de la commande
	<command>iptables</command> les options d'affichage du décompte du trafic
	traité.</para>
	</question>
	<answer>
	<para>Voici un exemple d'affichage pour le trafic <acronym>IPv4</acronym>
	uniquement.</para>

<screen><prompt>$</prompt> sudo iptables -vnL -t nat
Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
<emphasis>    8   598 MASQUERADE  all  --  *      enp0s6.300  0.0.0.0/0            0.0.0.0/0</emphasis>

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.pppoe'>
		<title>Activation du protocole PPPoE côté réseau étendu</title>
	
	<para>Pour acheminer le trafic depuis et vers le site distant, il est
	nécessaire de passer par une authentification. Cette fonction est assurée à
	l'aide du protocole <acronym>PPPoE</acronym>.</para>

	<para>Le protocole <acronym>PPP</acronym> n'a pas été conçu suivant le
	modèle Client/Serveur. Il suppose que deux processus pairs échangent des
	informations. Dans les questions qui suivent, le routeur bleu doit exiger
	que le routeur vert s'authentifie auprès de lui avant de délivrer les
	adresses de couche réseau.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
		<para><phrase>Quel paquet spécifique à la gestion du dialogue
		<acronym>PPPoE</acronym> à installer sur le routeur
		<wordasword>Hub</wordasword>&nbsp;?</phrase></para>

		<para>Rechercher dans le catalogue des paquets, la référence
		<acronym>pppoe</acronym>.</para>
	</question>
	<answer>
<screen><prompt>$</prompt> aptitude search pppoe
i   <emphasis>pppoe</emphasis>     - Pilote PPP sur Ethernet
p   pppoeconf - configures PPPoE/ADSL connections</screen>

		<para>Le résultat de la commande <command>aptitude show pppoe</command>
		montre que c'est bien ce paquet qui répond au besoin.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quel est le rôle de l'outil contenu dans le paquet
		demandé à la question précédente relativement au démon
		<command>pppd</command> fourni avec le paquet
		<application>ppp</application>&nbsp;?</phrase></para>

		<para>Rechercher dans les pages de manuels de l'outil demandé à la
		question précédente.</para>
	</question>
	<answer>
		<para>L'outil <command>pppoe-server</command> gère directement
		l'encapsulation des trames <acronym>PPP</acronym> dans les trames
		Ethernet. Il communique ensuite les paramètres utiles au démon
		<application>pppd</application> qui fonctionne de façon totalement
		transparente vis-à-vis de la technologie du réseau sous-jacent.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les noms des deux sous-couches du protocole
		<acronym>PPP</acronym> qui apparaissent dans les journaux
		systèmes&nbsp;?</phrase> Quels sont les rôles respectifs de ces deux
		sous-couches&nbsp;?</para>

		<para>Consulter la page &url.ppp-wikipedia;.</para>
	</question>
	<answer>
		<para>La consultation des journaux système lors du dialogue
		<acronym>PPP</acronym> fait apparaître des informations du type
		suivant.</para>

<screen>pppd[3262]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
kernel: [  895.700115] NET: Registered protocol family 24
pppd[3262]: rcvd [LCP ConfReq id=0x1 &lt;magic 0xcab9fecc>] <co xml:id='lcp'/>
pppd[3262]: sent [LCP ConfAck id=0x1 &lt;magic 0xcab9fecc>]
pppd[3262]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
pppd[3262]: rcvd [LCP ConfAck id=0x1 &lt;mru 1492> &lt;magic 0x46010ac>]
pppd[3262]: sent [LCP EchoReq id=0x0 magic=0x46010ac]
pppd[3262]: peer from calling number 52:54:00:12:34:05 authorized
pppd[3262]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0>] <co xml:id='ncp'/>
pppd[3262]: rcvd [LCP EchoReq id=0x0 magic=0xcab9fecc]
pppd[3262]: sent [LCP EchoRep id=0x0 magic=0x46010ac]
pppd[3262]: rcvd [IPCP ConfReq id=0x1 &lt;addr 10.0.0.1>]
pppd[3262]: sent [IPCP ConfAck id=0x1 &lt;addr 10.0.0.1>]
pppd[3262]: rcvd [LCP EchoRep id=0x0 magic=0xcab9fecc]
pppd[3262]: rcvd [IPCP ConfNak id=0x1 &lt;addr 10.67.15.1>]
pppd[3262]: sent [IPCP ConfReq id=0x2 &lt;addr 10.67.15.1>]
pppd[3262]: rcvd [IPCP ConfAck id=0x2 &lt;addr 10.67.15.1>]
pppd[3262]: local  IP address 10.67.15.1
pppd[3262]: remote IP address 10.0.0.1</screen>

		<calloutlist>
		<callout arearefs='lcp'>
		<para>La sous-couche <wordasword>Link Control Protocol</wordasword>
		(<acronym>LCP</acronym>) assure la configuration automatique des
		interfaces à chaque extrémité. Les paramètres négociés entre les deux
		hôtes en communication sont multiples&nbsp;: l'adaptation de la taille de
		datagramme, les caractères d'échappement, les numéros magiques et la
		sélection des options d'authentification.</para>
		</callout>
		<callout arearefs='ncp'>
		<para>La sous-couche <wordasword>Network Control Protocol</wordasword>
		(<acronym>NCP</acronym>) assure l'encapsulation de multiples protocoles
		de la couche réseau. Dans l'exemple donné, c'est le protocole
		<acronym>IPv4</acronym> qui est utilisé ; d'où l'acronyme
		<acronym>IPCP</acronym>.</para>
		</callout>
		</calloutlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les en-têtes du dialogue qui identifient les
		requêtes (émises|reçues), les rejets et les
		acquittements&nbsp;?</phrase></para>

		<para>Consulter les journaux système contenant les traces d'une
		connexion <acronym>PPP</acronym>.</para>
	</question>
	<answer>
		<para>La copie d'écran donnée ci-dessus fait apparaître les directives
		<literal>Conf*</literal> pour chaque paramètre négocié.</para>
		<itemizedlist>
		<listitem>
			<para><literal>ConfReq</literal> indique une requête.</para>
		</listitem>
		<listitem>
			<para><literal>ConfAck</literal> indique un acquittement.</para>
		</listitem>
		<listitem>
			<para><literal>ConfNak</literal> indique un rejet.</para>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Dans quel fichier sont stockés les paramètres d'identité
		et d'authentification utilisés par le protocole
		<acronym>CHAP</acronym>&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels du démon <command>pppd</command> à
		la section <citetitle>AUTHENTICATION</citetitle>.</para>
	</question>
	<answer>
		<para>C'est le fichier <filename>/etc/ppp/chap-secrets</filename> qui
		contient les couples <wordasword>login/password</wordasword> utilisés
		lors de l'authentification.</para>

		<para>Voici un exmple du contenu de ce fichier.</para>

<screen># Secrets for authentication using CHAP
# client	server	secret			IP addresses
"green"		*		"5p0k3"			*</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Dans quel fichier sont stockés les paramètres passés au
		démon <command>pppd</command> lors du lancement du serveur
		<acronym>PPPoE</acronym>&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels de l'outil
		<command>pppoe-server</command>.</para>
	</question>
	<answer>
		<para>C'est le fichier
		<filename>/etc/ppp/pppoe-server-options</filename> qui contient la
		liste des paramètres utilisés lors du dialogue
		<acronym>PPP</acronym>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les options du protocole
		<acronym>PPP</acronym> qui doivent être implantées dans le fichier
		demandé à la question précédente&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels du démon <command>pppd</command>
		et rechercher les paramètres correspondant à la liste suivante.</para>

		<itemizedlist>
		<listitem>
			<para>Afficher en détail toutes les étapes d'établissement de
			session dans les journaux système.</para>
		</listitem>
		<listitem>
			<para>Référencer l'identifiant du compte utilisateur à utiliser
			lors de l'authentification du routeur vert. Cette option implique
			que le compte utilisateur existe sur le système et qu'il soit
			présent dans le fichier
			<filename>/etc/ppp/chap-secrets</filename>.</para>
		</listitem>
		<listitem>
			<para>Imposer au routeur vert une authentification via le protocole
			<acronym>CHAP</acronym> (<wordasword>Challenge Handshake
			Authentication Protocol</wordasword>).</para>
		</listitem>
		<listitem>
			<para>Préserver la route par défaut, et donc l'accès Internet, du
			routeur bleu.</para>
		</listitem>
		<listitem>
			<para>Publier l'adresse <acronym>IP</acronym> du serveur
			<acronym>DNS</acronym> à utiliser pour la résolution des noms de
			domaines.</para>
		</listitem>
		<listitem>
			<para>Activer l'utilisation des protocoles
			<acronym>IPv6CP</acronym> et <acronym>IPv6</acronym>.</para>
		</listitem>
		</itemizedlist>
	</question>
	<answer>
		<para>Voici une copie du fichier
		<filename>/etc/ppp/pppoe-server-options</filename> qui contient la
		liste des paramètres demandés.</para>

<screen>debug
login
require-chap
nodefaultroute
ms-dns 172.16.0.2
+ipv6</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment créer le compte utilisateur local sur le routeur
		vert sachant qu'il n'est autorisé ni à se connecter ni à avoir un
		répertoire personnel&nbsp;?</phrase></para> 

		<para>Consulter les options de la commande
		<command>adduser</command>.</para>
	</question>
	<answer>
		<para>Voici un exemple de commande <command>adduser</command>.</para>

<screen><prompt>$</prompt> sudo adduser --disabled-login --no-create-home green</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les paramètres à donner au lancement de
		l'outil <command>pppoe-server</command> pour qu'il délivre les adresses
		au routeur vert après authentification de
		celui-ci&nbsp;?</phrase></para>

		<para>Consulter les options de la commande
		<command>pppoe-server</command>.</para>
	</question>
	<answer>
		<para>Voici un exemple de commande
		<command>pppoe-server</command>.</para>

<screen><prompt>$</prompt> sudo pppoe-server -I enp0s6.431 -C BRAS -L 10.4.31.1 -R 10.4.31.2 -N 1</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les résultats obtenus une fois que la session
		<acronym>PPP</acronym> est établie et que les adresses de couche réseau
		ont été délivrées&nbsp;?</phrase></para>

		<para>Consulter les journaux système, la liste des procsessus, l'état
		des interfaces réseau et de la table de routage.</para>

		<para>Attention ! Les résultats ne sont pertinents que si le dialogue
		avec le routeur vert est effectif.</para>
	</question>
	<answer>
		<itemizedlist>
		<listitem>
			<para>Consultation des journaux système.</para>

<screen>pppoe-server[2963]: Session 1 created for client b0:ad:ca:fe:00:65 (10.4.31.2) on enp0s6.431 using Service-Name ''
pppd[2963]: pppd 2.4.7 started by etu, uid 0
pppd[2963]: using channel 20
pppd[2963]: Using interface ppp0
pppd[2963]: Connect: ppp0 &lt;--> /dev/pts/0
pppd[2963]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0xc4220b37>]
pppd[2963]: rcvd [LCP ConfAck id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0xc4220b37>]
pppd[2963]: rcvd [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0xcca979aa>]
pppd[2963]: sent [LCP ConfAck id=0x1 &lt;mru 1492> &lt;magic 0xcca979aa>]
pppd[2963]: sent [LCP EchoReq id=0x0 magic=0xc4220b37]
pppd[2963]: sent [CHAP Challenge id=0x67 &lt;439a0c7ee25d6eead987864a45fd1331>, name = "bleu"]
pppd[2963]: rcvd [LCP EchoReq id=0x0 magic=0xcca979aa]
pppd[2963]: sent [LCP EchoRep id=0x0 magic=0xc4220b37]
pppd[2963]: rcvd [LCP EchoRep id=0x0 magic=0xcca979aa]
pppd[2963]: rcvd [CHAP Response id=0x67 &lt;dbe0795771fa077ec9010fb8efe13cee>, name = "green"]
pppd[2963]: sent [CHAP Success id=0x67 "Access granted"]
pppd[2963]: Initializing PAM (2) for user green
pppd[2963]: ---> PAM INIT Result = 0
pppd[2963]: Attempting PAM account checks
pppd[2963]: PAM Account OK for green
pppd[2963]: PAM Session opened for user green
pppd[2963]: user green logged in on tty  intf ppp0
pppd[2963]: local  LL address fe80::6c07:edbf:a0b4:f114
pppd[2963]: remote LL address fe80::89f5:1241:ad65:3b22
pppd[2963]: local  IP address 10.4.31.1
pppd[2963]: remote IP address 10.4.31.2</screen>
		</listitem>

		<listitem>
			<para>Liste des processus.</para>

<screen> pppoe-server -I enp0s6.431 -C BRAS -L 10.4.31.1 -R 10.4.31.2 -N 1
	\_ pppd pty /usr/sbin/pppoe -n -I enp0s6.431 -e 1:b0:ad:ca:fe:00:65 -S '' \
	   file /etc/ppp/pppoe-server-options 10.4.31.1:10.4.31.2 nodetach noaccomp \
	   nopcomp default-asyncmap mru 1492 mtu 1492
		\_ sh -c /usr/sbin/pppoe -n -I enp0s6.431 -e 1:b0:ad:ca:fe:00:65 -S ''
			\_ /usr/sbin/pppoe -n -I enp0s6.431 -e 1:b0:ad:ca:fe:00:65 -S</screen>
		</listitem>

		<listitem>
			<para>État des interfaces.</para>

<screen><prompt>$</prompt> $ ip addr ls dev enp0s6.431
6: enp0s6.431@enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether b0:ad:ca:fe:00:64 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::b2ad:caff:fefe:64/64 scope link
       valid_lft forever preferred_lft forever

<prompt>$</prompt> ip addr ls dev ppp0
26: ppp0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1492 qdisc pfifo_fast state UNKNOWN group default qlen 3
    link/ppp
    inet 10.4.31.1 peer 10.4.31.2/32 scope global ppp0
       valid_lft forever preferred_lft forever
    inet6 fe80::6c07:edbf:a0b4:f114/10 scope link
       valid_lft forever preferred_lft forever</screen>
		</listitem>

		<listitem>
			<para>Table de routage.</para>

<screen><prompt>$</prompt> ip route ls dev ppp0
10.4.31.2 proto kernel scope link src 10.4.31.1</screen>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les modifications à apporter au fichier de
		configuration système des interfaces réseau pour que l'ouverture de
		session <acronym>PPP</acronym> soit disponible après chaque
		réinitialisation&nbsp;?</phrase></para>

		<para>Consulter les pages de manuel du fichier
		<filename>/etc/network/interfaces</filename>&nbsp;: <userinput>man
		interfaces</userinput>.</para>
	</question>
	<answer>
	<para>Voici une copie du fichier dans le contexte de la maquette.</para>

<screen># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp0s6
iface enp0s6 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- VLAN ROUGE ----------
auto enp0s6.300
iface enp0s6.300 inet static
	address 10.141.0.162/27
	gateway 10.141.0.161
	dns-nameserver 9.9.9.9

iface enp0s6.300 inet6 static
	address 2001:678:3fc:12c::2/64
	gateway 2001:678:3fc:12c::1

# ---------- VLAN VIOLET ----------
auto enp0s6.430
iface enp0s6.430 inet6 static
	address fe80:1ae::1/64

# ---------- VLAN ORANGE ----------
auto enp0s6.431
iface enp0s6.431 inet manual
	up ip link set dev $IFACE up
	up pppoe-server -I $IFACE -C BRAS -L 10.4.31.1 -R 10.4.31.2 -N 1
	down killall pppoe-server
	down ip link set dev $IFACE down</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>
</sect1>

<sect1 xml:id='interco.pppoe-cloud.qa.server'>
	<title>Routeur vert</title>

	<sect2 xml:id='interco.pppoe-cloud.qa.vert.interfaces'>
		<title>Configuration des interfaces du routeur</title>

	<para>Une fois la machine virtuelle serveur de conteneurs lancée, les
	premières étapes consistent à lui attribuer un nouveau nom et à configurer
	les interfaces réseau pour joindre le routeur voisin et l'Internet.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Comment changer le nom de la machine virtuelle&nbsp;?</para>
	</question>
	<answer>
	<para>Il faut éditer les deux fichiers <filename>/etc/hosts</filename> et
	<filename>/etc/hostname</filename> en remplaçant le nom de l'image
	maître <citetitle>vm0</citetitle> par le nom voulu. Il est ensuite
	nécessaire de redémarrer pour que le nouveau nom soit pris en compte par
	tous les outils du système.</para>

<screen><prompt>etu@vm0:~$</prompt> sudo sed -i 's/vm0/vert/g' /etc/hosts
<prompt>etu@vm0:~$</prompt> sudo sed -i 's/vm0/vert/g' /etc/hostname
sudo: impossible de résoudre l'hôte vm0: Échec temporaire dans la résolution du nom
<prompt>etu@vm0:~$</prompt> sudo reboot</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para>Comment appliquer la configuration réseau <acronym>IPv4</acronym>
	et <acronym>IPv6</acronym> de l'interface du serveur&nbsp;?</para>

	<para>Consulter les pages de manuels du fichier de configuration système à
	l'aide de la commande <command>man&nbsp;interfaces</command>.</para>
	</question>
	<answer>
	<para>Il existe plusieurs possibilités pour configurer une interface
	réseau. Dans le contexte de ces manipulations, on utilise le fichier de
	configuration fourni par la distribution <citetitle>Debian
	GNU/Linux</citetitle>&nbsp;:
	<filename>/etc/network/interfaces</filename>.</para> 

	<para>La configuration de base fournie avec l'image maître suppose que
	l'interface obtienne un bail <acronym>DHCP</acronym> pour la partie
	<acronym>IPv4</acronym> et une configuration automatique via
	<acronym>SLAAC</acronym> pour la partie <acronym>IPv6</acronym>.</para>

	<para>La configuration par défaut doit être éditée et remplacée par une
	configuration manuelle pour l'interface <systemitem>enp0s6</systemitem> et
	pour le <acronym>VLAN</acronym> orange. Pour la supervision dans le
	<acronym>VLAN</acronym> violet, l'adresse <acronym>IPv6</acronym> de lien
	locale est fournie dans le tableau du plan d'adressage.</para>

	<para>En attendant que la configuration du routeur bleu soit prête, on
	ajoute temporairement une interface <systemitem>enp0s6.217</systemitem>
	avec une configuration automatique. Ainsi, il est possible d'installer et
	de configurer des services en parallèle. Cette interface doit être
	désactivée dès que tous les outils sont en place.</para>

	<para>Voici une copie du fichier
	<filename>/etc/network/interfaces</filename> de la maquette.</para>

<screen># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp0s6
iface enp0s6 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- VLAN VIOLET ----------
auto enp0s6.430
iface enp0s6.430 inet6 static
	address fe80:1ae::2/64

# ---------- VLAN ORANGE ----------
auto enp0s6.431
iface enp0s6.431 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

auto enp0s6.217
iface enp0s6.217 inet dhcp</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.ppp'>
		<title>Activation du protocole PPP dans le VLAN orange</title>

	<para>Le routeur vert utilise un démon <application>pppd</application> sur
	le <acronym>VLAN</acronym> <option>Data</option> pour établir une session
	<acronym>PPP</acronym> avec le routeur bleu. À la différence de ce dernier,
	il n'est pas à l'initiative du dialogue <acronym>PPPoE</acronym> mais il
	doit être capable de gérer l'encapsulation des trames
	<acronym>PPP</acronym> sur un réseau local Ethernet.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
		<para><phrase>Quel paquet fournit le démon de gestion des sessions du
		protocole <acronym>PPP</acronym> sur le routeur
		vert&nbsp;?</phrase></para>

		<para>Rechercher dans le catalogue des paquets, la référence
		<acronym>ppp</acronym>.</para>
	</question>
	<answer>
<screen><prompt>$</prompt> aptitude search ^ppp
i   <emphasis>ppp</emphasis>               - Point-to-Point Protocol (PPP) - daemon
p   ppp-dev           - Point-to-Point Protocol (PPP) - development fil
p   ppp-gatekeeper    - PPP manager for handling balanced, redundant an
p   pppoe             - PPP over Ethernet driver
p   pppoeconf         - configures PPPoE/ADSL connections</screen>

		<para>Le résultat de la commande <command>aptitude show ppp</command>
		montre que c'est bien ce paquet qui répond au besoin.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment utiliser l'encapsulation des trames
		<acronym>PPP</acronym> dans Ethernet à partir du démon
		<command>pppd</command> fourni avec le paquet
		<application>ppp</application>&nbsp;?</phrase></para>

		<para>Rechercher dans le répertoire de documentation du paquet
		<application>ppp</application>.</para>
	</question>
	<answer>
		<para>Dans le répertoire <filename
		class='directory'>/usr/share/doc/ppp/</filename>, on trouve le fichier
		<filename>README.pppoe</filename> qui indique que l'appel au module
		<filename>rp-pppoe.so</filename> permet d'encapsuler des trames
		<acronym>PPP</acronym> sur un réseau local Ethernet.</para>

		<para>Toujours à partir du même répertoire, on trouve dans la liste des
		fichiers d'exemples de configuration un modèle adapté à notre contexte
		:&nbsp;<filename>peers-pppoe</filename>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Dans quel fichier sont stockés les paramètres d'identité
		et d'authentification utilisés par le protocole
		<acronym>CHAP</acronym>&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels du démon <command>pppd</command> à
		la section <citetitle>AUTHENTICATION</citetitle>.</para>
	</question>
	<answer>
		<para>C'est le fichier <filename>/etc/ppp/chap-secrets</filename> qui
		contient les couples <wordasword>login/password</wordasword> utilisés
		lors de l'authentification.</para>

		<para>Voici un exemple du contenu de ce fichier. Le nom du client ainsi
		que son mot de passe secret doivent être identiques à chaque extrémité
		de la session <acronym>PPP</acronym>.</para>

<screen># Secrets for authentication using CHAP
# client	server	secret			IP addresses
"green"		*		"5p0k3"			*</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les options de configuration du démon
		<command>pppd</command> à placer dans le fichier
		<filename>/etc/ppp/peers/pppoe-provider</filename> pour assurer
		l'établissement de la session <acronym>PPP</acronym> entre les
		routeurs&nbsp;?</phrase></para>

		<para>Utiliser le fichier exemple <acronym>PPPoE</acronym> fourni avec
		la documentation du paquet <application>ppp</application>.</para>
	</question>
	<answer>
		<para>Voici une copie du fichier
		<filename>/etc/ppp/peers/pppoe-provider</filename> avec les options
		correspondant au contexte de la maquette du routeur vert.</para>

<screen># There should be a matching entry with the password in /etc/ppp/chap-secrets.
user "green"

# Load the PPPoE plugin.
plugin rp-pppoe.so

# Ethernet interface to which the modem is connected.
enp0s6.431

# Assumes that your IP address is allocated dynamically by the ISP.
noipdefault
# Try to get the name server addresses from the ISP.
usepeerdns
# Use this connection as the default route.
defaultroute

# Makes pppd "dial again" when the connection is lost.
persist

# Do not ask the remote to authenticate.
noauth

debug
+ipv6</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment lancer le démon <command>pppd</command> pour
		qu'il prenne en compte les paramètres définis dans le fichier complété
		à la question précédente&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels du démon
		<command>pppd</command>.</para>
	</question>
	<answer>
		<para>C'est l'option <option>file</option> qui permet de désigner le
		fichier de configuration à utiliser. Voici une copie d'écran du
		lancement de <command>pppd</command>.</para>

<screen><prompt>$</prompt> sudo pppd file /etc/ppp/peers/pppoe-provider</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les noms des deux sous-couches du protocole
		<acronym>PPP</acronym> qui apparaissent dans les journaux
		systèmes&nbsp;?</phrase> Quels sont les rôles respectifs de ces deux
		sous-couches&nbsp;?</para>

		<para>Consulter la page &url.ppp-wikipedia;.</para>
	</question>
	<answer>
		<para>La consultation des journaux système lors du dialogue
		<acronym>PPP</acronym> fait apparaître des informations
		suivantes.</para>

<screen>pppd[2272]: Plugin rp-pppoe.so loaded.
pppd[2273]: pppd 2.4.7 started by etu, uid 0
pppd[2273]: Send PPPOE Discovery V1T1 PADI session 0x0 length 4
pppd[2273]:  dst ff:ff:ff:ff:ff:ff  src b0:ad:ca:fe:00:65
pppd[2273]:  [service-name]
pppd[2273]: Recv PPPOE Discovery V1T1 PADO session 0x0 length 36
pppd[2273]:  dst b0:ad:ca:fe:00:65  src b0:ad:ca:fe:00:64
pppd[2273]:  [AC-name BRAS] [service-name] [AC-cookie  f9 fc 4d 12 f1 13 03 f3 bd e8 34 7b 83 d5 2e bf 5b 0b 00 00]
pppd[2273]: Send PPPOE Discovery V1T1 PADR session 0x0 length 28
pppd[2273]:  dst b0:ad:ca:fe:00:64  src b0:ad:ca:fe:00:65
pppd[2273]:  [service-name] [AC-cookie  f9 fc 4d 12 f1 13 03 f3 bd e8 34 7b 83 d5 2e bf 5b 0b 00 00]
pppd[2273]: Recv PPPOE Discovery V1T1 PADS session 0x1 length 4
pppd[2273]:  dst b0:ad:ca:fe:00:65  src b0:ad:ca:fe:00:64
pppd[2273]:  [service-name]
pppd[2273]: PADS: Service-Name: ''
pppd[2273]: PPP session is 1
pppd[2273]: Connected to b0:ad:ca:fe:00:64 via interface enp0s6.431
pppd[2273]: using channel 19
pppd[2273]: Using interface ppp0
pppd[2273]: Connect: ppp0 &lt;--> enp0s6.431
pppd[2273]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0xc8ff53a8>]
pppd[2273]: rcvd [LCP ConfReq id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0x11d42bb4>]
pppd[2273]: sent [LCP ConfAck id=0x1 &lt;mru 1492> &lt;auth chap MD5> &lt;magic 0x11d42bb4>]
pppd[2273]: sent [LCP ConfReq id=0x1 &lt;mru 1492> &lt;magic 0xc8ff53a8>]
pppd[2273]: rcvd [LCP ConfAck id=0x1 &lt;mru 1492> &lt;magic 0xc8ff53a8>]
pppd[2273]: sent [LCP EchoReq id=0x0 magic=0xc8ff53a8]
pppd[2273]: rcvd [LCP EchoReq id=0x0 magic=0x11d42bb4]
pppd[2273]: sent [LCP EchoRep id=0x0 magic=0xc8ff53a8]
pppd[2273]: rcvd [CHAP Challenge id=0xde &lt;208dcd62a1589d928f94e384cdb43910eb9b03bf9b0ac0>, name = "bleu"]
pppd[2273]: sent [CHAP Response id=0xde &lt;32bb85b4fa53e24b73a4137db04278e6>, name = "green"]
pppd[2273]: rcvd [LCP EchoRep id=0x0 magic=0x11d42bb4]
pppd[2273]: rcvd [CHAP Success id=0xde "Access granted"]
pppd[2273]: <emphasis>CHAP authentication succeeded: Access granted</emphasis>
pppd[2273]: CHAP authentication succeeded
pppd[2273]: peer from calling number B0:AD:CA:FE:00:64 authorized
pppd[2273]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0> &lt;ms-dns1 0.0.0.0> &lt;ms-dns2 0.0.0.0>]
pppd[2273]: sent [IPV6CP ConfReq id=0x1 &lt;addr fe80::adfa:a20d:dbba:3553>]
pppd[2273]: rcvd [CCP ConfReq id=0x1 &lt;deflate 15> &lt;deflate(old#) 15> &lt;bsd v1 15>]
pppd[2273]: sent [CCP ConfReq id=0x1]
pppd[2273]: sent [CCP ConfRej id=0x1 &lt;deflate 15> &lt;deflate(old#) 15> &lt;bsd v1 15>]
pppd[2273]: rcvd [IPCP ConfReq id=0x1 &lt;compress VJ 0f 01> &lt;addr 10.4.31.1>]
pppd[2273]: sent [IPCP ConfRej id=0x1 &lt;compress VJ 0f 01>]
pppd[2273]: rcvd [IPV6CP ConfReq id=0x1 &lt;addr fe80::f558:469f:1034:fd29>]
pppd[2273]: sent [IPV6CP ConfAck id=0x1 &lt;addr fe80::f558:469f:1034:fd29>]
pppd[2273]: rcvd [IPCP ConfNak id=0x1 &lt;addr 10.4.31.2> &lt;ms-dns1 172.16.0.2> &lt;ms-dns2 172.16.0.2>]
pppd[2273]: sent [IPCP ConfReq id=0x2 &lt;addr 10.4.31.2> &lt;ms-dns1 172.16.0.2> &lt;ms-dns2 172.16.0.2>]
pppd[2273]: rcvd [IPV6CP ConfAck id=0x1 &lt;addr fe80::adfa:a20d:dbba:3553>]
pppd[2273]: local  LL address fe80::adfa:a20d:dbba:3553
pppd[2273]: remote LL address fe80::f558:469f:1034:fd29
pppd[2273]: Script /etc/ppp/ipv6-up started (pid 2280)
pppd[2273]: rcvd [CCP ConfAck id=0x1]
pppd[2273]: rcvd [CCP ConfReq id=0x2]
pppd[2273]: sent [CCP ConfAck id=0x2]
pppd[2273]: rcvd [IPCP ConfReq id=0x2 &lt;addr 10.4.31.1>]
pppd[2273]: sent [IPCP ConfAck id=0x2 &lt;addr 10.4.31.1>]
pppd[2273]: rcvd [IPCP ConfAck id=0x2 &lt;addr 10.4.31.2> &lt;ms-dns1 172.16.0.2> &lt;ms-dns2 172.16.0.2>]
pppd[2273]: not replacing default route to enp0s6.217 [172.16.99.1]
pppd[2273]: local  IP address 10.4.31.2
pppd[2273]: remote IP address 10.4.31.1
pppd[2273]: primary   DNS address 172.16.0.2
pppd[2273]: secondary DNS address 172.16.0.2
pppd[2273]: Script /etc/ppp/ip-up started (pid 2282)
pppd[2273]: Script /etc/ppp/ipv6-up finished (pid 2280), status = 0x0
pppd[2273]: Script /etc/ppp/ip-up finished (pid 2282), status = 0x0</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quels sont les en-têtes du dialogue qui identifient les
		requêtes (émises|reçues), les rejets et les
		acquittements&nbsp;?</phrase></para>

		<para>Consulter les journaux système contenant les traces d'une
		connexion <acronym>PPP</acronym>.</para>
	</question>
	<answer>
		<para>La copie d'écran donnée ci-dessus fait apparaître les directives
		<literal>Conf*</literal> pour chaque paramètre négocié.</para>
		<itemizedlist>
		<listitem>
			<para><literal>ConfReq</literal> indique une requête.</para>
		</listitem>
		<listitem>
			<para><literal>ConfAck</literal> indique un acquittement.</para>
		</listitem>
		<listitem>
			<para><literal>ConfNak</literal> indique un rejet.</para>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les modifications à apporter au fichier
		système de configuration des interfaces réseau pour ouvrir la session
		<acronym>PPP</acronym> à chaque réinitialisation
		système&nbsp;?</phrase></para>

		<para>Consulter les pages de manuel du fichier
		<filename>/etc/network/interfaces</filename>&nbsp;: <userinput>man
		interfaces</userinput>.</para>
	</question>
	<answer>
		<para>Voici une copie du fichier modifié dans le contexte de la
		maquette.</para>
<screen># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp0s6
iface enp0s6 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- VLAN VIOLET ----------
auto enp0s6.430
iface enp0s6.430 inet6 static
	address fe80:1ae::2/64

# ---------- VLAN ORANGE ----------
auto enp0s6.431
iface enp0s6.431 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- PPPoE ---------------
auto pppoe-provider
iface pppoe-provider inet ppp
        pre-up ifup enp0s6.431
        provider pppoe-provider

#auto enp0s6.217
#iface enp0s6.217 inet dhcp</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.ovs'>
		<title>Activation du commutateur virtuel asw-host</title>

	<para>Dans le scénario étudié, les services sont hébergés dans un réseau de
	conteneurs propre au routeur vert. La mise en œuvre de cette configuration
	passe par l'installation d'un commutateur virtuel appelé
	<systemitem>asw-host</systemitem>. On utilise <application>Open
	vSwitch</application> pour configurer ce commutateur.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para><phrase>Quel est le paquet à installer pour pouvoir ajouter un
	commutateur virtuel au routeur vert&nbsp;?</phrase></para>

	<para>Rechercher le mot clé <application>openvswitch</application> dans la
	liste des paquets.</para>
	</question>
	<answer>
	<para>Voici un exemple de recherche.</para>
<screen><prompt>$</prompt> sudo aptitude search ^openvswitch
p   openvswitch-common           - Open vSwitch common components
p   openvswitch-dbg              - Debug symbols for Open vSwitch packages
p   openvswitch-dev              - Open vSwitch development package
p   openvswitch-ipsec            - Open vSwitch IPsec tunneling support
p   openvswitch-pki              - Open vSwitch public key infrastructure dependency package
p   <emphasis>openvswitch-switch</emphasis>           - Open vSwitch switch implementations
p   openvswitch-switch-dpdk      - DPDK enabled Open vSwitch switch implementation
v   openvswitch-test             -
p   openvswitch-testcontroller   - Simple controller for testing OpenFlow setups
p   openvswitch-vtep             - Open vSwitch VTEP utilities</screen>

	<para>C'est le paquet <systemitem>openvswitch-switch</systemitem> qui nous
	intéresse.</para>
<screen><prompt>$</prompt> sudo apt install openvswitch-switch</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Quel est le fichier de documentation qui fournit les
	directives de configuration d'un commutateur intégré au fichier système
	<filename>/etc/network/interfaces</filename>&nbsp;?</phrase></para>

	<para>Rechercher dans la liste des fichiers des paquets installés à la
	question précédente.</para>
	</question>
	<answer>
	<para>Voici un exemple de recherche.</para>
<screen><prompt>$</prompt> dpkg -L openvswitch-switch | grep README
/usr/share/doc/openvswitch-switch/README.Debian.gz</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Quelles sont les modiifications à apporter au fichier
	<filename>/etc/network/interfaces</filename> pour configurer le commutateur
	<systemitem>asw-host</systemitem>&nbsp;?</phrase></para>
	</question>
	<answer>
	<para>Voici une copie du fichier de configuration réseau système dans le
	contexte de la maquette.</para>

<screen># This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp0s6
iface enp0s6 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- VLAN VIOLET ----------
auto enp0s6.430
iface enp0s6.430 inet6 static
	address fe80:1ae::2/64

# ---------- VLAN ORANGE ----------
auto enp0s6.431
iface enp0s6.431 inet manual
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

# ---------- PPPoE ----------------
auto pppoe-provider
iface pppoe-provider inet ppp
        pre-up ifup enp0s6.431
        provider pppoe-provider

#auto enp0s6.217
#iface enp0s6.217 inet dhcp

# ---------- VLAN VERT ------------
allow-ovs asw-host
iface asw-host inet manual
	ovs_type OVSBridge
	ovs_ports sw-vlan40
	up ip link set dev $IFACE up
	down ip link set dev $IFACE down

allow-asw-host sw-vlan40
iface sw-vlan40 inet static
	ovs_type OVSBridge
	ovs_bridge asw-host
	ovs_options asw-host 40
	address 203.0.113.1/24

iface sw-vlan40 inet6 static
	ovs_type OVSBridge
	ovs_bridge asw-host
	ovs_options asw-host 40
	address fda0:7a62:28::1/64</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>

	<sect2 xml:id='interco.pppoe-cloud.qa.bleu.radvd'>
		<title>Activation de la configuration IPv6 automatique pour le réseau
		de conteneurs</title>

	<para>Pour que les hôtes du réseau de conteneurs obtiennent automatiquement
	une configuration <acronym>IPv6</acronym>, il faut que le routeur assure
	les annonces auprès de ces voisins. Un moyen simple pour assurer la
	configuration <acronym>SLAAC</acronym> des hôtes voisins du routeur
	consiste à utiliser le paquet <application>radvd</application>.</para> 

	<para>On débute par l'installation de ce paquet.</para>

<screen><prompt>$</prompt> sudo apt install radvd
...
Préparation du dépaquetage de .../radvd_1%3a2.17-2+b1_amd64.deb ...
Dépaquetage de radvd (1:2.17-2+b1) ...
Paramétrage de radvd (1:2.17-2+b1) ...
Job for radvd.service failed because the control process exited with error code.
See "systemctl status radvd.service" and "journalctl -xe" for details.
invoke-rc.d: initscript radvd, action "start" failed.
● radvd.service - Router advertisement daemon for IPv6
     Loaded: loaded (/lib/systemd/system/radvd.service; disabled; vendor preset: enabled)
     <emphasis>Active: failed</emphasis> (Result: exit-code) since Sun 2020-09-13 22:32:10 CEST; 17ms ago
       Docs: man:radvd(8)
    Process: 2814 ExecStartPre=/usr/sbin/radvd --logmethod stderr_clean --configtest (code=exited, status=1/FAILURE)</screen>

	<para>On voit que le lancement du service a échoué.</para>

	<qandaset defaultlabel='number'>
	<qandaentry>
	<question>
	<para>Comment configurer le service <application>radvd</application> pour
	publier les annonces côté conteneurs&nbsp;?</para>

	<para>Rechercher les options utiles dans les pages de manuel du
	service&nbsp;: <userinput>man radvd.conf</userinput>.</para>
	</question>
	<answer>
	<para>Voici une copie du fichier de configuration
	<filename>/etc/radvd.conf</filename> de la maquette.</para>

<screen>interface sw-vlan40
{
        AdvSendAdvert on;

        prefix fda0:7a62:28::/64
        {
                AdvOnLink on;
                AdvAutonomous on;
                AdvRouterAddr on;
        };

        RDNSS 2620:fe::fe
        {
        };
};</screen>

	<para>Attention ! Une fois le fichier créé, il ne faut pas oublier de
	redémarrer le service et de contrôler l'état de son fonctionnement.</para>

<screen><prompt>$</prompt> sudo systemctl enable radvd
<prompt>$</prompt> sudo systemctl restart radvd
<prompt>$</prompt> systemctl status radvd
● radvd.service - Router advertisement daemon for IPv6
     Loaded: loaded (/lib/systemd/system/radvd.service; disabled; vendor preset: enabled)
     Active: <emphasis>active (running)</emphasis> since Sun 2020-09-13 22:39:34 CEST; 5s ago
       Docs: man:radvd(8)
    Process: 2890 ExecStartPre=/usr/sbin/radvd --logmethod stderr_clean --configtest (code=exited, status=0/SUCCESS)
    Process: 2891 ExecStart=/usr/sbin/radvd --logmethod stderr_clean (code=exited, status=0/SUCCESS)
   Main PID: 2892 (radvd)
      Tasks: 2 (limit: 1142)
     Memory: 1.3M
     CGroup: /system.slice/radvd.service
             ├─2892 /usr/sbin/radvd --logmethod stderr_clean
             └─2893 /usr/sbin/radvd --logmethod stderr_clean

sept. 13 22:39:34 rtr systemd[1]: Starting Router advertisement daemon for IPv6...
sept. 13 22:39:34 rtr radvd[2890]: config file, /etc/radvd.conf, syntax ok
sept. 13 22:39:34 rtr radvd[2891]: version 2.17 started
sept. 13 22:39:34 rtr systemd[1]: Started Router advertisement daemon for IPv6.</screen>
	</answer>
	</qandaentry>
	</qandaset>
	</sect2>
</sect1>
</article>
