<?xml version='1.0'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
	"/usr/share/xml/docbook/schema/dtd/5.0/docbook.dtd"[

<!ENTITY author		SYSTEM "author.xml">
<!ENTITY legal		SYSTEM "legal.xml">

<!-- inetdoc -->
<!ENTITY % inetdoc_urls SYSTEM 'inetdoc.urls.xml'>
%inetdoc_urls;

<!ENTITY url.quagga-command-index
	'<link xmlns="http://docbook.org/ns/docbook"
	xlink:href="https://www.nongnu.org/quagga/docs/docs-multi/Command-Index.html">
	<citetitle>Quagga Command Index</citetitle></link>'>

<!-- openvswitch -->
<!ENTITY url.ovs
	"<link xmlns='http://docbook.org/ns/docbook'
	xlink:href='http://openvswitch.org'>Open vSwitch</link>">

<!ENTITY url.cam
	'<link xmlns="http://docbook.org/ns/docbook" xlink:href="https://en.wikipedia.org/wiki/Content-addressable_memory">
	<citetitle>Content-addressable memory</citetitle></link>'>

<!ENTITY % w3centities-f PUBLIC "-//W3C//ENTITIES Combined Set//EN//XML"
	"http://www.w3.org/2003/entities/2007/w3centities-f.ent">
%w3centities-f;
]>

<article xml:id='interco.ospf-quagga' xml:lang='fr'>

<info>
	<title>Introduction au routage dynamique OSPF avec Quagga</title>

	&author;
	<abstract>
	<para>
	<informaltable frame='none' pgwide='1'>
	<tgroup cols='2' align='left' colsep='0' rowsep='0'>
	<colspec colwidth='5*'/>
	<colspec colwidth='220px'/>
	<tbody>
    <row>
    <entry valign='top'>
	<para>L'objectif de ce support de travaux pratiques est d'étudier le
	protocole de routage dynamique <acronym>OSPF</acronym>. Cette illustration
	s'appuie sur une topologie minimale très classique&nbsp;: le triangle.
	L'originalité consiste à utiliser les <acronym>VLAN</acronym>s pour
	distinguer la topologie physique (l'étoile) de la topologie logique (le
	triangle). Cette version du support utilise la suite de démons de routage
	<application>Quagga</application>.</para>
	</entry>
	<entry>
	<inlinemediaobject>
	<imageobject role='html'>
		<imagedata fileref='images/interco.ospf.physical-topology.png' format='PNG' width='220px' scalefit='1'/>
	</imageobject>
	<imageobject role='fo'>
		<imagedata fileref='images/interco.ospf.physical-topology.png' format='PNG' width='4.5cm' scalefit='1'/>
	</imageobject>
	</inlinemediaobject>
	</entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>
	</para>
	</abstract>

	<keywordset>
	<keyword>kvm</keyword>
	<keyword>openvswitch</keyword>
	<keyword>ospf</keyword>
	<keyword>qemu</keyword>
	<keyword>quagga</keyword>
	<keyword>routage</keyword>
	<keyword>trunk</keyword>
	<keyword>vlan</keyword>
	<keyword>zebra</keyword>
	</keywordset>
</info>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.legal.meta'>
	&legal;

<sect2 xml:id='interco.ospf-quagga.meta'>
	<title>Méta-information</title>
    
	<para>Ce document est écrit avec <link
	xlink:href="http://www.docbook.org"><citetitle>DocBook</citetitle></link>
	XML sur un système <link
	xlink:href="https://www.debian.org"><citetitle>Debian
	GNU/Linux</citetitle></link>. Il est disponible en version imprimable au
	format PDF&nbsp;: <link
	xlink:href="https://www.inetdoc.net/pdf/__printbasename__"><literal>__printbasename__</literal></link>.</para>

	<para>Toutes les commandes utilisées dans ce document ne sont pas
	spécifiques à une version particulière des systèmes UNIX ou GNU/Linux.
	C'est la distribution <citetitle>Debian GNU/Linux</citetitle> qui est
	utilisée pour les tests présentés. Voici une liste des paquets contenant
	les commandes&nbsp;:</para>

	<itemizedlist>
	<listitem>
		<para><application>procps</application> - Utilitaires pour le système
		de fichiers /proc</para>
	</listitem>
	<listitem>
		<para><application>iproute2</application> - Outils de contrôle du
		trafic et	du réseau</para>
	</listitem>
	<listitem>
		<para><application>ifupdown</application> - Outils de haut niveau pour
		configurer les interfaces réseau</para>
	</listitem>
	<listitem>
		<para><application>iputils-ping</application> - Outils pour tester
		l'accessibilité de noeuds réseaux</para>
	</listitem>
	<listitem>
		<para><application>quagga</application> - BGP/OSPF/RIP routing
		daemon</para>
	</listitem>
	</itemizedlist>

	<para>La suite de démons de routage <application>Quagga</application>
	couvre la totalité des protocoles de routage dynamiques. Ici, on se
	concentre sur le protocole <acronym>OSPF</acronym>. C'est la raison pour
	laquelle, seuls trois paquets sont utiles.</para>

	<itemizedlist>
	<listitem>
		<para><application>quagga-core</application>&nbsp;: démon de routage
		statique <application>zebra</application> et console unifiée
		<application>vtysh</application>.</para>
	</listitem>
	<listitem>
		<para><application>quagga-ospfd</application>&nbsp;: démon du protocole de
		routage <acronym>OSPFv2</acronym> pour <acronym>IPv4</acronym>.</para>
	</listitem>
	<listitem>
		<para><application>quagga-ospf6d</application>&nbsp;: démon du protocole de
		routage <acronym>OSPFv3</acronym> pour <acronym>IPv6</acronym>.</para>
	</listitem>
	</itemizedlist>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/quagga-daemons.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/quagga-daemons.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Synoptique des démons Quagga</phrase>
	</textobject>
	</mediaobject>
	</sect2>

	<sect2 xml:id='interco.ospf-quagga.convtypo'>
		<title>Conventions typographiques</title>

	<para>Tous les exemples d'exécution des commandes sont précédés d'une
	invite utilisateur ou <wordasword>prompt</wordasword> spécifique au niveau
	des droits utilisateurs nécessaires sur le système.</para>

	<itemizedlist>
	<listitem>
		<para>Toute commande précédée de l'invite <prompt>$</prompt> ne
		nécessite aucun privilège particulier et peut être utilisée au niveau
		utilisateur simple.</para>
	</listitem>
	<listitem>
		<para>Toute commande précédée de l'invite <prompt>#</prompt> nécessite
		les privilèges du super-utilisateur.</para>
	</listitem>
	</itemizedlist>
</sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.archi'>
	<title>Topologie réseau étudiée</title>

	<para>La topologie réseau étudiée peut être présentée sous deux formes
	distinctes&nbsp;: logique et physique.</para>
 
	<variablelist>
	<varlistentry xml:id='interco.ospf-quagga.topologie.logique'>
		<term>Topologie logique</term>
	<listitem>
		<para>On retrouve un grand classique dans l'introduction aux protocoles
		de routage dynamiques&nbsp;: le triangle. Tous les liens sont de type
		<acronym>LAN</acronym>.</para>
	</listitem>
	</varlistentry>
	<varlistentry xml:id='interco.ospf-quagga.topologie.physique'>
		<term>Topologie physique</term>
	<listitem>
		<para>On s'appuie sur le support &url.inter-vlan-routing; pour
		constituer une topologie physique à base de réseaux locaux virtuels ou
		<acronym>VLAN</acronym>s. On fait correspondre à chaque lien de la
		topologie logique en triangle un numéro de <acronym>VLAN</acronym>
		défini.</para>
	</listitem>
	</varlistentry>
	</variablelist>

	<table xml:id='interco.ospf-quagga.archi.topologie.table' frame='all' pgwide='1'>
		<title>Topologies type</title>
	<tgroup cols='2'>
		<colspec colnum='1' colwidth='1*'/>
		<colspec colnum='2' colwidth='1*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Topologie logique</entry>
		<entry>Topologie physique</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry valign='middle' align='center'>
		<mediaobject>
		<imageobject role='fo'>
			<imagedata format='PNG' fileref='images/interco.ospf.logical-topology.png' width='7cm' scalefit='1' />
		</imageobject>
		<imageobject role='html'>
			<imagedata format='PNG' fileref='images/interco.ospf.logical-topology.png' width='320px' scalefit='1' />
		</imageobject>
		<textobject>
			<phrase>Topologie logique triangle</phrase>
		</textobject>
		</mediaobject>
		</entry>
		<entry valign='middle' align='center'>
		<mediaobject>
		<imageobject role='fo'>
			<imagedata format='PNG' fileref='images/interco.ospf.physical-topology.png' width='7cm' scalefit='1' />
		</imageobject>
		<imageobject role='html'>
			<imagedata format='PNG' fileref='images/interco.ospf.physical-topology.png' width='320px' scalefit='1' />
		</imageobject>
		<textobject>
			<phrase>Topologie physique étoile</phrase>
		</textobject>
		</mediaobject>
		</entry>
	</row>
	</tbody>
	</tgroup>
	</table>

	<para>Après avoir mis en œuvre la topologie physique en s'appuyant sur le
	support de la séance de travaux pratiques précédente&nbsp;:
	&url.inter-vlan-routing;, on implante les démons de routage
	<acronym>OSPF</acronym> sur les trois routeurs R1, R2 et R3.</para>

	<para>Cette séance se limite à l'étude du routage dynamique à l'intérieur
	d'une aire unique. La seule «frontière» de communication inter-aires
	visible est constituée par le lien vers l'Internet. Cette route par défaut
	sera redistribuée via <acronym>OSPF</acronym> par le routeur R1 aux autres
	routeurs. On verra alors un exemple de route externe dans les bases de
	données <acronym>OSPF</acronym>.</para>

	<para>On profite aussi de cette introduction pour employer une technique
	très répandue pour ajouter «artificiellement» des entrées de tables de
	routage en s'appuyant sur des interfaces virtuelles de type
	<wordasword>dummy</wordasword> équivalentes à des interfaces de boucle
	locale.</para>

	<para>Pour les besoins de rédaction des questions et réponses de ce
	support, la topologie a été mise en œuvre sur des machines virtuelles
	<acronym>KVM</acronym> avec le commutateur <citetitle>Open
	vSwitch</citetitle>. Les éléments de correction des questions dépendent
	donc de cette mise en œuvre. Pour la séance de travaux pratiques «réelle»,
	il faut se conformer strictement au plan d'adressage fourni
	ci-après.</para>

	<para>Dans les manipulations à suivre, le raccordement au réseau
	d'interconnexion avec les routeurs de l'infrastructure de travaux pratiques
	est imposé. Le raccordement au commutateur de la couche distribution de la
	salle utilise le port «de numéro le plus élevé» de chaque commutateur de
	couche accès. Ces liens montants doivent être configurés en
	mode<wordasword>trunk</wordasword> en utilisant le <acronym>VLAN</acronym>
	natif numéro 1.</para>

	<para>Point important, la lecture de la section «Plan d'adressage» du
	document &url.infra.tp; donne l'adresse des deux routeurs connectés à
	l'Internet.</para>

	<itemizedlist>
	<listitem>
	<para>Routeur <systemitem
	class='systemname'>cooper.stri</systemitem>&nbsp;: <systemitem
	class='ipaddress'>172.16.16.1/20</systemitem> et <systemitem
	class='ipaddress'>2001:678:3fc:4::1/64</systemitem></para>
	</listitem>
	<listitem>
	<para>Routeur <systemitem
	class='systemname'>casper.stri</systemitem>&nbsp;: <systemitem
	class='ipaddress'>172.16.16.2/20</systemitem> et <systemitem
	class='ipaddress'>2001:678:3fc:4::2/64</systemitem></para>
	</listitem>
	</itemizedlist>

<?custom-pagebreak?>
<sect2 xml:id='interco.ospf-quagga.archi.adressage-211'>
	<title>Plan d'adressage salle 211</title>

<table xml:id='interco.ospf-quagga.211.switches' frame='all' pgwide='1'>
    <title>Affectation d'un commutateur par groupe de 3 routeurs - salle 211</title>
	<tgroup cols='2' align='center' colsep='1' rowsep='1'>
	<colspec colnum='1' colwidth='1*'/>
	<colspec colnum='2' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Groupe</entry>
		<entry>Commutateur</entry>
	</row>
    </thead>
    <tbody>
	<row>
		<entry valign='middle'>1</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw04-211.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>2</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw05-211.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>3</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw06-211.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>4</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw07-211.infra.stri</systemitem></entry>
	</row>
	</tbody>
	</tgroup>
</table>

	<para>Voici, pour chaque groupe de trois routeurs, le tableau d'affectation
	des rôles, des numéros de VLANs et des adresses IP.</para>

<table xml:id='quagga.lab.211-g1-addressing' frame='all' pgwide='1'>
	<title>Salle 211 - Groupe 1</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>christophsis</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.211.4.11
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.11</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.10/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6ae</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>401</entry>
		<entry morerows='1' valign='middle'>eth0.401</entry>
		<entry><systemitem class='ipaddress'>10.1.201.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:191::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>405</entry>
		<entry morerows='1' valign='middle'>eth0.405</entry>
		<entry><systemitem class='ipaddress'>10.1.205.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:195::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.1.200.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:190::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>corellia</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.12
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.12</entry>
		<entry morerows='1' valign='middle' align='right'>401</entry>
		<entry morerows='1' valign='middle'>eth0.401</entry>
		<entry><systemitem class='ipaddress'>10.1.201.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:191::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>403</entry>
		<entry morerows='1' valign='middle'>eth0.403</entry>
		<entry><systemitem class='ipaddress'>10.1.203.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:193::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.202.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.1.202.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:192::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:192::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>delaya</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.13
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.13</entry>
		<entry morerows='1' valign='middle' align='right'>405</entry>
		<entry morerows='1' valign='middle'>eth0.405</entry>
		<entry><systemitem class='ipaddress'>10.1.205.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:195::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>403</entry>
		<entry morerows='1' valign='middle'>eth0.403</entry>
		<entry><systemitem class='ipaddress'>10.1.203.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:193::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.204.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.1.204.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:194::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:194::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.211-g2-addressing' frame='all' pgwide='1'>
	<title>Salle 211 - Groupe 2</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>kashyyyk</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.211.4.21
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.21</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.11/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6af</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>411</entry>
		<entry morerows='1' valign='middle'>eth0.411</entry>
		<entry><systemitem class='ipaddress'>10.2.211.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19b::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>415</entry>
		<entry morerows='1' valign='middle'>eth0.415</entry>
		<entry><systemitem class='ipaddress'>10.2.215.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19f::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.2.210.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19a::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>korriban</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.22
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.22</entry>
		<entry morerows='1' valign='middle' align='right'>411</entry>
		<entry morerows='1' valign='middle'>eth0.411</entry>
		<entry><systemitem class='ipaddress'>10.2.211.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19b::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>413</entry>
		<entry morerows='1' valign='middle'>eth0.413</entry>
		<entry><systemitem class='ipaddress'>10.2.213.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19d::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.2.212.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.2.212.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19c::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:19c::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>kessel</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.23
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.23</entry>
		<entry morerows='1' valign='middle' align='right'>415</entry>
		<entry morerows='1' valign='middle'>eth0.415</entry>
		<entry><systemitem class='ipaddress'>10.2.215.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19f::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>413</entry>
		<entry morerows='1' valign='middle'>eth0.413</entry>
		<entry><systemitem class='ipaddress'>10.2.213.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19d::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.2.214.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.2.214.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:19e::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:19e::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.211-g3-addressing' frame='all' pgwide='1'>
	<title>Salle 211 - Groupe 3</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>mygeeto</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.211.4.31
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.31</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.12/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6b0</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>421</entry>
		<entry morerows='1' valign='middle'>eth0.421</entry>
		<entry><systemitem class='ipaddress'>10.3.221.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a5::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>425</entry>
		<entry morerows='1' valign='middle'>eth0.425</entry>
		<entry><systemitem class='ipaddress'>10.3.225.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a9::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.3.220.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a4::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>nelvaan</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.32
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.32</entry>
		<entry morerows='1' valign='middle' align='right'>421</entry>
		<entry morerows='1' valign='middle'>eth0.421</entry>
		<entry><systemitem class='ipaddress'>10.3.221.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a5::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>423</entry>
		<entry morerows='1' valign='middle'>eth0.423</entry>
		<entry><systemitem class='ipaddress'>10.3.223.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a7::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.3.222.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.3.222.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a6::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:1a6::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>rattatak</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.33
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.33</entry>
		<entry morerows='1' valign='middle' align='right'>425</entry>
		<entry morerows='1' valign='middle'>eth0.425</entry>
		<entry><systemitem class='ipaddress'>10.3.225.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a9::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>423</entry>
		<entry morerows='1' valign='middle'>eth0.423</entry>
		<entry><systemitem class='ipaddress'>10.3.223.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a7::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.3.224.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.3.224.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1a8::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:1a8::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.211-g4-addressing' frame='all' pgwide='1'>
	<title>Salle 211 - Groupe 4</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>saleucami</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.211.4.41
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.41</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.13/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6b1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>431</entry>
		<entry morerows='1' valign='middle'>eth0.431</entry>
		<entry><systemitem class='ipaddress'>10.4.231.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1af::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>435</entry>
		<entry morerows='1' valign='middle'>eth0.435</entry>
		<entry><systemitem class='ipaddress'>10.4.235.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b3::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.4.230.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1ae::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>taris</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.42
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.42</entry>
		<entry morerows='1' valign='middle' align='right'>431</entry>
		<entry morerows='1' valign='middle'>eth0.431</entry>
		<entry><systemitem class='ipaddress'>10.4.231.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1af::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>433</entry>
		<entry morerows='1' valign='middle'>eth0.433</entry>
		<entry><systemitem class='ipaddress'>10.4.233.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b1::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.4.232.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.4.232.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b0::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:1b0::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>teth</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.211.4.43
		<?custom-linebreak?>OSPFv3&nbsp;: 0.211.6.43</entry>
		<entry morerows='1' valign='middle' align='right'>435</entry>
		<entry morerows='1' valign='middle'>eth0.435</entry>
		<entry><systemitem class='ipaddress'>10.4.235.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b3::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>433</entry>
		<entry morerows='1' valign='middle'>eth0.433</entry>
		<entry><systemitem class='ipaddress'>10.4.233.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b1::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.4.234.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.4.234.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:1b2::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:1b2::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>
</sect2>

<?custom-pagebreak?>
<sect2 xml:id='interco.ospf-quagga.archi.adressage-213'>
	<title>Plan d'adressage salle 213</title>

<table xml:id='interco.ospf-quagga.213.switches' frame='all' pgwide='1'>
    <title>Affectation d'un commutateur par groupe de 3 routeurs - salle 213</title>
	<tgroup cols='2' align='center' colsep='1' rowsep='1'>
	<colspec colnum='1' colwidth='1*'/>
	<colspec colnum='2' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Groupe</entry>
		<entry>Commutateur</entry>
	</row>
    </thead>
    <tbody>
	<row>
		<entry valign='middle'>1</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw04-213.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>2</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw05-213.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>3</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw06-213.infra.stri</systemitem></entry>
	</row>
	<row>
		<entry valign='middle'>4</entry>
		<entry valign='middle'><systemitem
			class='systemname'>asw07-213.infra.stri</systemitem></entry>
	</row>
	</tbody>
	</tgroup>
</table>

	<para>Voici, pour chaque groupe de trois routeurs, le tableau d'affectation
	des rôles, des numéros de VLANs et des adresses IP.</para>

<table xml:id='quagga.lab.213-g1-addressing' frame='all' pgwide='1'>
	<title>Salle 213 - Groupe 1</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>alderaan</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.213.4.11
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.11</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.1/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6a5</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>221</entry>
		<entry morerows='1' valign='middle'>eth0.221</entry>
		<entry><systemitem class='ipaddress'>10.1.21.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:dd::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>231</entry>
		<entry morerows='1' valign='middle'>eth0.231</entry>
		<entry><systemitem class='ipaddress'>10.1.31.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:e7::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.1.10.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:da::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>bespin</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.12
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.12</entry>
		<entry morerows='1' valign='middle' align='right'>221</entry>
		<entry morerows='1' valign='middle'>eth0.221</entry>
		<entry><systemitem class='ipaddress'>10.1.21.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:dd::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>232</entry>
		<entry morerows='1' valign='middle'>eth0.232</entry>
		<entry><systemitem class='ipaddress'>10.1.32.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:e8::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.20.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.1.20.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:db::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:db::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>centares</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.13
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.13</entry>
		<entry morerows='1' valign='middle' align='right'>231</entry>
		<entry morerows='1' valign='middle'>eth0.231</entry>
		<entry><systemitem class='ipaddress'>10.1.31.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:e7::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>232</entry>
		<entry morerows='1' valign='middle'>eth0.232</entry>
		<entry><systemitem class='ipaddress'>10.1.32.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:e8::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.30.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.1.30.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:dc::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:dc::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.213-g2-addressing' frame='all' pgwide='1'>
	<title>Salle 213 - Groupe 2</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>coruscant</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.213.4.21
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.21</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.2/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6a6</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>241</entry>
		<entry morerows='1' valign='middle'>eth0.241</entry>
		<entry><systemitem class='ipaddress'>10.2.41.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:f1::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>251</entry>
		<entry morerows='1' valign='middle'>eth0.251</entry>
		<entry><systemitem class='ipaddress'>10.2.51.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:fb::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.2.40.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:ee::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>dagobah</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.0.4.22
		<?custom-linebreak?>OSPFv3&nbsp;: 0.0.6.22</entry>
		<entry morerows='1' valign='middle' align='right'>241</entry>
		<entry morerows='1' valign='middle'>eth0.241</entry>
		<entry><systemitem class='ipaddress'>10.2.41.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:f1::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>254</entry>
		<entry morerows='1' valign='middle'>eth0.254</entry>
		<entry><systemitem class='ipaddress'>10.2.54.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:fe::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.2.50.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.2.50.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:ef::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:ef::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>endor</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.23
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.23</entry>
		<entry morerows='1' valign='middle' align='right'>251</entry>
		<entry morerows='1' valign='middle'>eth0.251</entry>
		<entry><systemitem class='ipaddress'>10.2.51.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:fb::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>254</entry>
		<entry morerows='1' valign='middle'>eth0.254</entry>
		<entry><systemitem class='ipaddress'>10.2.54.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:fe::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.2.60.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.2.60.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:f0::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:f0::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.213-g3-addressing' frame='all' pgwide='1'>
	<title>Salle 213 - Groupe 3</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>felucia</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.213.4.31
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.31</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.3/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6a7</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>261</entry>
		<entry morerows='1' valign='middle'>eth0.261</entry>
		<entry><systemitem class='ipaddress'>10.3.61.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:105::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>271</entry>
		<entry morerows='1' valign='middle'>eth0.271</entry>
		<entry><systemitem class='ipaddress'>10.3.71.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:10f::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.3.70.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:102::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>geonosis</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.32
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.32</entry>
		<entry morerows='1' valign='middle' align='right'>261</entry>
		<entry morerows='1' valign='middle'>eth0.261</entry>
		<entry><systemitem class='ipaddress'>10.3.61.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:105::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>276</entry>
		<entry morerows='1' valign='middle'>eth0.276</entry>
		<entry><systemitem class='ipaddress'>10.3.76.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:114::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.3.80.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.3.80.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:103::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:103::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>hoth</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.33
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.33</entry>
		<entry morerows='1' valign='middle' align='right'>271</entry>
		<entry morerows='1' valign='middle'>eth0.271</entry>
		<entry><systemitem class='ipaddress'>10.3.71.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:10f::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>276</entry>
		<entry morerows='1' valign='middle'>eth0.276</entry>
		<entry><systemitem class='ipaddress'>10.3.76.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:114::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.3.90.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.3.90.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:104::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:104::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

<?custom-pagebreak?>
<table xml:id='quagga.lab.g4-addressing' frame='all' pgwide='1'>
	<title>Salle 213 - Groupe 4</title>
	<tgroup cols='6' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='2*'/>
		<colspec colnum='2' colwidth='1*'/>
		<colspec colnum='3' colwidth='2*'/>
		<colspec colnum='4' colwidth='1*'/>
		<colspec colnum='5' colwidth='2*'/>
		<colspec colnum='6' colwidth='4*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Poste</entry>
		<entry>Rôle</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>mustafar</entry>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2&nbsp;: 0.213.4.41
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.41</entry>
		<entry morerows='1' valign='middle' align='right'>4</entry>
		<entry morerows='1' valign='middle'>eth0.4</entry>
		<entry><systemitem class='ipaddress'>172.16.17.4/20</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:4::6a8</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>281</entry>
		<entry morerows='1' valign='middle'>eth0.281</entry>
		<entry><systemitem class='ipaddress'>10.4.81.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:119::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>291</entry>
		<entry morerows='1' valign='middle'>eth0.291</entry>
		<entry><systemitem class='ipaddress'>10.4.91.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:123::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.4.100.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:116::1</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>naboo</entry>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.42
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.42</entry>
		<entry morerows='1' valign='middle' align='right'>281</entry>
		<entry morerows='1' valign='middle'>eth0.281</entry>
		<entry><systemitem class='ipaddress'>10.4.81.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:119::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>298</entry>
		<entry morerows='1' valign='middle'>eth0.298</entry>
		<entry><systemitem class='ipaddress'>10.4.98.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:12a::2</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.4.110.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.4.110.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:117::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:117::2</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>tatooine</entry>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2&nbsp;: 0.213.4.43
		<?custom-linebreak?>OSPFv3&nbsp;: 0.213.6.43</entry>
		<entry morerows='1' valign='middle' align='right'>291</entry>
		<entry morerows='1' valign='middle'>eth0.291</entry>
		<entry><systemitem class='ipaddress'>10.4.91.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:123::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>298</entry>
		<entry morerows='1' valign='middle'>eth0.298</entry>
		<entry><systemitem class='ipaddress'>10.4.98.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:12a::3</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.4.120.1/30</systemitem>:
		<phrase role='green'><systemitem class='ipaddress'>10.4.120.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:118::1</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:118::2</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>
</sect2> 
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.prepare-config'>
	<title>Préparation des routeurs</title>

	<para>La première étape consiste à installer les outils sur les trois
	routeurs, à appliquer une configuration commune et à mettre en place la
	topologie physique.</para>

	<orderedlist>
	<listitem>
	<para>Installer les paquets <application>quagga-core</application>,
	<application>quagga-ospfd</application> et
	<application>quagga-ospf6d</application> avant de brasser les postes sur
	les commutateurs désignés à la <xref
	linkend='interco.ospf-quagga.archi'/>.</para>

<screen><prompt>$</prompt> aptitude search ~iquagga
i   quagga-core         - network routing daemons (core abstraction layer)
i   quagga-ospf6d       - OSPF6 routing daemon
i   quagga-ospfd        - OSPF routing daemon</screen>

	<para>Sans configuration particulière, les trois services correspondant aux
	paquets installés ne sont pas lancés.</para>

<screen><prompt>$</prompt> systemctl status <emphasis>zebra</emphasis>
systemctl status zebra
● zebra.service - GNU Zebra routing manager
   Loaded: loaded (/lib/systemd/system/zebra.service; enabled; vendor preset: enabled)
   Active: <emphasis>inactive (dead)</emphasis>
     Docs: man:zebra

<prompt>$</prompt> systemctl status <emphasis>ospfd</emphasis>
● ospfd.service - OSPF routing daemon
   Loaded: loaded (/lib/systemd/system/ospfd.service; enabled; vendor preset: enabled)
   Active: <emphasis>inactive (dead)</emphasis>
     Docs: man:ospfd

<prompt>$</prompt> systemctl status <emphasis>ospf6d</emphasis>
● ospf6d.service - OSPF routing daemon for IPv6
   Loaded: loaded (/lib/systemd/system/ospf6d.service; enabled; vendor preset: enabled)
   Active: <emphasis>inactive (dead)</emphasis>
     Docs: man:ospf6d</screen>
	</listitem>

	<listitem xml:id='interco.ospf-quagga.prepare-config.routing'>
	<para>Activer le routage <acronym>IPv4</acronym> et <acronym>IPv6</acronym>
	au niveau noyau.</para>

	<para>Il faut éditer le fichier <filename>/etc/sysctl.conf</filename> pour
	fixer les valeurs des paramètres de configuration du routage. Voir la
	section <citetitle>Fonctions réseau d'une interface</citetitle> du support
	&url.config.interface.lan;.</para>

<screen><prompt>#</prompt> sysctl -p
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1
<emphasis>net.ipv4.ip_forward = 1</emphasis>
<emphasis>net.ipv6.conf.all.forwarding = 1</emphasis>
net.ipv4.conf.all.secure_redirects = 1
net.ipv4.conf.all.log_martians = 1</screen>
	</listitem>

	<listitem xml:id='interco.ospf-quagga.prepare-config.subinterfaces'>
	<para>Créer les sous-interfaces associées aux <acronym>VLAN</acronym>s sur
	chacun des routeurs <systemitem>R1</systemitem>,
	<systemitem>R2</systemitem> et <systemitem>R3</systemitem> à l'aide du
	script suivant&nbsp;:</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/subinterfaces.sh'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

	<para>Sur le routeur R1, on utilise le script avec les numéros de
	<acronym>VLAN</acronym>s 12 et 13 par exemple.</para>

<screen>R1:~# sh ./subinterfaces.sh 12 13</screen>

	<para>On adapte l'utilisation du même script aux routeurs
	<systemitem>R2</systemitem> et <systemitem>R3</systemitem> avec les numéros
	de <acronym>VLAN</acronym>s concernés.</para>
	</listitem>

	<listitem>
	<para>Créer les fichiers de configuration de base pour les différents
	démons et outils sur chaque routeur en utilisant les patrons livrés avec le
	paquet <application>quagga-core</application>.</para>

	<para>Créer aussi le dossier dédié aux journaux des trois démons de
	routage&nbsp;: <filename
	class='directory'>/var/log/quagga</filename>.</para>

	<para>La présence d'un fichier de configuration par démon est une condition
	indispensable pour le lancement des services via
	<application>systemd</application>.</para>

<screen><prompt>#</prompt> cp /usr/share/doc/quagga-core/examples/zebra.conf.sample /etc/quagga/zebra.conf
<prompt>#</prompt> cp /usr/share/doc/quagga-core/examples/ospfd.conf.sample /etc/quagga/ospfd.conf
<prompt>#</prompt> cp /usr/share/doc/quagga-core/examples/ospf6d.conf.sample /etc/quagga/ospf6d.conf
<prompt>#</prompt> cp /usr/share/doc/quagga-core/examples/vtysh.conf.sample /etc/quagga/vtysh.conf
<prompt>#</prompt> chown quagga.quagga /etc/quagga/*.conf
<prompt>#</prompt> mkdir /var/log/quagga
<prompt>#</prompt> chown quagga.adm /var/log/quagga
<prompt>#</prompt> chmod 2750 /var/log/quagga</screen>
	</listitem>

	<listitem>
	<para>Éditer le patron du fichier de configuration de l'outil
	<command>vtysh</command>.</para>

<screen><prompt>#</prompt> cat /etc/quagga/vtysh.conf
!
! Configuration file for vtysh.
!
service integrated-vtysh-config
hostname R1
username root nopassword</screen>

	<para>Cet outil offre une console unifiée pour les trois démons :
	<application>zebra</application>, <application>ospfd</application> et
	<application>ospf6d</application>. Dès que l'instruction <option>service
	integrated-vtysh-config</option> est active, le fichier
	<filename>/etc/quagga/Quagga.conf</filename> devient de fichier de
	configuration commun à l'ensemble des démons actifs. Pour autant, les
	fichiers de configuration individuels proposés ci-dessous sont toujours
	nécessaires ; notamment pour distinguer les fichiers de journalisations
	spécifiques à chaque protocole.</para>
	</listitem>

	<listitem>
	<para>Éditer le patron du fichier de configuration du démon <systemitem
		class='daemon'>zebra</systemitem> en fixant les paramètres de
		connexion à utiliser pour y accéder séparément de la console
		unifiée.</para>

<screen><prompt>#</prompt> cat zebra.conf
! -*- zebra -*-
!
hostname R1-zebra
password zebra
enable password zebra
!
log file /var/log/quagga/zebra.log</screen>
	</listitem>

	<listitem>
	<para>Éditer le patron du fichier de configuration du démon <systemitem
		class='daemon'>ospfd</systemitem> en fixant les paramètres de connexion
		à utiliser pour y accéder séparément de la console unifiée.</para>

<screen><prompt>#</prompt> cat ospfd.conf
! -*- ospfv2 -*-
!
hostname R1-ospfd
password zebra
enable password zebra
!
log file /var/log/quagga/ospfd.log</screen>
	</listitem>

	<listitem>
	<para>Éditer le patron du fichier de configuration du démon <systemitem
		class='daemon'>ospf6d</systemitem> en fixant les paramètres de connexion
		à utiliser pour y accéder séparément de la console unifiée.</para>

<screen><prompt>#</prompt> cat ospf6d.conf
! -*- ospfv3 -*-
!
hostname R1-ospf6d
password zebra
enable password zebra
!
log file /var/log/quagga/ospf6d.log</screen>
	</listitem>

	<listitem>
	<para>Activer et lancer les services correspondant aux trois démons&nbsp;:
	<application>zebra</application>, <application>ospfd</application> et
	<application>ospf6d</application>.</para> 

<screen><prompt>#</prompt> systemctl enable zebra

<prompt>#</prompt> systemctl enable ospfd

<prompt>#</prompt> systemctl enable ospf6d

<prompt>#</prompt> systemctl start zebra

<prompt>#</prompt> systemctl start ospfd

<prompt>#</prompt> systemctl start ospf6d</screen>
	</listitem>

	<listitem>
	<para>Vérifier que les services sont correctement lancés.</para>

<screen><prompt>#</prompt> systemctl status zebra
● zebra.service - GNU Zebra routing manager
   Loaded: loaded (/lib/systemd/system/zebra.service; enabled; vendor preset: enabled)
   <emphasis>Active: active (running)</emphasis> since Fri 2018-10-12 08:55:58 UTC; 3min 12s ago
     Docs: man:zebra
  Process: 2521 ExecStart=/usr/sbin/zebra -d -A 127.0.0.1 -f /etc/quagga/zebra.conf (code=exited, status=0/SUCCESS)
  Process: 2520 ExecStartPre=/bin/chown -f quagga:quaggavty /etc/quagga/vtysh.conf (code=exited, status=0/SUCCESS)
  Process: 2519 ExecStartPre=/bin/chown -f quagga:quagga /etc/quagga/zebra.conf (code=exited, status=0/SUCCESS)
  Process: 2518 ExecStartPre=/bin/chmod -f 640 /etc/quagga/vtysh.conf /etc/quagga/zebra.conf (code=exited, status=0/SUCCESS)
  Process: 2517 ExecStartPre=/sbin/ip route flush proto zebra (code=exited, status=0/SUCCESS)
 Main PID: 2522 (zebra)
   Memory: 1.3M
   CGroup: /system.slice/zebra.service
           └─2522 /usr/sbin/zebra -d -A 127.0.0.1 -f /etc/quagga/zebra.conf

oct. 12 08:55:58 R3 systemd[1]: Starting GNU Zebra routing manager...
oct. 12 08:55:58 R3 systemd[1]: Started GNU Zebra routing manager.

<prompt>#</prompt> systemctl status ospfd
● ospfd.service - OSPF routing daemon
   Loaded: loaded (/lib/systemd/system/ospfd.service; enabled; vendor preset: enabled)
   <emphasis>Active: active (running)</emphasis> since Fri 2018-10-12 08:56:01 UTC; 4min 20s ago
     Docs: man:ospfd
  Process: 2527 ExecStart=/usr/sbin/ospfd -d -A 127.0.0.1 -f /etc/quagga/ospfd.conf (code=exited, status=0/SUCCESS)
  Process: 2526 ExecStartPre=/bin/chown -f quagga:quagga /etc/quagga/ospfd.conf (code=exited, status=0/SUCCESS)
  Process: 2525 ExecStartPre=/bin/chmod -f 640 /etc/quagga/ospfd.conf (code=exited, status=0/SUCCESS)
 Main PID: 2528 (ospfd)
   Memory: 1.1M
   CGroup: /system.slice/ospfd.service
           └─2528 /usr/sbin/ospfd -d -A 127.0.0.1 -f /etc/quagga/ospfd.conf

oct. 12 08:56:01 R3 systemd[1]: Starting OSPF routing daemon...
oct. 12 08:56:01 R3 systemd[1]: Started OSPF routing daemon.

<prompt>#</prompt> systemctl status ospf6d
● ospf6d.service - OSPF routing daemon for IPv6
   Loaded: loaded (/lib/systemd/system/ospf6d.service; enabled; vendor preset: enabled)
   <emphasis>Active: active (running)</emphasis> since Fri 2018-10-12 08:56:05 UTC; 5min ago
     Docs: man:ospf6d
  Process: 2533 ExecStart=/usr/sbin/ospf6d -d -A ::1 -f /etc/quagga/ospf6d.conf (code=exited, status=0/SUCCESS)
  Process: 2532 ExecStartPre=/bin/chown -f quagga:quagga /etc/quagga/ospf6d.conf (code=exited, status=0/SUCCESS)
  Process: 2531 ExecStartPre=/bin/chmod -f 640 /etc/quagga/ospf6d.conf (code=exited, status=0/SUCCESS)
 Main PID: 2534 (ospf6d)
   Memory: 1.0M
   CGroup: /system.slice/ospf6d.service
           └─2534 /usr/sbin/ospf6d -d -A ::1 -f /etc/quagga/ospf6d.conf

oct. 12 08:56:05 R3 systemd[1]: Starting OSPF routing daemon for IPv6...
oct. 12 08:56:05 R3 systemd[1]: Started OSPF routing daemon for IPv6.</screen>
	</listitem>

	<listitem>
	<para>Compléter la configuration des interfaces dans la console unifiée
	<command>vtysh</command> de façon à fixer la bande passante de chaque
	interface active à 1Gbps.</para>

	<para>Voici un exemple de séquence d'instructions pour configurer une
	interface.</para>

<screen><prompt>#</prompt> vtysh

Hello, this is Quagga (version 1.2.4).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

R1# conf t
R1(config)# int eth0
R1(config-if)# bandwidth 1000000
R1(config-if)# ^Z
R1# copy run start
Building Configuration...
Integrated configuration saved to /etc/quagga/Quagga.conf
[OK]</screen>

	<para>Une fois revenu au système d'exploitation, on doit obtenir un
	résultat équivalent à celui présenté ci-dessous. Les noms d'interfaces
	dépendent du routeur concerné.</para> 
	
<screen><prompt>#</prompt> grep -1 bandwidth /etc/quagga/Quagga.conf
interface eth0
 bandwidth 1000000
!
interface eth0.12
 bandwidth 1000000
!
interface eth0.13
 bandwidth 1000000
!</screen>

	<note>
	<para>Contrairement à un routeur «intégré» avec un système d'exploitation
		dédié, le démon de routage statique n'a pas directement accès aux
		interfaces matérielles. Or, sur un système GNU/Linux, le débit d'une
		interface Ethernet filaire peut varier en fonction du débit proposé par
		le port du commutateur. Sans information spécifique du noyau,
		l'application «service de routage» n'a aucun moyen de connaître le
		débit exact de l'interface. C'est la raison pour laquelle il est
		nécessaire de paramétrer manuellement les débits de chaque interface
		dans la	configuration du démon <systemitem
		class='daemon'>zebra</systemitem>.</para> 
	</note>

	<warning>
	<para>Sans configuration manuelle du coût de lien d'une interface, ce
		paramétrage de la bande passante est essentiel dans le <link
		linkend='interco.ospf-quagga.auto-cost'>calcul des métriques</link>
		et le fonctionnement du protocole de routage <acronym>OSPF</acronym>.
		Si les calculs de métriques pour les liens actifs sont erronés, le
		choix des routes à emprunter pour faire transiter le trafic utilisateur
		entre deux routeurs peut lui aussi être erroné.</para>
	</warning>
	</listitem>
	</orderedlist>

	<para>Une fois l'ensemble des opérations de cette section réalisées, chaque
	routeur dispose des outils pour mettre en œuvre la topologie physique et
	ensuite les protocoles de routage dynamique <acronym>OSPF</acronym>.</para>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.pointopoint'>
	<title>Communications entre routeurs</title>

	<para>Avant d'aborder le déploiement du protocole de routage dynamique, il
	est nécessaire de valider le raccordement des routeurs aux commutateurs
	désignés, les communications entre chaque routeur et la visualisation des
	tables de routage pour les interfaces réseau configurées.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour implanter
		les adresses <acronym>IPv4</acronym> et <acronym>IPv6</acronym> des
		interfaces correspondant à	chacun des <acronym>VLAN</acronym>s routés
		?</phrase></para>

		<para>Au niveau liaison, les sous-interfaces ont déjà été configurées
		avec le script <link
		linkend='interco.ospf-quagga.prepare-config.subinterfaces'>subinterfaces.sh</link>.
		Il reste à paramétrer les adresses de ces sous-interfaces.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Routeur R1</term>
		<listitem>
<screen><prompt>R1:~#</prompt> ip addr add 10.1.12.1/26 brd + dev eth0.12
<prompt>R1:~#</prompt> ip -6 addr add 2001:678:3fc:c::1/64 dev eth0.12
<prompt>R1:~#</prompt> ip addr add 10.1.13.1/26 brd + dev eth0.13
<prompt>R1:~#</prompt> ip -6 addr add 2001:678:3fc:d::1/64 dev eth0.13</screen>
		</listitem>
		</varlistentry>
		<varlistentry>
			<term>Routeur R2</term>
		<listitem>
<screen><prompt>R2:~#</prompt> ip addr add 10.1.12.2/26 brd + dev eth0.12
<prompt>R2:~#</prompt> ip -6 addr add 2001:678:3fc:c::2/64 dev eth0.12
<prompt>R2:~#</prompt> ip addr add 10.1.23.2/26 brd + dev eth0.23
<prompt>R2:~#</prompt> ip -6 addr add 2001:678:3fc:17::2/64 dev eth0.23</screen>
		</listitem>
		</varlistentry>
		<varlistentry>
			<term>Routeur R3</term>
		<listitem>
<screen><prompt>R3:~#</prompt> ip addr add 10.1.13.3/26 brd + dev eth0.13
<prompt>R3:~#</prompt> ip -6 addr add 2001:678:3fc:d::3/64 dev eth0.13
<prompt>R3:~#</prompt> ip addr add 10.1.23.3/26 brd + dev eth0.23
<prompt>R3:~#</prompt> ip -6 addr add 2001:678:3fc:17::3/64 dev eth0.23</screen>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour valider les
		communications <acronym>IP</acronym> entre
		routeurs&nbsp;?</phrase></para>

		<para>Lancer les tests <acronym>ICMP</acronym> usuels entre chaque
		routeur sur chaque lien actif.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Exemple entre R1 et R2</term>
		<listitem>
<screen><prompt>R1:~#</prompt> ping -qc2 10.1.12.2
PING 10.1.12.2 (10.1.12.2) 56(84) bytes of data.

--- 10.1.12.2 ping statistics ---
2 packets transmitted, 2 received, <emphasis>0% packet loss</emphasis>, time 6ms
rtt min/avg/max/mdev = 0.068/0.309/0.551/0.242 ms</screen>
		</listitem>
		</varlistentry>
		</variablelist>

		<para>L'opération est à répéter sur chaque lien entre deux routeurs
		reliés sur le même <acronym>VLAN</acronym>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour visualiser
		la table de routage existante d'un routeur au niveau système et au
		niveau de la console unifiée
		<application>vtysh</application>&nbsp;?</phrase></para>

		<para>Utiliser la commande <command>ip</command> pour visualiser les
		tables de routage puis afficher les mêmes tables de routage à partir de
		la console <application>vtysh</application> avec les commandes du
		système <trademark>Cisco</trademark> <acronym>IOS</acronym>
		<command>show ip route</command> et <command>show ipv6
		route</command>.</para>
	</question>
	<answer>
		<variablelist>
		<varlistentry>
			<term>Routeur R1 - niveau système</term>
		<listitem>
<screen><prompt>R1:~#</prompt> ip route ls
default via 192.0.2.1 dev eth0 onlink
10.1.12.0/26 dev eth0.12 proto kernel scope link src 10.1.12.1
10.1.13.0/26 dev eth0.13 proto kernel scope link src 10.1.13.1
192.0.2.0/27 dev eth0 proto kernel scope link src 192.0.2.9</screen>

<screen><prompt>R1:~#</prompt> ip -6 route ls
2001:678:3fc:a::/64 dev eth0 proto kernel metric 256 expires 86123sec pref medium
2001:678:3fc:c::/64 dev eth0.12 proto kernel metric 256 pref medium
2001:678:3fc:d::/64 dev eth0.13 proto kernel metric 256 pref medium
fe80::/64 dev eth0 proto kernel metric 256 pref medium
fe80::/64 dev eth0.12 proto kernel metric 256 pref medium
fe80::/64 dev eth0.13 proto kernel metric 256 pref medium
default via fe80::dc02:44ff:fe64:4834 dev eth0 proto ra metric 1024 expires 1523sec hoplimit 64 pref medium</screen>

		<para>Toutes les routes affichées correspondent à des réseaux
		<acronym>IPv4</acronym> et <acronym>IPv6</acronym> sur lesquels le
		routeur est directement connecté via une interface active correctement
		configurée.</para>
		</listitem>
		</varlistentry>

		<varlistentry>
			<term>Routeur R1 - console vtysh</term>
		<listitem>
<screen><prompt>R1#</prompt> sh ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* 0.0.0.0/0 via 192.0.2.1, eth0
C>* 10.1.12.0/26 is directly connected, eth0.12
C>* 10.1.13.0/26 is directly connected, eth0.13
C>* 127.0.0.0/8 is directly connected, lo
C>* 192.0.2.0/27 is directly connected, eth0</screen>

<screen><prompt>R1#</prompt> sh ipv6 route
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv6, I - IS-IS, B - BGP, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* ::/0 via fe80::dc02:44ff:fe64:4834, eth0
C>* ::1/128 is directly connected, lo
C>* 2001:678:3fc:a::/64 is directly connected, eth0
C>* 2001:678:3fc:c::/64 is directly connected, eth0.12
C>* 2001:678:3fc:d::/64 is directly connected, eth0.13
C * fe80::/64 is directly connected, eth0
C * fe80::/64 is directly connected, eth0.13
C>* fe80::/64 is directly connected, eth0.12</screen>

		<para>On retrouve les mêmes informations qu'au niveau système. Une
		distinction apparaît entre les routes par défaut héritées du niveau
		système qui sont repérées avec l'indicateur <option>K</option> et les
		autres routes qui correspondent aux réseaux <acronym>IPv4</acronym> et
		<acronym>IPv6</acronym> sur	lesquels le routeur est directement
		connecté.</para>
		</listitem>
		</varlistentry>
		</variablelist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment activer la fonction routage du noyau
		Linux&nbsp;?</phrase></para>

		<para>Reprendre l'instruction présentée dans le document
		&url.config.interface.lan.proc;.</para>

		<para>L'opération doit être répétée sur chacun des trois routeurs pour
		que les paquets soient acheminés normalement.</para>
	</question>
	<answer>
		<para>Si cette fonction n'est pas active dans le noyau Linux, aucune
		décision de routage d'un paquet d'une interface vers l'autre ne sera
		prise. Les paquets à router sont simplement jetés.</para>

		<para>Les instructions d'activation de la fonction de routage sont
		données dans la section <link
		linkend='interco.ospf-quagga.prepare-config.routing'>Préparation des
		routeurs</link>.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.protocol-config'>
	<title>Configuration OSPF de base</title>

	<para>Dans cette section, on introduit les premières commandes de
	configuration du protocole de routage dynamique <acronym>OSPF</acronym> qui
	permettent d'activer le protocole puis d'ajouter des entrées de réseau dans
	la base de données de ce protocole.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Comment peut-on contrôler que le protocole
		<acronym>OSPF</acronym> est actif ou non sur un
		routeur&nbsp;?</phrase></para>

		<para>Une fois la console <application>vtysh</application> ouverte,
		lancer les commandes de visualisation de l'état du protocole listées
		ci-dessous. Ces commandes peuvent être lancées sur chacun des trois
		routeurs.</para>

		<simplelist type='horiz'>
		<member><command>show&nbsp;ip&nbsp;ospf</command></member>
		<member><command>show&nbsp;ipv6&nbsp;ospf6</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Dans les informations données dans la copie d'écran ci-dessous,
		il apparaît que l'algorithme de calcul de topologie n'a pas encore été
		activé.</para>

<screen><prompt>#</prompt> vtysh

Hello, this is Quagga (version 1.2.4).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

R1# show ip ospf
 <emphasis>OSPF Routing Process not enabled</emphasis>
R1# show ipv6 ospf6
<emphasis>OSPFv3 is not running</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour activer les
		protocoles de routage <acronym>OSPFv2</acronym> et
		<acronym>OSPFv3</acronym>&nbsp;? Comment affecter manuellement
		l'identifiant du routeur&nbsp;?</phrase></para>

		<warning>
		<para>Les identifiants à utiliser lors de la séance de travaux
		pratiques sont donnés dans les tableaux des plans d'adressage. Voir
		<xref linkend='interco.ospf-quagga.archi'/>.</para>
		</warning>

		<para>La liste des commandes utiles en mode configuration dans la
		console <application>vtysh</application> est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>router&nbsp;ospf</command></member>
		<member><command>router&nbsp;ospf6</command></member>
		<member><command>router-id&nbsp;X.X.X.X</command></member>
		<member><command>log-adjacency-changes</command></member>
		</simplelist>
    </question>
    <answer>
		<para>Toujours à partir de la console <application>vtysh</application>,
		on accède au mode configuration à l'aide de la commande
		<command>conf&nbsp;t</command>. Voici un exemple de séquence sur le
		premier routeur.</para>

<screen><prompt>R1#</prompt> conf t
<prompt>R1(config)#</prompt> router ospf
<prompt>R1(config-router)#</prompt>  ospf router-id 0.0.1.4
<prompt>R1(config-router)#</prompt>  log-adjacency-changes
<prompt>R1(config-router)#</prompt> exit
<prompt>R1(config)#</prompt> router ospf6
<prompt>R1(config-ospf6)#</prompt>  router-id 0.0.1.6
<prompt>R1(config-ospf6)#</prompt>  log-adjacency-changes
<prompt>R1(config-ospf6)#</prompt> ^Z</screen>

		<para>Le choix de codage des identifiants <acronym>OSPF</acronym> a
		pour but d'éviter une confusion avec les adresses des réseaux actifs
		sur chaque routeur.</para>

		<para>Si on reprend l'instruction de la question précédente, on obtient
		l'état de chacun des démons de protocole de routage dynamique.</para>

<screen><prompt>R1#</prompt> show ip ospf
 OSPF Routing Process, Router ID: 0.0.1.4
 Supports only single TOS (TOS0) routes
 This implementation conforms to RFC2328
 RFC1583Compatibility flag is disabled
 OpaqueCapability flag is disabled
 Initial SPF scheduling delay 0 millisec(s)
 Minimum hold time between consecutive SPFs 50 millisec(s)
 Maximum hold time between consecutive SPFs 5000 millisec(s)
 Hold time multiplier is currently 1
 <emphasis>SPF algorithm has not been run</emphasis>
 SPF timer is inactive
 Refresh timer 10 secs
 Number of external LSA 0. Checksum Sum 0x00000000
 Number of opaque AS LSA 0. Checksum Sum 0x00000000
 Number of areas attached to this router: 0
 Adjacency changes are logged</screen>

 <screen><prompt>R1#</prompt> show ipv6 ospf6
 OSPFv3 Routing Process (0) with Router-ID 0.0.1.6
 Running 00:12:11
 Initial SPF scheduling delay 0 millisec(s)
 Minimum hold time between consecutive SPFs 50 millsecond(s)
 Maximum hold time between consecutive SPFs 5000 millsecond(s)
 Hold time multiplier is currently 1
 <emphasis>SPF algorithm has not been run$</emphasis>
 SPF timer is inactive
 Number of AS scoped LSAs is 0
 Number of areas in this router is 0
 Adjacency changes are logged</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour activer le
		protocole de routage <acronym>OSPFv2</acronym> pour les réseaux
		<acronym>IPv4</acronym> connus de chaque routeur&nbsp;?</phrase></para>

		<para>Il faut ajouter une entrée pour chaque préfixe réseau
		<acronym>IPv4</acronym> de la topologie logique connu du routeur. On
		peut lister les entrées marquées <option>C</option> de la table de
		routage.</para>

		<para>La liste des commandes utiles en mode console et en mode
		configuration dans <application>vtysh</application> est la
		suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip route connected</command></member>
		<member><command>router ospf</command></member>
		<member><command>network A.B.C.D/MM area 0</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Voici une exemple de séquence d'instructions pour le routeur
		<systemitem>R1</systemitem>.</para>

<screen><prompt>R1#</prompt> show ip route connected
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, N - NHRP,
       > - selected route, * - FIB route

<emphasis>C>* 10.1.12.0/26 is directly connected, eth0.12</emphasis>
<emphasis>C>* 10.1.13.0/26 is directly connected, eth0.13</emphasis>
C>* 127.0.0.0/8 is directly connected, lo
C>* 192.0.2.0/27 is directly connected, eth0</screen>

<screen><prompt>R1#</prompt> conf t
<prompt>R1(config)#</prompt> router ospf
<prompt>R1(config-router)#</prompt> network 10.1.12.0/26 area 0
<prompt>R1(config-router)#</prompt> network 10.1.13.0/26 area 0
<prompt>R1(config-router)#</prompt> ^Z</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour activer le
		protocole de routage <acronym>OSPFv3</acronym> pour les réseaux
		<acronym>IPv6</acronym> connus de chaque routeur&nbsp;?</phrase></para>

		<para>Il faut ajouter une entrée pour chaque interface active de la
		topologie logique connue du routeur.</para>

		<para>La liste des commandes utiles en mode console et en mode
		configuration dans <application>vtysh</application> est la
		suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ipv6 route connected</command></member>
		<member><command>router ospf6</command></member>
		<member><command>interface eth0.XX area 0.0.0.0</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Voici une exemple de séquence d'instructions pour le routeur
		<systemitem>R1</systemitem>.</para>

<screen><prompt>R1#</prompt> sh ipv6 route connected
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv6, I - IS-IS, B - BGP, A - Babel, N - NHRP,
       > - selected route, * - FIB route

C>* ::1/128 is directly connected, lo
C>* 2001:678:3fc:a::/64 is directly connected, eth0
<emphasis>C>* 2001:678:3fc:c::/64 is directly connected, eth0.12</emphasis>
<emphasis>C>* 2001:678:3fc:d::/64 is directly connected, eth0.13</emphasis>
C * fe80::/64 is directly connected, eth0
<emphasis>C * fe80::/64 is directly connected, eth0.13</emphasis>
<emphasis>C>* fe80::/64 is directly connected, eth0.12</emphasis></screen>

<screen><prompt>R1#</prompt> conf t
<prompt>R1(config)#</prompt> router ospf6
<prompt>R1(config-ospf6)#</prompt> interface eth0.12 area 0.0.0.0
<prompt>R1(config-ospf6)#</prompt> interface eth0.13 area 0.0.0.0
<prompt>R1(config-ospf6)#</prompt> ^Z</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment visualiser l'état	des interfaces actives pour
		chaque processus de protocole de routage dynamique
		<acronym>OSPFv2</acronym> ou
		<acronym>OSPFv3</acronym>&nbsp;?</phrase></para>

		<para>Les interfaces sont dites actives pour <acronym>OSPFv2</acronym>
		dès qu'une entrée de réseau correspondant à l'adresse
		<acronym>IPv4</acronym> d'interface est présente dans la configuration
		du protocole de routage.</para>

		<para>Pour <acronym>OSPFv3</acronym>, c'est plus simple. Les interfaces
		sont explicitement activées dans la configuration du protocole de
		routage.</para>

		<para>La liste des commandes utiles dans la console
		<application>vtysh</application> est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip ospf interface</command></member>
		<member><command>show ipv6 ospf6 interface</command></member>
		</simplelist>
	</question>
	<answer>
		<para>En reprenant l'exemple du routeur R1, on obtient les résultats
		suivants.</para>

<screen><prompt>R1#</prompt> show ip ospf interface
eth0 is up
  ifindex 19, MTU 1500 bytes, BW 1000000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  <emphasis>OSPF not enabled on this interface</emphasis>
eth0.12 is up
  ifindex 2, MTU 1500 bytes, BW 1000000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.12.1/26, Broadcast 10.1.12.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  <emphasis>Router ID 0.0.1.4, Network Type BROADCAST, Cost: 1</emphasis>
  Transmit Delay is 1 sec, State Backup, Priority 1
  Designated Router (ID) 0.0.2.4, Interface Address 10.1.12.2
  Backup Designated Router (ID) 0.0.1.4, Interface Address 10.1.12.1
  Saved Network-LSA sequence number 0x80000039
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 8.858s
  Neighbor Count is 1, Adjacent neighbor count is 1
eth0.13 is up
  ifindex 3, MTU 1500 bytes, BW 1000000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.13.1/26, Broadcast 10.1.13.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  <emphasis>Router ID 0.0.1.4, Network Type BROADCAST, Cost: 1</emphasis>
  Transmit Delay is 1 sec, State Backup, Priority 1
  Designated Router (ID) 0.0.3.4, Interface Address 10.1.13.3
  Backup Designated Router (ID) 0.0.1.4, Interface Address 10.1.13.1
  Saved Network-LSA sequence number 0x80000029
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 1.767s
  Neighbor Count is 1, Adjacent neighbor count is 1
lo is up
  ifindex 1, MTU 65536 bytes, BW 0 Kbit &lt;UP,LOOPBACK,RUNNING>
  <emphasis>OSPF not enabled on this interface</emphasis></screen>

<screen><prompt>R1#</prompt> show ipv6 ospf6 interface
eth0 is up, type BROADCAST
  Interface ID: 19
   <emphasis>OSPF not enabled on this interface</emphasis>
eth0.12 is up, type BROADCAST
  Interface ID: 2
  Internet Address:
    inet : 10.1.12.1/26
    inet6: fe80::c828:72ff:fedf:3608/64
    inet6: 2001:678:3fc:c::1/64
  Instance ID 0, Interface MTU 1500 (autodetect: 1500)
  MTU mismatch detection: enabled
  <emphasis>Area ID 0.0.0.0, Cost 1</emphasis>
  State BDR, Transmit Delay 1 sec, Priority 1
  Timer intervals configured:
   Hello 10, Dead 40, Retransmit 5
  DR: 0.0.2.6 BDR: 0.0.1.6
  Number of I/F scoped LSAs is 2
    0 Pending LSAs for LSUpdate in Time 00:00:00 [thread off]
    0 Pending LSAs for LSAck in Time 00:00:00 [thread off]
eth0.13 is up, type BROADCAST
  Interface ID: 3
  Internet Address:
    inet : 10.1.13.1/26
    inet6: fe80::c828:72ff:fedf:3608/64
    inet6: 2001:678:3fc:d::1/64
  Instance ID 0, Interface MTU 1500 (autodetect: 1500)
  MTU mismatch detection: enabled
  <emphasis>Area ID 0.0.0.0, Cost 1</emphasis>
  State BDR, Transmit Delay 1 sec, Priority 1
  Timer intervals configured:
   Hello 10, Dead 40, Retransmit 5
  DR: 0.0.3.6 BDR: 0.0.1.6
  Number of I/F scoped LSAs is 2
    0 Pending LSAs for LSUpdate in Time 00:00:00 [thread off]
    0 Pending LSAs for LSAck in Time 00:00:00 [thread off]
lo is up, type LOOPBACK
  Interface ID: 1
   <emphasis>OSPF not enabled on this interface</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment retrouver l'identifiant de
		routeur&nbsp;?</phrase></para>
		
		<para>À partir des résultats des questions précédentes, rechercher
		l'information demandée.</para>
	</question>
	<answer>
		<para>Quelque soit la version du protocole <acronym>OSPF</acronym>,
		l'identifiant de routeur est toujours codé sous la forme d'une adresse
		<acronym>IPv4</acronym>.</para>

<screen><prompt>R1#</prompt> sh ip ospf
 OSPF Routing Process, <emphasis>Router ID: 0.0.1.4</emphasis></screen>

<screen><prompt>R1#</prompt> sh ipv6 ospf6
 OSPFv3 Routing Process (0) with <emphasis>Router-ID 0.0.1.6</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment identifier le type de réseau d'une
		interface&nbsp;?</phrase></para>
		
		<para>À partir des résultats des questions précédentes, rechercher
		l'information demandée.</para>
	</question>
	<answer>
		<para>Comme on utilise uniquement des liens Ethernet dans ce contexte
		de travaux pratiques, le type de réseau est nécessairement
		diffusion.</para>

<screen><prompt>R1#</prompt> show ip ospf interface eth0.12
eth0.12 is up
  ifindex 2, MTU 1500 bytes, BW 1000000 Kbit &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.12.1/26, Broadcast 10.1.12.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.1.4, <emphasis>Network Type BROADCAST</emphasis>, Cost: 1</screen>

<screen><prompt>R1#</prompt> show ipv6 ospf6 interface eth0.12
eth0.12 is up, <emphasis>type BROADCAST</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment obtenir la liste du ou des routeurs voisins pour
		chaque processus de protocole de routage dynamique
		<acronym>OSPFv2</acronym> ou
		<acronym>OSPFv3</acronym>&nbsp;?</phrase></para>

		<para>Dès qu'une interface est active, il y a émission de paquets
		<option>HELLO</option> et si un routeur avec un démon
		<acronym>OSPF</acronym> envoie aussi des paquets
		<option>HELLO</option> dans le même <acronym>VLAN</acronym>, les deux
		routeurs cherchent à former une adjacence.</para> 

		<para>La liste des commandes utiles dans la console
		<application>vtysh</application> est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip ospf neighbor</command></member>
		<member><command>show ipv6 ospf6 neighbor</command></member>
		</simplelist>
	</question>
	<answer>
		<para>À nouveau sur le routeur <systemitem>R1</systemitem>, voici un
		exemple de liste de routeurs <acronym>OSPF</acronym> voisins dans
		laquelle on reconnaît les identifiants des routeurs
		<systemitem>R2</systemitem> et <systemitem>R3</systemitem>.</para>

<screen><prompt>R1#</prompt> show ip ospf neighbor

Neighbor ID     Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL
0.0.2.4           1 Full/DR           32.395s 10.1.12.2       eth0.12:10.1.12.1        0     0     0
0.0.3.4           1 Full/DR           38.317s 10.1.13.3       eth0.13:10.1.13.1        0     0     0</screen>

<screen><prompt>R1#</prompt> show ipv6 ospf6 neighbor
Neighbor ID     Pri    DeadTime  State/IfState         Duration I/F[State]
0.0.2.6           1    00:00:31   Full/DR              02:04:11 eth0.12[BDR]
0.0.3.6           1    00:00:31   Full/DR              02:04:01 eth0.13[BDR]</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment identifier le rôle des différentes interfaces des
		routeurs pour chacun des liens du triangle de la topologie
		logique&nbsp;?</phrase></para>

	<warning>
		<para>La réponse à cette question suppose que les démons
		<acronym>OSPF</acronym> des trois routeurs de la topologie logique en
		triangle aient convergé. On doit repérer l'état <option>Full</option>
		pour les listes de routeurs voisins.</para>

		<para>De plus, la réponse varie en fonction de l'ordre d'activation des
		démons <acronym>OSPF</acronym> des différents routeurs. En effet, un
		routeur peut être élu routeur désigné (<acronym>DR</acronym>) en
		l'absence de routeurs voisins. Cette élection n'est pas remise en cause
		tant qu'il n'y pas de changement d'état de lien.</para>
	</warning>

		<para>À partir des résultats des questions précédentes sur les
		interfaces actives, il est possible de compléter le schéma de la
		topologie étudiée avec l'état des interfaces pour chacun des trois
		liens.</para>
	</question>
	<answer>
	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG'
		fileref='images/interco.ospf.logical-topology-link-state.png'
		width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG'
		fileref='images/interco.ospf.logical-topology-link-state.png'
		width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Topologie logique OSPF et rôle des interfaces de
		routeurs</phrase>
	</textobject>
	</mediaobject>

		<para>Sur un même réseau de diffusion, il est possible de trouver
		plusieurs routeurs <acronym>OSPF</acronym>. Établir une relation de
		voisinage et procéder aux échanges de bases de données topologiques
		entre chaque routeur revient à constituer un réseau de relations
		complètement maillé. À chaque recalcul de topologie, ce réseau
		complètement maillé est inefficace. C'est la raison pour laquelle la
		notion de routeur référent ou <wordasword>Designated
		Router</wordasword> a été introduite. Lors d'un recalcul de topologie,
		tous les routeurs s'adressent au référent qui correspond au cœur d'un
		réseau en topologie étoile.</para>

		<para>Dans le contexte de la topologie triangle étudiée, il y a bien
		élection d'un routeur référent et d'un routeur référent de secours.
		Cependant, comme il n'y a que deux routeurs par domaine de diffusion ou
		<acronym>VLAN</acronym>, on ne peut pas caractériser l'utilité de cette
		élection.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les réseaux <acronym>IPv4</acronym> et
		<acronym>IPv6</acronym> présents dans la base calcul du protocole
		<acronym>OSPF</acronym>&nbsp;?</phrase></para>

		<para>On cherche a visualiser la liste des préfixes des réseaux connus
		des deux démons <acronym>OSPF</acronym>.</para>

		<para>La liste des commandes utiles dans la console
		<application>vtysh</application> est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip ospf route</command></member>
		<member><command>show ipv6 ospf6 route</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Une fois que les trois routeurs de la topologie ont convergé,
		chaque démon connaît les trois préfixes qui correspondent aux trois
		côtés du triangle. Un routeur correspond à un sommet du triangle et il
		doit apprendre le préfixe réseau du côté opposé via ses deux routeurs
		voisins.</para>

		<para>Voici la vue depuis le routeur
		<systemitem>R1</systemitem>.</para>

<screen><prompt>R1#</prompt> sh ip ospf route
============ OSPF network routing table ============
N    10.1.12.0/26          [1] area: 0.0.0.0
                           directly attached to eth0.12
N    10.1.13.0/26          [1] area: 0.0.0.0
                           directly attached to eth0.13
N    10.1.23.0/26          [2] area: 0.0.0.0
                           via 10.1.12.2, eth0.12
                           via 10.1.13.3, eth0.13

============ OSPF router routing table =============

============ OSPF external routing table ===========</screen>

		<para>Les valeurs notées entre crochets correspondent à la métrique du
		lien pour joindre le réseau noté à gauche. Pour le protocole
		<acronym>OSPF</acronym>, le calcul de métrique se fait à partir de
		l'expression : 10<superscript>8</superscript> /
		Bande_Passante_du_lien.</para>

		<para>La valeur du numérateur (10<superscript>8</superscript>)
		correspond à un débit de 100Mbps. À l'époque de la rédaction du
		standard <acronym>OSPFv2</acronym>, ce débit a servi de référence.
		Aujourd'hui, cette valeur est complètement dépassée. C'est la raison
		pour laquelle on adapte le calcul de métrique en changeant le
		coefficient du numérateur. Voir la <xref
		linkend='interco.ospf-quagga.auto-cost' />.</para> 

		<para>Les deux premiers réseaux de la table sont joignable via un lien
		Ethernet à 1000Mbps ; soit une métrique de <option>1</option>. Le
		troisième réseau est joignable via deux liens Ethernet à 1000Mbps ;
		d'où la métrique de <option>2</option>.</para>

		<para>Pour les préfixes <acronym>IPv6</acronym>, les métriques
		n'apparaissent pas.</para> 

<screen><prompt>R1#</prompt> sh ipv6 ospf6 route
*N IA 2001:678:3fc:c::/64            ::                        eth0.12 18:41:10
*N IA 2001:678:3fc:d::/64            ::                        eth0.13 18:41:00
*N IA 2001:678:3fc:17::/64           fe80::4c8c:2aff:fe42:b075 eth0.12 18:41:00
                                     fe80::440:39ff:fe30:710c  eth0.13</screen>

		<para>Avec <acronym>OSPFv3</acronym>, les relations de voisinage entre
		routeurs utilisent nécessairement les adresses de lien local
		appartenant au préfixe <systemitem
		class='ipaddress'>fe80::/10</systemitem>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment visualiser les tables de routage depuis la
		console <command>vtysh</command>&nbsp;?</phrase></para>

		<para>L'affichage demandé illustre les mécanismes de choix entre
		différentes solutions pour une même destination. Cet affichage est à
		comparer avec celui demandé à la question suivante.</para>

		<para>La liste des commandes utiles dans la console
		<application>vtysh</application> est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip route</command></member>
		<member><command>show ipv6 route</command></member>
		</simplelist>
	</question>
	<answer>
<screen><prompt>R1#</prompt> show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* 0.0.0.0/0 via 192.0.2.1, eth0
O   10.1.12.0/26 [110/1] is directly connected, eth0.12, 18:57:52
C>* 10.1.12.0/26 is directly connected, eth0.12
O   10.1.13.0/26 [110/1] is directly connected, eth0.13, 18:57:36
C>* 10.1.13.0/26 is directly connected, eth0.13
O>* 10.1.23.0/26 [110/2] via 10.1.12.2, eth0.12, 18:57:36
  *                      via 10.1.13.3, eth0.13, 18:57:36
C>* 127.0.0.0/8 is directly connected, lo
C>* 192.0.2.0/27 is directly connected, eth0</screen>

<screen><prompt>R1#</prompt> show ipv6 route
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv6, I - IS-IS, B - BGP, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* ::/0 via fe80::dc02:44ff:fe64:4834, eth0
C>* ::1/128 is directly connected, lo
C>* 2001:678:3fc:a::/64 is directly connected, eth0
O   2001:678:3fc:c::/64 [110/1] is directly connected, eth0.12, 18:50:54
C>* 2001:678:3fc:c::/64 is directly connected, eth0.12
O   2001:678:3fc:d::/64 [110/1] is directly connected, eth0.13, 18:50:44
C>* 2001:678:3fc:d::/64 is directly connected, eth0.13
O>* 2001:678:3fc:17::/64 [110/2] via fe80::4c8c:2aff:fe42:b075, eth0.12, 18:50:44
  *                              via fe80::440:39ff:fe30:710c, eth0.13, 18:50:44
C * fe80::/64 is directly connected, eth0
C * fe80::/64 is directly connected, eth0.13
C>* fe80::/64 is directly connected, eth0.12</screen>
		<itemizedlist>
		<listitem>
			<para>Les entrées avec le caractère <option>*</option>
			correspondent aux routes proposées par la suite
			<application>Quagga</application> au sous-système réseau du noyau.
			Les autres entrées sont placées en réserve au cas où la solution
			initialement proposée viendrait à faire défaut.</para>
		</listitem>
		<listitem>
			<para>L'entrée notée <option>K</option> correspond à une route
			apprise via la configuration système.</para>
		</listitem>
		<listitem>
			<para>Les entrées notées <option>C</option> correspondent à des
			routes pour lesquelles il existe une interface sur le routeur. Les
			métriques de ses routes ont la valeur <option>0</option>. Ce sont
			les routes les plus prioritaires.</para>
		</listitem>
		<listitem>
			<para>Les entrées notées <option>O</option> correspondent aux
			routes apprises via le protocole <acronym>OSPF</acronym>. La
			métrique de ces routes se décompose en deux parties. La valeur
			figée à <option>110</option> définit le niveau de priorité du
			protocole <acronym>OSPF</acronym> (<wordasword>Administrative
			Distance</wordasword>) relativement aux autres protocoles de
			routage. Les valeurs notées après le <option>/</option> sont les
			métriques de liens calculées comme indiqué ci-dessus.</para>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment visualiser les tables de routage au niveau
		système&nbsp;?</phrase></para>

		<para>Utiliser une commande usuelle de visualisation de la table de
		routage.</para>

		<simplelist type='horiz'>
		<member><command>ip route ls</command></member>
		<member><command>ip -6 route ls</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Avec la commande <command>ip</command>, on voit apparaître les
		«sources» d'alimentation de la table de routage finale du
		système.</para>

		<itemizedlist>
		<listitem>
			<para><option>kernel</option> pour les entrées connues du
			sous-système réseau du noyau. Ce sont les entrées avec le caractère
			<option>C</option> dans la console <command>vtysh</command>.</para>
		</listitem>
		<listitem>
			<para><option>zebra</option> pour les entrées apprises via la suite
			<application>Quagga</application>. Le réseau correspondant au côté
			opposé au sommet du triangle est appris via <acronym>OSPF</acronym>
			puisque le sous-système réseau du noyau ne le connaît pas.</para>
		</listitem>
		<listitem>
			<para><option>ra</option> pour la route par défaut
			<acronym>IPv6</acronym>. Le routeur <systemitem>R1</systemitem> se
			distingue des deux autres routeurs par le fait qu'il dispose d'un
			accès vers l'Internet. Ici, la route par défaut a été apprise par
			auto configuration <acronym>SLAAC</acronym>.</para>
		</listitem>
		</itemizedlist>

<screen><prompt>R1:~#</prompt> ip route ls
default via 192.0.2.1 dev eth0 onlink
10.1.12.0/26 dev eth0.12 <emphasis>proto kernel</emphasis> scope link src 10.1.12.1
10.1.13.0/26 dev eth0.13 <emphasis>proto kernel</emphasis> scope link src 10.1.13.1
10.1.23.0/26 <emphasis>proto</emphasis> zebra metric 20
        nexthop via 10.1.12.2 dev eth0.12 weight 1
        nexthop via 10.1.13.3 dev eth0.13 weight 1
192.0.2.0/27 dev eth0 <emphasis>proto kernel</emphasis> scope link src 192.0.2.9</screen>

<screen><prompt>R1:~#</prompt> ip -6 route ls
2001:678:3fc:a::/64 dev eth0 <emphasis>proto kernel</emphasis> metric 256 expires 86285sec pref medium
2001:678:3fc:c::/64 dev eth0.12 <emphasis>proto kernel</emphasis> metric 256 pref medium
2001:678:3fc:d::/64 dev eth0.13 <emphasis>proto kernel</emphasis> metric 256 pref medium
2001:678:3fc:17::/64 <emphasis>proto zebra</emphasis> metric 20
        nexthop via fe80::4c8c:2aff:fe42:b075 dev eth0.12 weight 1
        nexthop via fe80::440:39ff:fe30:710c dev eth0.13 weight 1 pref medium
fe80::/64 dev eth0 <emphasis>proto</emphasis> kernel metric 256 pref medium
fe80::/64 dev eth0.12 <emphasis>proto kernel</emphasis> metric 256 pref medium
fe80::/64 dev eth0.13 <emphasis>proto kernel</emphasis> metric 256 pref medium
default via fe80::dc02:44ff:fe64:4834 dev eth0 <emphasis>proto ra</emphasis> metric 1024 expires 1685sec hoplimit 64 pref medium</screen>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.default-information'>
	<title>Publication d'une route par défaut via OSPF</title>

	<para>Dans la topologie logique étudiée, le routeur <systemitem
	class='systemname'>R1</systemitem> dispose d'un lien montant vers
	l'Internet. On peut donc considérer que ce lien est la route par défaut
	vers tous les réseaux non connus de l'aire <acronym>OSPF</acronym>
	contenant les trois routeurs.</para>

	<para>Il est possible de publier une route par défaut via le protocole
	<acronym>OSPF</acronym> depuis le routeur <systemitem
	class='systemname'>R1</systemitem> vers les routeurs <systemitem
	class='systemname'>R2</systemitem> et <systemitem
	class='systemname'>R3</systemitem>.</para>

	<para>Voici, pour mémoire, une copie des bases de données
	<acronym>OSPFv2</acronym> et <acronym>OSPFv3</acronym> avant la mise en
	place de la publication de route par défaut. On reconnaît les
	<acronym>LSA</acronym>s (<wordasword>Link State
	Advertisement)</wordasword>) de type 1 et 2 qui correspondent
	respectivement aux annonces de routeurs et de réseaux.</para>

<screen><prompt>R1#</prompt> sh ip ospf database

       OSPF Router with ID (0.0.1.4)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
0.0.1.4         0.0.1.4          546 0x80000035 0xff9f 2
0.0.2.4         0.0.2.4          745 0x8000008d 0x1d13 2
0.0.3.4         0.0.3.4         1157 0x80000061 0xaba9 2

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.1.12.2       0.0.2.4          565 0x80000032 0xd964
10.1.13.3       0.0.3.4          867 0x80000031 0xcc6e
10.1.23.2       0.0.2.4          505 0x8000005a 0x26e2</screen>

<screen><prompt>R1#</prompt> show ipv6 ospf6 database

        Area Scoped Link State Database (Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Rtr  0.0.0.0        0.0.1.6         540 80000032                0.0.2.6/0.0.0.2
Rtr  0.0.0.0        0.0.1.6         540 80000032                0.0.3.6/0.0.0.2
Rtr  0.0.0.0        0.0.2.6         551 80000086                0.0.2.6/0.0.0.2
Rtr  0.0.0.0        0.0.2.6         551 80000086                0.0.2.6/0.0.0.3
Rtr  0.0.0.0        0.0.3.6         541 8000005d                0.0.3.6/0.0.0.2
Rtr  0.0.0.0        0.0.3.6         541 8000005d                0.0.2.6/0.0.0.3
Net  0.0.0.2        0.0.2.6         551 80000030                        0.0.2.6
Net  0.0.0.2        0.0.2.6         551 80000030                        0.0.1.6
Net  0.0.0.3        0.0.2.6        1485 8000005a                        0.0.2.6
Net  0.0.0.3        0.0.2.6        1485 8000005a                        0.0.3.6
Net  0.0.0.2        0.0.3.6         541 80000030                        0.0.3.6
Net  0.0.0.2        0.0.3.6         541 80000030                        0.0.1.6
INP  0.0.0.2        0.0.2.6         551 80000030            2001:678:3fc:c::/64
INP  0.0.0.3        0.0.2.6        1485 8000005a           2001:678:3fc:17::/64
INP  0.0.0.2        0.0.3.6         541 80000030            2001:678:3fc:d::/64

        I/F Scoped Link State Database (I/F eth0.12 in Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Lnk  0.0.0.2        0.0.1.6         553 80000030      fe80::c828:72ff:fedf:3608
Lnk  0.0.0.2        0.0.2.6        1191 80000084      fe80::4c8c:2aff:fe42:b075

        I/F Scoped Link State Database (I/F eth0.13 in Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Lnk  0.0.0.3        0.0.1.6         550 80000030      fe80::c828:72ff:fedf:3608
Lnk  0.0.0.2        0.0.3.6        1492 8000005a       fe80::440:39ff:fe30:710c

        AS Scoped Link State Database

Type LSId           AdvRouter       Age   SeqNum                        Payload</screen>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelle est la condition préalable à respecter pour que le
		routeur <systemitem class='systemname'>R1</systemitem> soit en mesure
		de publier une route par défaut via son démon
		<acronym>OSPF</acronym>&nbsp;?</phrase></para>

		<para>À partir des tables de routage relevées dans la <xref
		linkend='interco.ospf-quagga.protocol-config' />, repérer le routeur
		qui dispose d'un accès vers un réseau qui n'appartient pas à la
		topologie triangle.</para>

		<simplelist type='horiz'>
		<member><command>ip route ls default</command></member>
		<member><command>ip -6 route ls default</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Une route par défaut doit exister avant d'être injectée dans une
		aire <acronym>OSPF</acronym>. Dans notre cas, une route statique par
		défaut suffit à respecter la condition préalable.</para>

		<para>Sur la maquette, on valide la présence des routes par défaut à
		l'aide la commande <command>ip</command> au niveau système.</para>

<screen><prompt>R1:~#</prompt> ip route ls default
default via 192.0.2.1 dev eth0 onlink</screen>

<screen><prompt>R1:~#</prompt> ip -6 route ls default
default via fe80::dc02:44ff:fe64:4834 dev eth0 proto ra metric 1024 \
				expires 1463sec hoplimit 64 pref medium</screen>

		<para>Au niveau de la console <command>vtysh</command>, ces même routes
		correspondent aux entrées marquées <option>K</option> pour
		<wordasword>kernel</wordasword>.</para>

<screen><prompt>R1#</prompt> sh ip route kernel
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, P - PIM, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* <emphasis>0.0.0.0/0 via 192.0.2.1, eth0</emphasis></screen>

<screen><prompt>R1#</prompt> sh ipv6 route kernel
Codes: K - kernel route, C - connected, S - static, R - RIPng,
       O - OSPFv6, I - IS-IS, B - BGP, A - Babel, N - NHRP,
       > - selected route, * - FIB route

K>* <emphasis>::/0 via fe80::dc02:44ff:fe64:4834, eth0</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelle est l'instruction à utiliser pour publier une
		route par défaut via le protocole de routage <acronym>OSPFv2</acronym>
		pour <acronym>IPv4</acronym>&nbsp;?</phrase></para>

		<para>Parmi toutes les méthodes de redistribution de routes disponibles
		avec protocole <acronym>OSPFv2</acronym>, il en existe une dédiée à
		l'injection de route par défaut dans une aire normale&nbsp;: Voir <xref
		linkend='interco.ospf-quagga.refdocs.quagga-command-index' />.</para>

		<para>Rechercher le mot clé <option>default</option> dans
		l'index.</para>
	</question>
	<answer>
		<para>L'instruction qui correspond le plus simplement à la
		redistribution de route par défaut est la suivante.</para>

		<simplelist type='horiz'>
		<member><command>default-information originate</command></member>
		</simplelist>

		<para>On doit l'appliquer au démon de routage <acronym>OSPFv2</acronym>
		uniquement sur le routeur <systemitem
		class='systemname'>R1</systemitem>.</para>

<screen><prompt>R1#</prompt> conf t
R1(config)# router ospf
R1(config-router)# default-information originate
R1(config-router)# ^Z</screen>

		<para>Une fois cette instruction exécutée, la base de données
		<acronym>OSPFv2</acronym> est complétée avec une nouvelle
		entrée.</para>

<screen><prompt>R1#</prompt> sh ip ospf database

       OSPF Router with ID (0.0.1.4)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
0.0.1.4         0.0.1.4         1203 0x80000039 0xfd9b 2
0.0.2.4         0.0.2.4          791 0x80000091 0x1517 2
0.0.3.4         0.0.3.4         1324 0x80000065 0xa3ad 2

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.1.12.2       0.0.2.4          511 0x80000036 0xd168
10.1.13.3       0.0.3.4          884 0x80000035 0xc472
10.1.23.2       0.0.2.4          611 0x8000005e 0x1ee6

                <emphasis>AS External Link States</emphasis>

Link ID         ADV Router      Age  Seq#       CkSum  Route
0.0.0.0         0.0.1.4          133 0x80000004 0x229e <emphasis>E2 0.0.0.0/0</emphasis> [0x0]</screen>

		<para>On voit apparaître une nouvelle rubrique baptisée <wordasword>AS
		External Link States</wordasword>. Ce nouveau rôle pour le routeur
		<systemitem class='systemname'>R1</systemitem> apparaît aussi lorsque
		l'on affiche l'état de l'instance de routage
		<acronym>OSPFv2</acronym>.</para>

<screen><prompt>R1#</prompt> show ip ospf
 OSPF Routing Process, Router ID: 0.0.1.4
 Supports only single TOS (TOS0) routes
 This implementation conforms to RFC2328
 RFC1583Compatibility flag is disabled
 OpaqueCapability flag is disabled
 Initial SPF scheduling delay 0 millisec(s)
 Minimum hold time between consecutive SPFs 50 millisec(s)
 Maximum hold time between consecutive SPFs 5000 millisec(s)
 Hold time multiplier is currently 1
 SPF algorithm last executed 1h21m25s ago
 Last SPF duration 90 usecs
 SPF timer is inactive
 Refresh timer 10 secs
 <emphasis>This router is an ASBR (injecting external routing information)</emphasis>
 Number of external LSA 1. Checksum Sum 0x0000229e
 Number of opaque AS LSA 0. Checksum Sum 0x00000000
 Number of areas attached to this router: 1
 Adjacency changes are logged

 Area ID: 0.0.0.0 (Backbone)
   Number of interfaces in this area: Total: 2, Active: 2
   Number of fully adjacent neighbors in this area: 2
   Area has no authentication
   SPF algorithm executed 8 times
   Number of LSA 6
   Number of router LSA 3. Checksum Sum 0x0001b65f
   Number of network LSA 3. Checksum Sum 0x0001b4c0
   Number of summary LSA 0. Checksum Sum 0x00000000
   Number of ASBR summary LSA 0. Checksum Sum 0x00000000
   Number of NSSA LSA 0. Checksum Sum 0x00000000
   Number of opaque link LSA 0. Checksum Sum 0x00000000
   Number of opaque area LSA 0. Checksum Sum 0x00000000</screen>

		<para>Le routeur <systemitem class='systemname'>R1</systemitem>, est
		maintenant à la frontière entre deux systèmes autonomes. Il a le rôle
		<acronym>ASBR</acronym> (<wordasword>Autonmous System Border
		Router</wordasword>) et il est responsable de l'émission des
		<acronym>LSA</acronym>s de type 5 à destination des autres routeurs de
		l'aire.</para>

		<para>Ici, <systemitem class='systemname'>R1</systemitem> utilise
		<acronym>OSPF</acronym> et possède une route statique définie au niveau
		système vers l'Internet. L'instruction donnée ci-dessus assure la
		redistribution de la route statique vers <systemitem
		class='systemname'>R2</systemitem> et <systemitem
		class='systemname'>R3</systemitem>. Cette route apparaît comme une
		entrée de type <option>E2</option> dans les tables de routage de ces
		routeurs.</para>

		<para>L'indicateur <option>E2</option> correspond au type par défaut
		des routes apprises par le biais de la redistribution. La métrique est
		un point important à considérer avec les routes de type
		<option>E2</option>. Ces routes ne présentent que le coût du chemin
		allant du routeur <acronym>ASBR</acronym> vers le réseau de
		destination&nbsp;; ce qui ne correspond pas au coût réel du chemin à
		l'intérieur de	l'aire <acronym>OSPF</acronym>.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les instructions à utiliser pour publier une
		route par défaut via le protocole de routage <acronym>OSPFv3</acronym>
		pour <acronym>IPv6</acronym>&nbsp;?</phrase></para>

		<para>Parmi toutes les méthodes de redistribution de routes disponibles
		avec le	protocole <acronym>OSPFv3</acronym>, celle qui nous intéresse
		est relative aux entrées apprises via le noyau. En effet, dans la
		première question de cette section sur la présence d'une route par
		défaut, nous avons identifié les entrées marquées <option>K</option>
		dans les tables de routage.</para>

		<para>Pour traiter cette question, il faut isoler le préfixe
		correspondant à la route par défaut, créer une carte de routage qui
		établit la correspondance avec ce préfixe et enfin redistribuer les
		routes apprises du noyau dans <acronym>OSPFv3</acronym> à partir de la
		carte.</para>

		<para>Les instrcutions à utiliser pour traiter cette question entrent
		dans la liste suivante.</para>

		<simplelist type='horiz'>
		<member><command>ipv6 prefix-list</command></member>
		<member><command>route-map</command></member>
		<member><command>match ipv6 address prefix-list</command></member>
		<member><command>redistribute kernel route-map</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Voici la séquence des instructions qui permet de redistribuer
		uniquement la route par défaut apprise via le noyau dans
		<acronym>OSPFv3</acronym>.</para>

<screen><prompt>R1#</prompt> conf t
R1(config)# ipv6 prefix-list IPv6-DEFAULT-PLIST seq 5 permit ::/0
R1(config)# route-map IPv6-DEFAULT-RMAP permit 1
R1(config-route-map)# match ipv6 address prefix-list IPv6-DEFAULT-PLIST
R1(config-route-map)# exit
R1(config)# router ospf6
R1(config-ospf6)# redistribute kernel route-map IPv6-DEFAULT-RMAP
R1(config-ospf6)# ^Z</screen>

		<para>Une fois cette instruction exécutée, la base de données
		<acronym>OSPFv3</acronym> est complétée avec une nouvelle
		entrée.</para>

<screen><prompt>R1#</prompt> show ipv6 ospf6 database

        Area Scoped Link State Database (Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Rtr  0.0.0.0        0.0.1.6         208 80000039                0.0.2.6/0.0.0.2
Rtr  0.0.0.0        0.0.1.6         208 80000039                0.0.3.6/0.0.0.2
Rtr  0.0.0.0        0.0.2.6         216 8000008b                0.0.2.6/0.0.0.2
Rtr  0.0.0.0        0.0.2.6         216 8000008b                0.0.2.6/0.0.0.3
Rtr  0.0.0.0        0.0.3.6         206 80000062                0.0.3.6/0.0.0.2
Rtr  0.0.0.0        0.0.3.6         206 80000062                0.0.2.6/0.0.0.3
Net  0.0.0.2        0.0.2.6         216 80000035                        0.0.2.6
Net  0.0.0.2        0.0.2.6         216 80000035                        0.0.1.6
Net  0.0.0.3        0.0.2.6        1150 8000005f                        0.0.2.6
Net  0.0.0.3        0.0.2.6        1150 8000005f                        0.0.3.6
Net  0.0.0.2        0.0.3.6         206 80000035                        0.0.3.6
Net  0.0.0.2        0.0.3.6         206 80000035                        0.0.1.6
INP  0.0.0.2        0.0.2.6         216 80000035            2001:678:3fc:c::/64
INP  0.0.0.3        0.0.2.6        1150 8000005f           2001:678:3fc:17::/64
INP  0.0.0.2        0.0.3.6         206 80000035            2001:678:3fc:d::/64

        I/F Scoped Link State Database (I/F eth0.12 in Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Lnk  0.0.0.2        0.0.1.6         218 80000035      fe80::c828:72ff:fedf:3608
Lnk  0.0.0.2        0.0.2.6         856 80000089      fe80::4c8c:2aff:fe42:b075

        I/F Scoped Link State Database (I/F eth0.13 in Area 0.0.0.0)

Type LSId           AdvRouter       Age   SeqNum                        Payload
Lnk  0.0.0.3        0.0.1.6         215 80000035      fe80::c828:72ff:fedf:3608
Lnk  0.0.0.2        0.0.3.6        1157 8000005f       fe80::440:39ff:fe30:710c

        <emphasis>AS Scoped Link State Database</emphasis>

Type LSId           AdvRouter       Age   SeqNum                        Payload
ASE  0.0.0.1        0.0.1.6         208 80000001                             ::</screen>

		<para>On voit apparaître une nouvelle rubrique baptisée <wordasword>AS
		Scoped Link State Database</wordasword>. Ce nouveau rôle pour le
		routeur <systemitem class='systemname'>R1</systemitem> apparaît aussi
		lorsque l'on affiche l'état de l'instance de routage
		<acronym>OSPFv3</acronym>.</para>

<screen><prompt>R1#</prompt> show ipv6 ospf6
 OSPFv3 Routing Process (0) with Router-ID 0.0.1.6
 Running 1d02:39:46
 Initial SPF scheduling delay 0 millisec(s)
 Minimum hold time between consecutive SPFs 50 millsecond(s)
 Maximum hold time between consecutive SPFs 5000 millsecond(s)
 Hold time multiplier is currently 1
 SPF algorithm has not been run$
 SPF timer is inactive
 <emphasis>Number of AS scoped LSAs is 1</emphasis>
 Number of areas in this router is 1
 Adjacency changes are logged

 Area 0.0.0.0
     Number of Area scoped LSAs is 9
     Interface attached to this area: eth0.12 eth0.13</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment la publication de route par défaut apparaît-elle
		sur les autres routeurs de la topologie triangle&nbsp;?</phrase></para>

		<para>Relevez, dans la console <command>vtysh</command>, la métrique de
		la route par défaut sur les routeurs qui n'ont pas une connexion
		directe vers l'Internet.</para>

		<para>Les instrcutions à utiliser pour traiter cette question entrent
		dans la liste suivante.</para>

		<simplelist type='horiz'>
		<member><command>show ip route A.B.C.D/MM</command></member>
		<member><command>show ipv6 route A:B:C::D/MM</command></member>
		<member><command>show ip ospf route</command></member>
		<member><command>show ipv6 ospf6 route</command></member>
		</simplelist>
	</question>
	<answer>
		<para>En prenant l'exemple du routeur <systemitem
		class='systemname'>R2</systemitem>, on retrouve les informations
		suivantes.</para>

		<itemizedlist>
		<listitem>
		<para>Vue de la table de routage&nbsp;:</para>

<screen><prompt>R2#</prompt> sh ip route 0.0.0.0/0
Routing entry for 0.0.0.0/0
  <emphasis>Known via "ospf"</emphasis>, distance 110, metric 10, tag 0, vrf 0, best, fib
  Last update 01:54:46 ago
  >* 10.1.12.1, via eth0.12</screen>

<screen><prompt>R2#</prompt> sh ipv6 route ::/0
Routing entry for ::/0
  <emphasis>Known via "ospf6"</emphasis>, distance 110, metric 1, tag 0, vrf 0, best, fib
  Last update 00:12:24 ago
  >* fe80::c828:72ff:fedf:3608, via eth0.12</screen>
		</listitem>
		<listitem>
		<para>Vue de la base de topologie <acronym>OSPF</acronym>&nbsp;:</para>

<screen><prompt>R2#</prompt> sh ip ospf route
============ OSPF network routing table ============
N    10.1.12.0/26          [1] area: 0.0.0.0
                           directly attached to eth0.12
N    10.1.13.0/26          [2] area: 0.0.0.0
                           via 10.1.12.1, eth0.12
                           via 10.1.23.3, eth0.23
N    10.1.23.0/26          [1] area: 0.0.0.0
                           directly attached to eth0.23

============ OSPF router routing table =============
R    0.0.1.4               [1] area: 0.0.0.0, ASBR
                           via 10.1.12.1, eth0.12

============ OSPF external routing table ===========
<emphasis>N E2 0.0.0.0/0</emphasis>             [1/10] tag: 0
                           via 10.1.12.1, eth0.12</screen>

<screen><prompt>R2#</prompt> show ipv6 ospf6 route
<emphasis>*N E1 ::/0</emphasis>                           fe80::c828:72ff:fedf:3608 eth0.12 00:18:25
*N IA 2001:678:3fc:c::/64            ::                        eth0.12 1d02:18:38
*N IA 2001:678:3fc:d::/64            fe80::c828:72ff:fedf:3608 eth0.12 1d02:18:28
                                     fe80::440:39ff:fe30:710c  eth0.23
*N IA 2001:678:3fc:17::/64           ::                        eth0.23 1d23:34:11</screen>
		</listitem>
		</itemizedlist>

		<para>Avec les copies d'écran ci-dessus, on vérifie bien que les routes
		par défaut ont été apprises via le protocole
		<acronym>OSPF</acronym>.</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.dummies'>
	<title>Ajout de réseaux fictifs</title>

	<para>L'introduction de nouvelles entrées fictives dans les tables de
	routage est une pratique très répandue. Elle permet de qualifier le bon
	fonctionnement du filtrage réseau ou d'un service Internet sans ajouter de
	matériel. Cette section décrit justement la mise en place d'un service Web
	de test.</para>

	<para>Pour réaliser ces manipulations, on dispose de deux techniques
	distinctes.</para>

	<itemizedlist>
	<listitem>
	<para>Historiquement, la première solution consiste à utiliser des
	interfaces de boucles locales comme sur les équipements
	<trademark>Cisco</trademark> ou des interfaces de type
	<wordasword>dummy</wordasword> sur les systèmes	GNU/Linux.</para>

	<para>Cette solution est satisfaisante du point de vue protocole de
	routage, mais ces interfaces ne participent pas au routage sur le système
	sur lequel elles sont implantées. Elles servent aux annonces des protocoles
	de routage dynamique et sont joignables à distance.</para>

	<para>Ce type d'interface est utilisé sur le routeur <systemitem
	class='systemname'>R1</systemitem> dans la <xref
	linkend='interco.ospf-quagga.fake-routes.dummies' />.</para>
	</listitem>

	<listitem>
	<para>Avec le recours de plus en plus fréquent à la virtualisation et aux
	conteneurs, de nouveaux types d'interfaces virtuelles ont été
	introduits&nbsp;: <systemitem>tap</systemitem> et
	<systemitem>veth</systemitem>. Pour simplifier au maximum, les interfaces
	<systemitem>tap</systemitem> sont des cordons de brassage et les interfaces
	<systemitem>veth</systemitem> sont des liens point à point isolés.</para> 

	<para>Dans notre contexte, chaque paire d'interfaces
	<systemitem>veth</systemitem> nous sert à introduire nouveau réseau fictif
	sans ajouter un seul équipement matériel supplémentaire.</para>

	<para>Relativement aux interface de type <systemitem>dummy</systemitem>,
	l'utilisation d'un lien point à point provoque effectivement une décision
	de routage au sein du noyau sur lequel ce lien est implanté.</para>

	<para>Pour compléter un peu plus le scénario du réseau factice, on peut
	utiliser les espaces de noms réseau (<wordasword>network
	namespaces</wordasword>). Un espace de nom réseau désigne un ensemble
	d'interfaces associées à une table de routage indépendante. Dans notre
	contexte, on place une extrémité du lien point à point, c'est à dire une
	interface <systemitem>veth</systemitem>, dans un espace de nom
	différent.</para>

	<para>Cet espace de nom réseau et le type d'interface
	<systemitem>veth</systemitem> sont utilisés sur les routeurs <systemitem
	class='systemname'>R2</systemitem> et <systemitem
	class='systemname'>R3</systemitem> dans la <xref
	linkend='interco.ospf-quagga.fake-routes.veth' />.</para>
	</listitem>
	</itemizedlist>
</sect1>

<sect1 xml:id='interco.ospf-quagga.fake-routes.dummies'>
	<title>Interfaces de type <wordasword>dummy</wordasword></title>

	<para>Dans cette section, on créé une interface de type
	<systemitem>dummy</systemitem> et on installe un service Web uniquement en
	écoute sur les adresses <acronym>IPv4</acronym> et <acronym>IPv6</acronym>
	de cette interface. Enfin, on publie ce nouveau réseau factice via le
	protocole de routage dynamique <acronym>OSPF</acronym>.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour créer et
		configurer une interface réseau virtuelle de type
		<systemitem>dummy</systemitem>&nbsp;?</phrase></para>

		<para>Consulter les pages de manuels de la commande
		<command>ip</command> au niveau liaison <command>man ip-link</command>
		et rechercher les information sur le type
		<systemitem>dummy</systemitem>.</para>
	</question>
	<answer>
		<para>Sur le routeur <systemitem class='systemname'>R1</systemitem>, on
		créé une nouvelle interface avec des adresses appartenant à deux
		nouveaux préfixes réseau inconnus des trois routeurs de la topologie
		logique en triangle.</para>

<screen><prompt>#</prompt> ip link add dummy0 type dummy
<prompt>#</prompt> ip link set dev dummy0 up
<prompt>#</prompt> ip addr add 10.1.1.1/29 brd + dev dummy0
<prompt>#</prompt> ip -6 addr add 2001:678:3fc:b::1/64 dev dummy0</screen>

<screen><prompt>R1:~#</prompt> ip route ls dev dummy0
10.1.1.0/29 proto kernel scope link src 10.1.1.1</screen>

<screen><prompt>R1:~#</prompt> ip -6 route ls dev dummy0
2001:678:3fc:b::/64 proto kernel metric 256 pref medium
fe80::/64 proto kernel metric 256 pref medium</screen>

		<para>Cette nouvelle interface apparaît automatiquement dans la console
		unifiée <command>vtysh</command> des démons de routage de la suite
		<citetitle>Quagga</citetitle>.</para>

<screen><prompt>R1#</prompt> sh interface dummy0
<emphasis>Interface dummy0 is up, line protocol is up</emphasis>
  Link ups:       1  last: Mon, 15 Oct 2018 12:01:14 +0000
  Link downs:     0  last: (never)
  vrf: 0
  index 4 metric 0 mtu 1500
  flags: &lt;UP,BROADCAST,RUNNING,NOARP>
  Type: Unknown
  HWaddr: d2:57:b1:cb:be:32
  inet 10.1.1.1/29 broadcast 10.1.1.7
  inet6 fe80::d057:b1ff:fecb:be32/64
  inet6 2001:678:3fc:b::1/64</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment publier les préfixes réseau correspondant à
		l'interface <option>dummy0</option> via <acronym>OSPF</acronym> avec un
		débit binaire de lien à 100Mbps&nbsp;?</phrase></para>

		<para>Une fois la console <application>vtysh</application> ouverte,
		accéder en mode configuration de l'interface puis des deux démons de
		routage.</para>

		<simplelist type='horiz'>
		<member><command>interface dummyX</command></member>
		<member><command>bandwidth</command></member>
		<member><command>router ospf</command></member>
		<member><command>network A.B.C.D/MM area 0</command></member>
		<member><command>router ospf6</command></member>
		<member><command>interface dummyX area 0.0.0.0</command></member>
		</simplelist>
	</question>
	<answer>
		<para>On commence par la définition du débit binaire au niveau de
		l'interface.</para>

<screen><prompt>R1#</prompt> conf t
R1(config)# int dummy0
R1(config-if)# bandwidth 100000
R1(config-if)# ^Z</screen>

		<para>On peut ensuite publier les préfixes réseau
		<acronym>IPv4</acronym> et <acronym>IPv6</acronym> au niveau de chaque
		instance de protocole de routage <acronym>OSPF</acronym>.</para> 

<screen><prompt>R1#</prompt> conf t
R1(config)# router ospf
R1(config-router)# network 10.1.1.0/29 area 0
R1(config-router)# ^Z</screen>

<screen><prompt>R1#</prompt> conf t
R1(config)# router ospf6
R1(config-ospf6)# interface dummy0 area 0.0.0.0
R1(config-ospf6)# ^Z</screen>

		<para>Enfin, on vérifie la présence des deux préfixes réseau dans les
		bases <acronym>OSPF</acronym>.</para>

<screen><prompt>R1#</prompt> sh ip route 10.1.1.0/29
Routing entry for 10.1.1.0/29
  <emphasis>Known via "ospf", distance 110, metric 10, tag 0, vrf 0</emphasis>
  Last update 00:03:45 ago
  >  directly connected, dummy0

Routing entry for 10.1.1.0/29
  Known via "connected", distance 0, metric 0, tag 0, vrf 0, best, fib
  >* directly connected, dummy0</screen>

<screen><prompt>R1#</prompt> sh ipv6 route 2001:678:3fc:b::/64
Routing entry for 2001:678:3fc:b::/64
  <emphasis>Known via "ospf6", distance 110, metric 10, tag 0, vrf 0</emphasis>
  Last update 00:04:20 ago
  >  directly connected, dummy0

Routing entry for 2001:678:3fc:b::/64
  Known via "connected", distance 0, metric 0, tag 0, vrf 0, best, fib
  >* directly connected, dummy0</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quelles sont les opérations à effectuer pour installer un
		service Web en écoute exclusivement sur les adresses
		<acronym>IPv4</acronym> et <acronym>IPv6</acronym> de l'interface
		<option>dummy0</option>&nbsp;?</phrase></para>

		<para>Installer le paquet <systemitem>lighttpd</systemitem> et modifier
		sa configuration pour que le service ne soit accessible que sur les
		adresses de l'interface <systemitem>dummy0</systemitem>.</para>
	</question>
	<answer>
<screen><prompt>#</prompt> aptitude install lighttpd
&lt;snipped/></screen>

		<para>On modifie ensuite le fichier de configuration
		<filename>/etc/lighttpd/lighttpd.conf</filename> de façon à limiter
		l'accès aux adresses voulues.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/lighttpd.conf.patch'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

		<para>On redémarre le service et on affiche la liste des prises réseau
		ouvertes sur le système pour confirmer que les adresses choisies
		sont bien prises en compte.</para>

<screen><prompt>#</prompt> systemctl restart lighttpd

<prompt>#</prompt> ss -nlt '( src :80 )'
State       Recv-Q Send-Q       Local Address:Port      Peer Address:Port
LISTEN      0      128               10.1.1.1:80             0.0.0.0:*
LISTEN      0      128    [2001:678:3fc:b::1]:80                [::]:*</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment valider l'accès à ce service Web depuis les
		autres réseaux&nbsp;?</phrase></para>

		<para>En respectant l'ordre des protocoles de la pile
		<acronym>TCP/IP</acronym>, on commence par valider la connectivité au
		niveau réseau avant de passer à la couche application.</para>
	</question>
	<answer>
		<para>À partir du routeur <systemitem
		class='systemname'>R2</systemitem>, on utilise la séquence
		suivante&nbsp;:</para>

		<itemizedlist>
		<listitem>
			<para>Test <acronym>ICMP</acronym> au niveau réseau&nbsp;:</para>

<screen><prompt>R2:~#</prompt> ping -c2 10.1.1.1
PING 10.1.1.1 (10.1.1.1) 56(84) bytes of data.
64 bytes from 10.1.1.1: icmp_seq=1 ttl=64 time=0.648 ms
64 bytes from 10.1.1.1: icmp_seq=2 ttl=64 time=0.090 ms

--- 10.1.1.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 26ms
rtt min/avg/max/mdev = 0.090/0.369/0.648/0.279 ms</screen>

<screen><prompt>R2:~#</prompt> ping -c2 2001:678:3fc:b::1
PING 2001:678:3fc:b::1(2001:678:3fc:b::1) 56 data bytes
64 bytes from 2001:678:3fc:b::1: icmp_seq=1 ttl=64 time=0.567 ms
64 bytes from 2001:678:3fc:b::1: icmp_seq=2 ttl=64 time=0.086 ms

--- 2001:678:3fc:b::1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 24ms
rtt min/avg/max/mdev = 0.086/0.326/0.567/0.241 ms</screen>
		</listitem>
		<listitem>
			<para>Test <acronym>HTTP</acronym> au niveau
			application&nbsp;:</para>

<screen><prompt>R2:~#</prompt> wget -O /dev/null http://10.1.1.1
--2018-10-15 17:00:47--  http://10.1.1.1/
Connexion à 10.1.1.1:80… connecté.
requête HTTP transmise, en attente de la réponse… <emphasis>200 OK</emphasis>
Taille : 3378 (3,3K) [text/html]
Sauvegarde en : « /dev/null »

/dev/null    100%[======================>]   3,30K  --.-KB/s    ds 0s

2018-10-15 17:00:47 (298 MB/s) — « /dev/null » sauvegardé [3378/3378]</screen>

<screen><prompt>R2:~#</prompt> wget -O /dev/null http://[2001:678:3fc:b::1]
--2018-10-15 17:02:17--  http://[2001:678:3fc:b::1]/
Connexion à [2001:678:3fc:b::1]:80… connecté.
requête HTTP transmise, en attente de la réponse… 200 OK
Taille : 3378 (3,3K) [text/html]
Sauvegarde en : « /dev/null »

/dev/null    100%[======================>]   3,30K  --.-KB/s    ds 0s

2018-10-15 17:02:17 (154 MB/s) — « /dev/null » sauvegardé [3378/3378]</screen>
		</listitem>
		</itemizedlist>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<sect1 xml:id='interco.ospf-quagga.fake-routes.veth'>
	<title>Interfaces de type <wordasword>veth</wordasword></title>

	<para>L'introduction d'un nouvel espace de nom réseau revient à introduire
		une nouvelle table de routage dans un même système. Dans la vue
		ci-dessous, le cadre vert illustre les éléments ajoutés au routeur
		<systemitem class='systemname'>R2</systemitem>. Les mêmes opérations
		sont à réaliser sur le routeur <systemitem
		class='systemname'>R3</systemitem> en suivant le plan d'adressage
		présenté à la <xref
		linkend='interco.ospf-quagga.archi'/>.</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.ns.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.ns.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Topologie logique avec un espace de noms réseau</phrase>
	</textobject>
	</mediaobject>

	<qandaset>
	<qandadiv>
	<qandaentry>
	<question>
	<para><phrase>Comment créer une paire d'interfaces réseau virtuelles de
	type <wordasword>veth</wordasword> sur un système
	GNU/Linux&nbsp;?</phrase></para>

	<para>Rechercher dans les pages de manuels la commande
	<command>ip&nbsp;link</command> la syntaxe qui permet de créer la paire
	d'interfaces <option>veth0</option> et <option>veth1</option>.</para>
	</question>
	<answer>
<screen><prompt>#</prompt> ip link add veth1 type veth peer name veth0

<prompt>#</prompt> ip link ls dev veth0
5: veth0@veth1: &lt;BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN \
				mode DEFAULT group default qlen 1000
    link/ether 86:22:d2:14:05:b4 brd ff:ff:ff:ff:ff:ff

<prompt>#</prompt> ip link ls dev veth1
6: veth1@veth0: &lt;BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN \
				mode DEFAULT group default qlen 1000
    link/ether 9e:c8:44:e6:fa:70 brd ff:ff:ff:ff:ff:ff</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Comment créer un nouvel espace de noms réseau appelé
	<wordasword>green</wordasword> et affecter l'interface
	<option>veth1</option> à cet espace de noms&nbsp;?</phrase></para>

	<para>Rechercher dans les pages de manuels <option>ip-netns</option> la
	syntaxe qui permet de créer un nouvel espace de noms réseau.</para>
	</question>
	<answer>
<screen><prompt>#</prompt> ip netns add green
<prompt>#</prompt> ip netns list
green</screen>

	<para>L'affectation d'une interface à l'espace de noms se fait avec la
	commande suivante.</para>

<screen><prompt>#</prompt> ip link set veth1 netns green</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Comment visualiser et modifier l'état des interfaces de type
	<option>veth</option> dans les deux espaces de noms
	réseau&nbsp;?</phrase></para>

	<para>Rechercher dans les pages de manuels <option>ip-netns</option> la
	syntaxe qui permet d'exécuter une commande dans un nouvel espace de noms
	réseau.</para>
	</question>
	<answer>
	<para>On active les deux interfaces et on affiche les informations
	d'état.</para>

<screen><prompt>#</prompt> ip link set dev veth0 up

<prompt>#</prompt> ip link ls dev veth0
5: veth0@if6: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue \
			state LOWERLAYERDOWN mode DEFAULT group default qlen 1000
    link/ether 86:22:d2:14:05:b4 brd ff:ff:ff:ff:ff:ff <emphasis>link-netns green</emphasis></screen>

<screen><prompt>#</prompt> ip netns exec green ip link set dev veth1 up

<prompt>#</prompt> ip netns exec green ip link ls dev veth1
6: veth1@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue 
			state UP mode DEFAULT group default qlen 1000
    link/ether 9e:c8:44:e6:fa:70 brd ff:ff:ff:ff:ff:ff <emphasis>link-netnsid 0</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Comment valider les communications entre les deux espaces de
	noms réseau&nbsp;?</phrase></para>

	<para>Utiliser les adresses de lien local <acronym>IPv6</acronym> pour
	faire un test <acronym>ICMP</acronym> avec l'adresse multicast de
	sollicitation d'hôte.</para>
	</question>
	<answer>
	<para>Le test avec la commande <command>ping</command> doit désigner
	l'interface du lien à utiliser.</para>

<screen><prompt>#</prompt> ping -c2 ff02::1%veth0
PING ff02::1%veth0(ff02::1%veth0) 56 data bytes
64 bytes from fe80::8422:d2ff:fe14:5b4%veth0: icmp_seq=1 ttl=64 time=0.080 ms
64 bytes from fe80::9cc8:44ff:fee6:fa70%veth0: icmp_seq=1 ttl=64 time=0.168 ms (DUP!)
64 bytes from fe80::8422:d2ff:fe14:5b4%veth0: icmp_seq=2 ttl=64 time=0.046 ms

--- ff02::1%veth0 ping statistics ---
2 packets transmitted, 2 received, +1 duplicates, 0% packet loss, time 20ms
rtt min/avg/max/mdev = 0.046/0.098/0.168/0.051 ms</screen>

	<para>Le voisinage réseau de l'interface <systemitem>veth0</systemitem>
	désigne l'adresse <acronym>MAC</acronym> de l'interface
	<systemitem>veth1</systemitem> dans l'espace de noms réseau
	<wordasword>green</wordasword>.</para>

<screen><prompt>#</prompt> ip nei ls dev veth0
fe80::9cc8:44ff:fee6:fa70 lladdr <emphasis>9e:c8:44:e6:fa:70</emphasis> STALE</screen>

	<para>Réciproquement, le voisinage réseau de l'interface
	<systemitem>veth1</systemitem> désigne l'adresse <acronym>MAC</acronym> de
	l'interface <systemitem>veth0</systemitem>.</para>

<screen><prompt>#</prompt> ip netns exec green ip nei ls dev veth1
fe80::8422:d2ff:fe14:5b4 lladdr <emphasis>86:22:d2:14:05:b4</emphasis> router STALE</screen>

	<para>On peut donc conclure que le lien point à point entre les deux
	espaces de noms réseau est fonctionnel.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
	<para><phrase>Comment ajouter deux préfixes réseau <acronym>IPv4</acronym>
	et <acronym>IPv6</acronym> sur la liaison point à point entre les deux
	interfaces de type <option>veth</option>&nbsp;?</phrase></para>

	<para>Comme lors des étapes précédentes, on reprend les commandes
	<command>ip</command> avec la désignation de l'espace de noms réseau pour
	l'interface à l'extrémité du lien point à point.</para>
	</question>
	<answer>
	<para>Dans notre exemple sur le routeur <systemitem
	class='systemname'>R2</systemitem>, on utilise les préfixes <systemitem
	class='ipaddress'>10.1.2.0/30</systemitem> et <systemitem
	class='ipaddress'>2001:678:3fc:d::/64</systemitem>.</para>

	<itemizedlist>
	<listitem>
		<para>Pour l'interface <option>veth0</option>&nbsp;:</para>

<screen><prompt>#</prompt> ip addr add 10.1.2.1/30 brd + dev veth0
<prompt>#</prompt> ip -6 addr add 2001:678:3fc:d::1/64 dev veth0</screen>
	</listitem>
	<listitem>
		<para>Pour l'interface <option>veth1</option>&nbsp;:</para>

<screen><prompt>#</prompt> ip netns exec green ip addr add 10.1.2.2/30 brd + dev veth1
<prompt>#</prompt> ip netns exec green ip -6 addr add 2001:678:3fc:d::2/64 dev veth1</screen>
	</listitem>
	</itemizedlist>

	<para>Comme dans la question précédente, on peut qualifier la communication
	entre les deux interfaces au niveau réseau à l'aide de la commande
	<command>ping</command>.</para>

	<para>Voici une copie d'écran des tests effectués depuis l'espace de noms
	<option>green</option>.</para>

<screen><prompt>#</prompt> ip netns exec green ping -qc2 10.1.2.1
PING 10.1.2.1 (10.1.2.1) 56(84) bytes of data.

--- 10.1.2.1 ping statistics ---
2 packets transmitted, 2 received, <emphasis>0% packet loss</emphasis>, time 33ms
rtt min/avg/max/mdev = 0.043/0.055/0.067/0.012 ms

<prompt>#</prompt> ip netns exec green ping -qc2 2001:678:3fc:d::1
PING 2001:678:3fc:d::1(2001:678:3fc:d::1) 56 data bytes

--- 2001:678:3fc:d::1 ping statistics ---
2 packets transmitted, 2 received, <emphasis>0% packet loss</emphasis>, time 18ms
rtt min/avg/max/mdev = 0.050/0.081/0.113/0.032 ms</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment publier les préfixes réseau correspondant à la
		nouvelle liaison point à point via <acronym>OSPF</acronym> avec un
		débit binaire de lien à 1Gbps&nbsp;?</phrase></para>

		<para>Une fois la console <application>vtysh</application> ouverte,
		accéder en mode configuration de l'interface puis des deux démons de
		routage.</para>

		<simplelist type='horiz'>
		<member><command>interface vethX</command></member>
		<member><command>bandwidth</command></member>
		<member><command>router ospf</command></member>
		<member><command>network A.B.C.D/MM area 0</command></member>
		<member><command>router ospf6</command></member>
		<member><command>interface vethX area 0.0.0.0</command></member>
		</simplelist>
	</question>
	<answer>
		<para>On commence par la définition du débit binaire au niveau de
		l'interface.</para>

<screen><prompt>R1#</prompt> conf t
R1(config)# int veth0
R1(config-if)# bandwidth 1000000
R1(config-if)# ^Z</screen>

		<para>On peut ensuite publier les préfixes réseau
		<acronym>IPv4</acronym> et <acronym>IPv6</acronym> au niveau de chaque
		instance de protocole de routage <acronym>OSPF</acronym>.</para> 

<screen><prompt>R1#</prompt> conf t
R1(config)# router ospf
R1(config-router)# network 10.1.2.0/30 area 0
R1(config-router)# ^Z</screen>

<screen><prompt>R1#</prompt> conf t
R1(config)# router ospf6
R1(config-ospf6)# interface veth0 area 0.0.0.0
R1(config-ospf6)# ^Z</screen>

		<para>Enfin, on vérifie la présence des deux préfixes réseau dans les
		bases <acronym>OSPF</acronym>.</para>

<screen><prompt>R2#</prompt> sh ip route 10.1.2.0/30
Routing entry for 10.1.2.0/30
  <emphasis>Known via "ospf", distance 110, metric 1, tag 0, vrf 0</emphasis>
  Last update 00:02:44 ago
  >  directly connected, veth0

Routing entry for 10.1.2.0/30
  Known via "connected", distance 0, metric 0, tag 0, vrf 0, best, fib
  >* directly connected, veth0</screen>

<screen><prompt>R2#</prompt> sh ipv6 route 2001:678:3fc:d::/64
Routing entry for 2001:678:3fc:d::/64
  <emphasis>Known via "ospf6", distance 110, metric 1, tag 0, vrf 0</emphasis>
  Last update 00:04:44 ago
  >  directly connected, veth0

Routing entry for 2001:678:3fc:d::/64
  Known via "connected", distance 0, metric 0, tag 0, vrf 0, best, fib
  >* directly connected, veth0</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Est-ce que les adresses <acronym>IPv4</acronym> et
		<acronym>IPv6</acronym> situées dans l'espace de noms
		<wordasword>green</wordasword> joiganbles depuis les réseaux
		distants&nbsp;?</phrase></para>

		<para>Le fait d'avoir placé l'interface <option>veth1</option> dans un
		espace de noms réseau distinct, impose l'utilisation d'une table de
		routage propre à cet espace. Sur la base des opérations déjà
		effectuées, on s'interroge sur le fait que ces opérations suffisent
		pour que les communications soient fonctionnelles.</para>

		<para>On fait des tests <acronym>ICMP</acronym> et
		<acronym>ICMP6</acronym> depuis un autre routeur pour constater que si
		les flux parviennent bien à destination, il n'existe pas de solution
		retour.</para>
	</question>
	<answer>
		<para>Dans l'exemple ci-dessous, on teste les communications entre le
		routeur <systemitem class='systemname'>R1</systemitem> et l'interface
		<systemitem>veth1</systemitem> située au delà du routeur <systemitem
		class='systemname'>R3</systemitem></para>

		<para>On lance une requête <acronym>ICMP</acronym> depuis <systemitem
		class='systemname'>R1</systemitem>.</para>

<screen><prompt>R1:~#</prompt> ping -c3 10.1.3.2
PING 10.1.3.2 (10.1.3.2) 56(84) bytes of data.

--- 10.1.3.2 ping statistics ---
3 packets transmitted, 0 received, <emphasis>100% packet loss</emphasis>, time 40ms</screen>

		<para>On lance l'analyse réseau dans l'espace de noms réseau
		<wordasword>green</wordasword>.</para>

<screen><prompt>R3:~#</prompt> ip netns exec green /usr/bin/tshark -i veth1 -f icmp
&lt;snipped/>
Capturing on 'veth1'
 1 0.000000000    10.1.13.1 → 10.1.3.2     ICMP 98 Echo (ping) request  id=0x1309, seq=1/256, ttl=63
 2 1.013794602    10.1.13.1 → 10.1.3.2     ICMP 98 Echo (ping) request  id=0x1309, seq=2/512, ttl=63
 3 2.037727585    10.1.13.1 → 10.1.3.2     ICMP 98 Echo (ping) request  id=0x1309, seq=3/768, ttl=63
^C3 packets captured</screen>

		<para>On relève bien l'arrivée de la requête à destination. Il n'y a
		aucune réponse.</para>

		<para>En reprenant le même test avec <acronym>ICMP6</acronym>, on
		relève le même problème.</para>

<screen><prompt>R1:~#</prompt> ping -c3 2001:678:3fc:f::2
PING 2001:678:3fc:f::2(2001:678:3fc:f::2) 56 data bytes

--- 2001:678:3fc:f::2 ping statistics ---
3 packets transmitted, 0 received, <emphasis>100% packet loss</emphasis>, time 27ms</screen>

		<para>L'analyse réseau ne montre que l'arrivée des requêtes à
		destination.</para>

<screen><prompt>R3:~#</prompt> ip netns exec green /usr/bin/tshark -i veth1 -f icmp6
&lt;snipped/>
Capturing on 'veth1'
 1 0.000000000 2001:678:3fc:d::1 → 2001:678:3fc:f::2 ICMPv6 118 Echo (ping) request id=0x130a, seq=1, hop limit=63
 2 1.001038537 2001:678:3fc:d::1 → 2001:678:3fc:f::2 ICMPv6 118 Echo (ping) request id=0x130a, seq=2, hop limit=63
 3 2.025046012 2001:678:3fc:d::1 → 2001:678:3fc:f::2 ICMPv6 118 Echo (ping) request id=0x130a, seq=3, hop limit=63</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment compléter les tables de routage
		<acronym>IPv4</acronym> et <acronym>IPv6</acronym> situées dans
		l'espace de noms <wordasword>green</wordasword> pour que le trafic
		sortant par l'interface <systemitem>veth1</systemitem> soit émis
		correctement&nbsp;?</phrase></para>

		<para>On complète les tables de routage avec une route par défaut pour
		joindre les réseaux distants depuis l'espace de noms
		<wordasword>green</wordasword>.</para>
	</question>
	<answer>
		<para>La lecture des tables de routage dans l'espace de noms réseau
		<wordasword>green</wordasword> explique tout. Ces tables ne contiennent
		que l'entrée relative au lien point à point configuré entre les
		interfaces <systemitem>veth0</systemitem> et
		<systemitem>veth1</systemitem>.</para>

<screen><prompt>R3:~#</prompt> ip netns exec green ip route ls
10.1.3.0/30 dev veth1 proto kernel scope link src 10.1.3.2

<prompt>R3:~#</prompt> ip netns exec green ip -6 route ls
2001:678:3fc:f::/64 dev veth1 proto kernel metric 256 pref medium
fe80::/64 dev veth1 proto kernel metric 256 pref medium</screen>

		<para>Il faut donc compléter ces tables de routage avec une route par
		défaut vers l'espace de noms réseau par défaut dans lequel est située
		l'interface <systemitem>veth0</systemitem>.</para>

<screen><prompt>R3:~#</prompt> ip netns exec green ip route add default via 10.1.3.1

<prompt>R3:~#</prompt> ip netns exec green ping -c1 ff02::2%veth1
PING ff02::2%veth1(ff02::2%veth1) 56 data bytes
64 bytes from fe80::8422:d2ff:fe14:5b4%veth1: icmp_seq=1 ttl=64 time=0.072 ms

--- ff02::2%veth1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.072/0.072/0.072/0.000 ms

<prompt>R3:~#</prompt> ip netns exec green ip -6 route add default via fe80::8422:d2ff:fe14:5b4 dev veth1</screen>

		<para>Les nouvelles tables de routage de l'espace de noms
		<wordasword>green</wordasword> font apparaître les routes par
		défaut</para>

<screen><prompt>R3:~#</prompt> ip netns exec green ip route ls
default via 10.1.3.1 dev veth1
10.1.3.0/30 dev veth1 proto kernel scope link src 10.1.3.2</screen>

<screen><prompt>R3:~#</prompt> ip netns exec green ip -6 route ls
2001:678:3fc:f::/64 dev veth1 proto kernel metric 256 pref medium
fe80::/64 dev veth1 proto kernel metric 256 pref medium
default via fe80::8422:d2ff:fe14:5b4 dev veth1 metric 1024 pref medium</screen>

		<para>Les tests <acronym>ICMP</acronym> et <acronym>ICMP6</acronym> de
		la question précédente montrent maintenant que les communications sont
		bien fonctionnelles. Les requêtes sont à nouveau émises depuis le
		routeur <systemitem class='systemname'>R1</systemitem></para>

<screen><prompt>R1:~#</prompt> ping -c3 10.1.3.2
PING 10.1.3.2 (10.1.3.2) 56(84) bytes of data.
64 bytes from 10.1.3.2: icmp_seq=1 ttl=63 time=0.484 ms
64 bytes from 10.1.3.2: icmp_seq=2 ttl=63 time=0.068 ms
64 bytes from 10.1.3.2: icmp_seq=3 ttl=63 time=0.066 ms

--- 10.1.3.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 50ms</screen>

<screen><prompt>R1:~#</prompt> ping -c3 2001:678:3fc:f::2
PING 2001:678:3fc:f::2(2001:678:3fc:f::2) 56 data bytes
64 bytes from 2001:678:3fc:f::2: icmp_seq=1 ttl=63 time=0.591 ms
64 bytes from 2001:678:3fc:f::2: icmp_seq=2 ttl=63 time=0.083 ms
64 bytes from 2001:678:3fc:f::2: icmp_seq=3 ttl=63 time=0.081 ms

--- 2001:678:3fc:f::2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 48ms</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment installer un service Web en écoute exclusivement
		sur les adresses <acronym>IPv4</acronym> et <acronym>IPv6</acronym>
		situées dans l'espace de noms réseau
		<wordasword>green</wordasword>&nbsp;?</phrase></para>

		<para>Pour aller au plus court, on installe le paquet
		<application>lighttpd</application> et on édite la configuration du
		service de façon à limiter l'accès aux adresses <acronym>IP</acronym>
		voulues.</para>
	</question>
	<answer>
<screen><prompt>R3:~#</prompt> aptitude install lighttpd</screen>

		<para>On modifie ensuite le fichier de configuration
		<filename>/etc/lighttpd/lighttpd.conf</filename> de façon à limiter
		l'accès aux adresses <acronym>IPv4</acronym> et <acronym>IPv6</acronym>
		de l'interface <option>veth1</option>.</para>

		<para>Voici une copie du correctif correspondant au routeur <systemitem
		class='systemname'>R3</systemitem>.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/R3-veth1-lighttpd.conf.patch'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

		<para>Relativement à une configuration classique, il faut lancer le
		serveur Web dans le contexte du nouvel espace de noms réseau. On
		commence donc par arrêter le démon lancé lors de l'installation du
		paquet.</para>

<screen><prompt>R3:~#</prompt> systemctl stop lighttpd</screen>

		<para>Là encore, pour aller au plus court on lance directement le démon
		dans le contexte de l'espace de noms réseau
		<wordasword>green</wordasword>.</para>

<screen><prompt>R3:~#</prompt> ip netns exec green lighttpd -f /etc/lighttpd/lighttpd.conf

<prompt>R3:~#</prompt> ip netns exec green ss -nlt '( src :80 )'
State      Recv-Q  Send-Q       Local Address:Port  Peer Address:Port
LISTEN     0       128               10.1.3.2:80         0.0.0.0:*
LISTEN     0       128    [2001:678:3fc:f::2]:80            [::]:*</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment valider l'accès au service Web situé dans
		l'espace de noms réseau <wordasword>green</wordasword> depuis un réseau
		distant&nbsp;?</phrase></para>

		<para>Comme la partie routage a été validée dans les questions
		précédentes,	on passe directement à la couche application avec le
		chargement de la page Web par défaut du serveur.</para>
	</question>
	<answer>
		<para>Depuis le routeur <systemitem class='systemname'>R1</systemitem>,
		on obtient les résultats suivants.</para>

<screen><prompt>R1:~#</prompt> wget -O /dev/null http://10.1.3.2
--2018-10-16 14:32:06--  http://10.1.3.2/
Connexion à 10.1.3.2:80… connecté.
requête HTTP transmise, en attente de la réponse… <emphasis>200 OK</emphasis>
Taille : 3378 (3,3K) [text/html]
Sauvegarde en : « /dev/null »

/dev/null       100%[===================>]   3,30K  --.-KB/s    ds 0s

2018-10-16 14:32:06 (209 MB/s) — « /dev/null » sauvegardé [3378/3378]</screen>

<screen><prompt>R1:~#</prompt> wget -O /dev/null http://[2001:678:3fc:f::2]
--2018-10-16 14:34:39--  http://[2001:678:3fc:f::2]/
Connexion à [2001:678:3fc:f::2]:80… connecté.
requête HTTP transmise, en attente de la réponse… <emphasis>200 OK</emphasis>
Taille : 3378 (3,3K) [text/html]
Sauvegarde en : « /dev/null »

/dev/null       100%[===================>]   3,30K  --.-KB/s    ds 0s

2018-10-16 14:34:39 (268 MB/s) — « /dev/null » sauvegardé [3378/3378]</screen>
	</answer>
	</qandaentry>
	</qandadiv>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.auto-cost'>
	<title>Adaptation de la métrique de lien au débit</title>

	<para>Par défaut, le calcul de métrique du le protocole
	<acronym>OSPF</acronym> se fait à partir de l'expression&nbsp;:
	10<superscript>8</superscript> / Bande_Passante_du_lien.</para>

	<para>Cette règle a été établie à une époque où l'utilisation d'un lien à
	100Mbps devait être considéré comme une situation d'exploitation futuriste.
	Aujourd'hui, les liens à 100Mbps sont dépassés.</para>

	<para>Cette section traite de la configuration des instances de
	protocole de routage <acronym>OSPF</acronym> utilisant des liens avec un
	débit binaire supérieur à 100Mbps.</para>

	<qandaset>
	<qandaentry>
	<question>
		<para><phrase>Quelle est l'instruction à utiliser pour que le calcul de
		métrique <acronym>OSPF</acronym> se fasse sur la base d'un débit de
		lien à 10Gbps&nbsp;?</phrase></para>

		<para>Rechercher le mot clé <wordasword>reference</wordasword> dans
		l'index des instructions de configuration. Voir <xref
		linkend='interco.ospf-quagga.refdocs.quagga-command-index' />.</para>
	</question>
	<answer>
		<para>C'est l'instruction <command>auto-cost
		reference-bandwidth</command> qui permet de fixer une nouvelle
		référence de coût de lien en Mbps.</para>

<screen>R2-ospfd(config-router)# auto-cost reference-bandwidth
  &lt;1-4294967>  The reference bandwidth in terms of Mbits per second</screen>

		<para>Voici un extrait de la configuration du routeur <systemitem
		class='systemname'>R2</systemitem> après application d'une nouvelle
		référence à 10000Mbps soit 10Gbps.</para>

<screen><prompt>R3#</prompt> conf t
R3(config)# router ospf
R3(config-router)# auto-cost reference-bandwidth
  &lt;1-4294967>  The reference bandwidth in terms of Mbits per second
R3(config-router)# <emphasis>auto-cost reference-bandwidth 10000</emphasis>
R3(config-router)# ^Z</screen>

		<para>Il est indispensable que tous les routeurs de l'aire
		<acronym>OSPF</acronym> aient la même référence de calcul de métrique.
		La même instruction doit donc être implantée dans la configuration des
		trois routeurs.</para>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment modifier le débit binaire d'un lien à
		1Gbps&nbsp;?</phrase></para>

		<para>Normalement, le débit d'un lien est directement extrait des
		paramètres du composant de l'interface connectée au lien. Dans le cas
		d'interfaces qui n'ont aucune réalité physique, ce débit peut être
		attribué arbitrairement par configuration. On doit rechercher dans les
		options de la console <application>vtysh</application> le moyen
		d'attribuer une indication de débit aux sous-interfaces de
		<acronym>VLAN</acronym>s.</para>
	</question>
	<answer>
		<para>Comme indiqué dans la <xref
		linkend='interco.ospf-quagga.prepare-config'/>, c'est dans la
		configuration des interfaces que l'on attribue le débit binaire d'une
		interface réseau. Cette opération est nécessaire compte tenu du fait
		que le débit d'une même interface Ethernet <option>eth0</option> peut
		varier de 10Mbps à 10Gbps.</para>

<screen>interface eth0
 <emphasis>bandwidth 1000000</emphasis>
!
interface eth0.12
 <emphasis>bandwidth 1000000</emphasis>
!
interface eth0.23
 <emphasis>bandwidth 1000000</emphasis></screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Comment peut-on identifier le débit d'un lien dans la
		configuration <acronym>OSPF</acronym>&nbsp;?</phrase></para>

		<para>Visualiser les paramètres des interfaces réseau depuis la console
		<application>vtysh</application>. Les commandes suivantes peuvent être
		lancées sur chacun des trois routeurs.</para>

		<simplelist type='horiz'>
		<member><command>show&nbsp;ip&nbsp;ospf interface</command></member>
		<member><command>show&nbsp;ipv6&nbsp;ospf6 interface</command></member>
		</simplelist>
	</question>
	<answer>
		<para>Voici le résultat obtenu sur le routeur <systemitem
		class='systemname'>R2</systemitem>.</para>

<screen><prompt>R2#</prompt> sh ip ospf interface eth0.12
eth0.12 is up
  ifindex 2, MTU 1500 bytes, <emphasis>BW 1000000 Kbit</emphasis> &lt;UP,BROADCAST,RUNNING,MULTICAST>
  Internet Address 10.1.12.2/26, Broadcast 10.1.12.63, Area 0.0.0.0
  MTU mismatch detection:enabled
  Router ID 0.0.2.4, Network Type BROADCAST, Cost: 1
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 0.0.2.4, Interface Address 10.1.12.2
  Backup Designated Router (ID) 0.0.1.4, Interface Address 10.1.12.1
  Saved Network-LSA sequence number 0x8000009a
  Multicast group memberships: OSPFAllRouters OSPFDesignatedRouters
  Timer intervals configured, Hello 10s, Dead 40s, Wait 40s, Retransmit 5
    Hello due in 7.154s
  Neighbor Count is 1, Adjacent neighbor count is 1</screen>
	</answer>
	</qandaentry>

	<qandaentry>
	<question>
		<para><phrase>Quel est le coût d'accès au service Web installé sur
		<systemitem class='systemname'>R3</systemitem> depuis <systemitem
		class='systemname'>R2</systemitem>&nbsp;? Justifier la valeur de
		métrique obtenue.</phrase></para>

		<para>À partir des informations de routage sur <systemitem
		class='systemname'>R2</systemitem>, faire la somme des métriques de
		chaque lien entre les deux extrémités en	communication.</para>
	</question>
	<answer>
		<para>Il est possible d'obtenir les informations de calcul de métrique
		à partir de l'affichage d'une route particulière à la console
		<application>vtysh</application>.</para>

<screen><prompt>R2#</prompt> sh ip route 10.1.3.0/30
Routing entry for 10.1.3.0/30
  <emphasis>Known via "ospf", distance 110, metric 2</emphasis>, tag 0, vrf 0, best, fib
  Last update 00:10:37 ago
  >* 10.1.23.3, via eth0.23</screen>

		<para>Dans cet exemple, la métrique d'accès au réseau <systemitem
		class='ipaddress'>10.1.3.0/30</systemitem> correspond à la somme des
		coûts de deux liens à 1Gbps soit 2</para>
	</answer>
	</qandaentry>
	</qandaset>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.vm'>
	<title>Manipulations sur machines virtuelles</title>

	<para>Il est possible de réaliser l'ensemble des manipulations de ce
	support à l'aide de trois machines virtuelles et du commutateur
	&url.ovs;. Dans la figure ci-dessous, le routeur baptisé
	<citetitle>ISP</citetitle> correspond au système hôte sur lequel les
	systèmes virtuels sont exécutés.</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.vm.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.vm.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Topologie logique machines virtuelles</phrase>
	</textobject>
	</mediaobject>

<table xml:id='quagga.vm-lab.addressing' frame='all' pgwide='1'>
	<title>Affectation des rôles, des numéros de VLANs et des adresses IP</title>
	<tgroup cols='5' align='left' colsep='1' rowsep='1'>
		<colspec colnum='1' colwidth='1*'/>
		<colspec colnum='2' colwidth='2*'/>
		<colspec colnum='3' colwidth='1*'/>
		<colspec colnum='4' colwidth='1.5*'/>
		<colspec colnum='5' colwidth='5*'/>
	<thead>
	<row>
		<?dbfo bgcolor="#333" ?>
		<?dbfo color="#fff" ?>
		<entry>Routeur</entry>
		<entry>OSPF router-id</entry>
		<entry>VLAN</entry>
		<entry>Interface</entry>
		<entry>Réseau</entry>
	</row>
	</thead>
	<tbody>
	<row>
		<entry morerows='7' valign='middle'>R1</entry>
		<entry morerows='7' valign='middle'>OSPFv2 -> 0.0.1.4<?custom-linebreak?>OSPFv3 -> 0.0.1.6</entry>
		<entry morerows='1' valign='middle' align='right'>0</entry>
		<entry morerows='1' valign='middle'>eth0</entry>
		<entry><systemitem class='ipaddress'>192.0.2.9/27</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:a::9/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>12</entry>
		<entry morerows='1' valign='middle'>eth0.12</entry>
		<entry><systemitem class='ipaddress'>10.0.12.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:c::1/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>13</entry>
		<entry morerows='1' valign='middle'>eth0.13</entry>
		<entry><systemitem class='ipaddress'>10.0.13.1/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:d::1/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>dummy0</entry>
		<entry><systemitem class='ipaddress'>10.1.1.1/29</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:b::1/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>R2</entry>
		<entry morerows='5' valign='middle'>OSPFv2 -> 0.0.2.4<?custom-linebreak?>OSPFv3 -> 0.0.2.6</entry>
		<entry morerows='1' valign='middle' align='right'>12</entry>
		<entry morerows='1' valign='middle'>eth0.12</entry>
		<entry><systemitem class='ipaddress'>10.1.21.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:c::2/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>23</entry>
		<entry morerows='1' valign='middle'>eth0.23</entry>
		<entry><systemitem class='ipaddress'>10.1.23.2/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:17::2/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.2.1/30</systemitem>&nbsp;->
			<phrase role='green'><systemitem class='ipaddress'>10.1.2.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:e::1/64</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:e::2/64</systemitem></phrase></entry>
	</row>
	<row>
		<entry morerows='5' valign='middle'>R3</entry>
		<entry morerows='5' valign='middle'>OSPFv2 -> 0.0.3.4<?custom-linebreak?>OSPFv3 -> 0.0.3.6</entry>
		<entry morerows='1' valign='middle' align='right'>13</entry>
		<entry morerows='1' valign='middle'>eth0.13</entry>
		<entry><systemitem class='ipaddress'>10.1.13.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:d::3/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>23</entry>
		<entry morerows='1' valign='middle'>eth0.23</entry>
		<entry><systemitem class='ipaddress'>10.1.23.3/26</systemitem></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:17::3/64</systemitem></entry>
	</row>
	<row>
		<entry morerows='1' valign='middle' align='right'>-</entry>
		<entry morerows='1' valign='middle'>veth0:<phrase role='green'>veth1</phrase></entry>
		<entry><systemitem class='ipaddress'>10.1.3.1/30</systemitem>&nbsp;->
			<phrase role='green'><systemitem class='ipaddress'>10.1.3.2/30</systemitem></phrase></entry>
	</row>
	<row>
		<entry><systemitem class='ipaddress'>2001:678:3fc:f::1/64</systemitem>&nbsp;->
		<phrase role='green'><systemitem class='ipaddress'>2001:678:3fc:f::2/64</systemitem></phrase></entry>
	</row>
	</tbody>
	</tgroup>
</table>

	<sect2 xml:id='interco.ospf-quagga.vm.ovs'>
		<title>Préparation du commutateur Open vSwitch</title>

	<para>Vu du système hôte, on met en place la structure du graphique
	suivant.</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs-vm.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs-vm.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Synoptique système</phrase>
	</textobject>
	</mediaobject>

	<para>On se réfère au guide &url.vm; dans lequel le lancement du
	commutateur virtuel &url.ovs; est intégré à la configuration du système
	hôte. Voici un extrait du fichier
	<filename>/etc/network/interfaces</filename> relatif à la configuration du
	commutateur <systemitem>dsw-host</systemitem>.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/interfaces'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

	<para>Dans cette configuration, <systemitem>vlan1</systemitem> est
	l'interface principale du système hôte. Elle sert à la fois au routage et à
	l'accès aux instances de machines virtuelles depuis les autres
	réseaux.</para>

	<para>La configuration de départ du commutateur sur le système hôte est la
	suivante :</para>

<screen>$ sudo ovs-vsctl show
0fb1e80b-37cf-4dce-9a19-17b9fb989610
    Bridge dsw-host
        Port "eth0"
            Interface "eth0"
        Port "vlan1"
            Interface "vlan1"
                type: internal
        Port dsw-host
            Interface dsw-host
                type: internal
    ovs_version: "2.3.0"</screen>

	<para>Partant de cette configuration de départ, on créé 3 cordons de
	brassage ; un par routeur. On dispose d'un script pour répéter les
	opérations de base.</para>

<screen><?dbfo keep-together="auto" ?><xi:include href='files/patchcables.sh'
parse='text' xmlns:xi='http://www.w3.org/2001/XInclude'/></screen>

	<para>Avec cet outil, la création des cordons s'effectue comme
	suit&nbsp;:</para>

<screen><prompt>$</prompt> sh ./patchcables.sh tap1 tap2 tap3</screen>

	<para>Maintenant que les cordons sont disponibles, il faut les brasser sur
	le commutateur <systemitem>dsw-host</systemitem>. L'opération ci-dessous
	créé trois nouveaux ports sur le commutateur.</para>

<screen><prompt>$</prompt> for port in tap1 tap2 tap3; do sudo ovs-vsctl add-port dsw-host $port; done</screen>

	<para>Pour respecter la topologie physique proposée dans l'énoncé, ces
	trois ports doivent être configurés en mode
	<wordasword>trunk</wordasword>de façon à ce que chaque routeur puisse
	router les <acronym>VLAN</acronym>s qui le concernent. Avec &url.ovs;, les
	paramètres de configuration sont les suivants :</para>

<screen><prompt>$</prompt> sudo ovs-vsctl set port tap1 vlan_mode=trunk trunks=0,12,13
<prompt>$</prompt> sudo ovs-vsctl set port tap2 vlan_mode=trunk trunks=12,23
<prompt>$</prompt> sudo ovs-vsctl set port tap3 vlan_mode=trunk trunks=13,23</screen>

	<note>
	<para>La particularité du commutateur &url.ovs; est d'utiliser le numéro 0
	comme <acronym>VLAN</acronym> par défaut. Dans notre cas, ce
	<acronym>VLAN</acronym> 0 devient le <acronym>VLAN</acronym> natif dans
	lequel circulent les trames sans étiquettes
	<acronym>IEEE802.1Q</acronym>.</para>
	</note>

	<para>On aboutit à la représentation graphique suivante&nbsp;:</para>

	<mediaobject>
	<imageobject role='fo'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs.png' width='9cm' scalefit='1' />
	</imageobject>
	<imageobject role='html'>
		<imagedata format='PNG' fileref='images/interco.ospf.ovs.png' width='480px' scalefit='1' />
	</imageobject>
	<textobject>
		<phrase>Brassage des machines virtuelles</phrase>
	</textobject>
	</mediaobject>

	<para>La table de correspondance entre <acronym>VLAN</acronym> et liaison
	devient&nbsp;:</para>

	<informaltable frame='all'>
	<tgroup cols='2'>
	<colspec colwidth='1*'/>
	<colspec colwidth='1*'/>
	<tbody>
	<row>
		<entry><acronym>VLAN</acronym> numéro 0</entry>
		<entry>Liaison R1 &lt;-> ISP</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 12</entry>
		<entry>Liaison R1 &lt;-> R2</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 13</entry>
		<entry>Liaison R1 &lt;-> R3</entry>
	</row>
	<row>
		<entry><acronym>VLAN</acronym> numéro 23</entry>
		<entry>Liaison R2 &lt;-> R3</entry>
	</row>
	</tbody>
	</tgroup>
	</informaltable>

	<para>Une fois que les opérations des sections suivantes auront été
	effectuées, la consultation de la table <acronym>CAM</acronym> du
	commutateur donnera les informations suivantes :</para>

<screen><prompt>$</prompt> sudo ovs-appctl fdb/show dsw-host
[sudo] password for latu: 
 port  VLAN  MAC                Age
   11    12  ba:ad:ca:fe:00:02   10
   12    23  ba:ad:ca:fe:00:03    9
   12    13  ba:ad:ca:fe:00:03    9
   10    13  ba:ad:ca:fe:0d:01    9
   10    12  ba:ad:ca:fe:0c:01    4
   11    23  ba:ad:ca:fe:00:02    1
    1     0  de:56:80:40:1d:ed    0
    2     0  42:d9:5d:6c:89:d8    0</screen>
	</sect2>

	<sect2 xml:id='interco.ospf-quagga.vm.rtr'>
		<title>Préparation des routeurs</title>

	<para>Sachant que l'on dispose d'une image <wordasword>master</wordasword>
	sur laquelle est installée un système Debian GNU/Linux de base, on créé 3
	images différentielles qui vont correspondre aux instances de routeurs.
	Voici un exemple de suite de commandes pour la mise en place des
	images.</para>

<screen><prompt>:~$</prompt> mkdir -p ~/vm/ospf
<prompt>:~$</prompt> cd vm
<prompt>:~/vm$</prompt> wget http://www.stri/vm/vm0-debian-testing-i386-base.qed
&lt;snipped/>
<prompt>:~/vm$</prompt> cd ospf
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r1.qed
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r2.qed
<prompt>:~/vm/ospf$</prompt> ../scripts/diff-img.sh ../vm0-debian-testing-i386-base.qed r3.qed</screen>

	<para>Le code du &url.vm.diff-img.sh; est fourni dans le guide
	&url.vm;.</para>

	<para>Ensuite, on créé un nouveau script <wordasword>shell</wordasword> de
	lancement des instances de «routeurs» dans lequel on fixe les paramètres
	d'initialisation de ces mêmes «routeurs».</para>

	<warning>
	<para>Ce script ne doit être lancé qu'après l'initialisation du commutateur
	virtuel pour que le brassage des routeurs sur les ports du commutateur
	puisse se faire correctement.</para>
	</warning>

<screen><prompt>$</prompt> cd ~/vm/ospf
<prompt>$</prompt> cat ospf-startup.sh 
#!/bin/bash

../scripts/ovs-startup.sh r1.qed 512 1

../scripts/ovs-startup.sh r2.qed 512 2

../scripts/ovs-startup.sh r3.qed 512 3</screen>
	</sect2>

<sect2 xml:id='interco.ospf-quagga.vm.static-route'>
	<title>Table de routage du système hôte</title>

	<para>Pour que les réseaux de l'aire <acronym>OSPF</acronym> puissent
	communiquer avec le système hôte et l'Internet, il est nécessaire de
	compléter la table de routage du système hôte. La technique usuelle
	employée pour répondre au besoin consiste à implanter une route statique
	avec un «super réseau» qui rassemble tous les réseaux de l'aire en une
	seule entrée.</para>

	<para>L'aire <acronym>OSPF</acronym> étudiée contient tous les réseaux du
	<xref linkend='quagga.vm-lab.addressing'/>. L'utilisation de l'outil
	<application>ipcalc</application> permet de vérifier qu'un masque de 19
	bits permet d'englober ces réseaux en une seule entrée.</para>

<screen><prompt>$</prompt> ipcalc 10.1.0.0/19
Address:   10.1.0.0             00001010.00000001.000 00000.00000000
Netmask:   255.255.224.0 = 19   11111111.11111111.111 00000.00000000
Wildcard:  0.0.31.255           00000000.00000000.000 11111.11111111
=>
Network:   10.1.0.0/19          00001010.00000001.000 00000.00000000
HostMin:   10.1.0.1             00001010.00000001.000 00000.00000001
HostMax:   10.1.31.254          00001010.00000001.000 11111.11111110
Broadcast: 10.1.31.255          00001010.00000001.000 11111.11111111
Hosts/Net: 8190                  Class A, Private Internet</screen>

	<para>On complète donc la table de routage du système hôte avec
	l'instruction suivante&nbsp;:</para>

<screen><prompt>#</prompt> ip route add 10.1.0.0/19 via 192.0.2.10</screen>
</sect2>
</sect1>

<?custom-pagebreak?>
<sect1 xml:id='interco.ospf-quagga.refdocs'>
	<title>Documents de référence</title>

	<variablelist>
	<varlistentry xml:id='interco.ospf-quagga.refdocs.archi-tp'>
		<term><citetitle>Architecture réseau des travaux pratiques</citetitle></term>
	<listitem>
		<para>Le support &url.infra.tp;  présente la topologie physique des
		salles de travaux pratiques avec la &url.infra.tp.cabling; ainsi que
		les configurations par défaut des équipements. On y trouve aussi le
		plan d'adressage <acronym>IP</acronym> utilisé avec les autres supports
		de travaux pratiques, le plan de numérotations des
		<acronym>VLAN</acronym>s et les affectations des groupes de ports des
		commutateurs.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf-quagga.refdocs.config-interface-lan'>
		<term><citetitle>Configuration d'une interface réseau</citetitle></term>
	<listitem>
		<para>Le support &url.config.interface.lan; présente les opérations de
		configuration d'une interface réseau et propose quelques
		manipulations sur les protocoles de la pile
		<acronym>TCP/IP</acronym></para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf-quagga.refdocs.inter-vlan'>
		<term><citetitle>Introduction au routage inter-VLAN</citetitle></term>
	<listitem>
		<para>Le support &url.inter-vlan-routing; introduit le principe du
		routage inter-VLAN ainsi que ses conditions d'utilisation. C'est aussi
		un support de travaux pratiques dans lequel on n'utilise que du routage
		statique et de la traduction d'adresses sources
		(<acronym>S-NAT</acronym>) pour acheminer le trafic utilisateur entre
		les différents réseaux.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf-quagga.refdocs.quagga-command-index'>
		<term><citetitle>Index des commandes Quagga</citetitle></term>
	<listitem>
		<para>La page à l'adresse&nbsp;: &url.quagga-command-index; liste
		toutes les instructions utilisables dans console unifiée
		<command>vtysh</command>.</para>

		<para>Ces commandes sont largement inspirées du système d'exploitation
		<citetitle>IOS</citetitle> de <trademark>Cisco</trademark>.</para>
	</listitem>
	</varlistentry>

	<varlistentry xml:id='interco.ospf-quagga.refdocs.vm'>
		<term><citetitle>Virtualisation système et enseignement</citetitle></term>
	<listitem>
		<para>Le support &url.vm; présente la solution de virtualisation
		intégrée au noyau Linux&nbsp;: <acronym>KVM</acronym>. Associée au
		commutateur &url.ovs;, cette solution permet de construire des
		maquettes de travaux pratiques très complètes en offrant de nombreuses
		fonctions réseau «réelles» dont une table &url.cam;.</para>
	</listitem>
	</varlistentry>
	</variablelist>
</sect1>
</article>
